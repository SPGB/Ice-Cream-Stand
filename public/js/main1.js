Icecream=function(){"use strict";function e(e){history.pushState({},"Player - "+e,"/#!u/"+e),$.ajax({url:"user/"+e.toLowerCase(),success:function(e){if(e.error)return void R(e.error,"Error");e.prestige_level||(e.prestige_level=0),e.prestige_bonus||(e.prestige_bonus=0);var a="Add Friend</div>",s="true";Aa.friends&&Aa.friends.indexOf(e._id)>-1?(a=e.friend?"Mutual Friend":"Your Friend",s="false"):e.friend&&(a="Return Friends");var o="<1 minute"===e.updated_at?"online":"offline",n="";if(e.cow){var r=!1;if(e.cow.level<5)e.cow.skin="baby";else if(e.cow.items)for(var i=0;i<e.cow.items.length&&!(i>3);i++)if(e.cow.items[i]){var l=e.cow.items[i].split("/")[0].replace(/"/g,"");"wings_rainbow"==l&&(r=!0),n=n+'<div x-type="'+l+'" class="cow_attachment type_item"></div>'}n='<div class="user_cow_inner"><div class="cow_body" x-skin="'+e.cow.skin+'" />'+n+"</div>"}var c=e.created_at?new Date(e.created_at):new Date,d=new Date-c,p=Math.floor(d/1e3/60/60/24),u=["http://static.icecreamstand.ca/flavours/vanilla.png","http://static.icecreamstand.ca/flavours/strawberry.png","http://static.icecreamstand.ca/flavours/blueberry.png"],v=u[0];e.quests>2&&(v=u[1]),e.prestige_level>1&&(v=u[2]);for(var _=ns.indexOf(e.last_addon)>-1,m=_?Ot+"/addons/thumb/"+e.last_addon.replace(/\s+/g,"")+".png.gz":Ot+"/toppings/"+e.last_addon.replace(/\s+/g,"")+".png",h="",i=0;i<e.cows.length;i++)h=h+'<div class="user_cow_title" x-num="'+i+'" x-id="'+e.cows[i]._id+'">'+e.cows[i].name+'<span class="cow_card_level">lv'+Math.floor(e.cows[i].level)+"</span></div>";var f="",g="";if(e.badges&&e.badges.length>0){for(var b=e.badges.length,i=0;b>i;i++)f=f+'<img src="'+Ot+"/badges/"+e.badges[i]+'.png" class="user_info_badge" />';g='<img src="'+Ot+"/badges/"+e.badges[0]+'.png" class="user_badge_avatar" />'}R('<div class="user_info_sash"><div class="badges">'+f+'</div></div><div class="user_info_inner"><div class="user_info_nav"><div class="user_info_tab user_info_tab_active" x-section="1">Player</div><div class="user_info_tab" x-section="2">Store</div><div class="user_info_tab" x-section="3">Stats</div></div><div class="playercard_anchor" x-anchor="1" style="display: block;"><table><tr><td style="text-align:center;"><img src="http://www.gravatar.com/avatar/'+e.gravatar+"?s=200&d="+v+'" class="gravatar" /><div class="button send_message" x-user="'+e.name+'">Message</div><div class="button add_friend" x-enabled="'+s+'" x-user="'+e.name+'">'+a+'</div></td><td><div class="user_icecream_holder"><div class="user_icecream" style="background-image: url('+Ot+"/flavours/thumb/"+e.last_flavor.replace(/\s+/g,"")+".png.gz), url("+Ot+"/cones/"+e.cone+'.png.gz)"><img src="'+m+'" x-new-art="'+_+'" class="user_addon" /></div></div></td></tr></table></div><div class="playercard_anchor" x-anchor="2"><table><tr><td><b>Carts</b> '+e.carts+"</td><td><b>Employees</b> "+e.employees+"</td></tr><tr><td><b>Trucks</b> "+e.trucks+"</td><td><b>Robots</b> "+e.robots+"</td></tr><tr><td><b>Rockets</b> "+e.rockets+"</td><td><b>Aliens</b> "+e.aliens+"</td></tr><tr><td><b>Coldhands</b> "+e.cold_hands+"</td><td><b>Autopilot</b> "+e.autopilot+'</td></tr></table></div><div class="playercard_anchor" x-anchor="3"><table><tr><td><b>Flavors</b> '+e.flavors+"</td><td><b>Add-ons</b> "+e.toppings+"</td></tr><td><b>Prestige</b> "+e.prestige_bonus+"% </td><td><b>Quests</b> "+e.quests+"</td></tr><td><b>Combos</b> "+e.combos+"</td><td><b>Player for</b> "+p+" days</td></tr><td><b>Channel</b> "+e.release_channel+"</td><td><b>Ice Cube time</b> "+Math.floor(e.accumulation_time/60)+":"+(e.accumulation_time%60).toFixed(1)+"</td></tr><td><b>Sold</b> "+t(e.sold)+(Aa.is_mod||Aa.is_admin?"<td><b>ID</b> <small>"+e._id+"</small>":"")+'</td></tr></table></div><div class="playercard_anchor" x-anchor="4">Achievements</div><div class="user_bottom_panel"><time class="'+o+'" title="Last seen '+e.updated_at+' ago." x-away="'+e.is_away+'"></time></div><div class="user_cow" x-user="'+e.name+'" x-night="'+e.is_night+'">'+h+n+"</div>",g+" "+e.name.substring(0,1).toUpperCase()+e.name.substring(1)+", "+e.title)},error:function(){R("failed to load user card","Error")}})}function a(e,a){return Math.round(e*Math.pow(10,a))/Math.pow(10,a)}function t(e){return e&&"undefined"!=typeof e?e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"}function s(){Aa.cones||(Aa.cones=[]),Aa.cones.push("default");for(var e=0;e<Aa.cones.length;e++){var a=Aa.cones[e];"babycone"==a&&(a="baby"),"sugarcone"==a&&(a="sugar"),0===$('#main_cone img[x-id="'+a+'"]').length&&$("#main_cone").prepend('<div class="option_wrapper tooltip" x-type="cone" draggable="true"><img x-src="'+Ot+"/cones/thumb/"+a+'.png.gz" x-type="cone" id="'+a+'" class="option" x-id="'+a+'" /></div>'),$('.cones_inner .unlockable[x-type="cone"][x-id="'+a+'"]').remove()}$("#main_cone.inner_flavor_container .option_wrapper").each(function(){$(this).parent().is(".page_wrap")&&$(this).unwrap()});for(var t=$("#main_cone.inner_flavor_container .option_wrapper:gt(4)"),e=0;e<t.length;e+=15)t.slice(e,e+15).wrapAll("<div class='page_wrap' x-page='"+Math.floor(e/15)+"' style='display:none;'></div>");setTimeout(function(){$("#main_cone .option_wrapper:first").click()},100),$('.flavor_tab[x-id="main_cone"]').hasClass("active")&&$('.flavor_tab[x-id="main_cone"]').click(),0===$(".cones_inner .unlockable, .cones_inner h3").length?$(".cones_inner").append("<h3>Every cone is unlocked!</h3>"):($(".cones_inner .unlockable").show(),$(".cones_inner .unlockable:gt(2)").hide())}function o(e){Lt=!0;var a=$("<div />",{"class":"new_message",text:e.text,"x-id":e._id});$(a).append("Added you as a friend!"==e.text?'<div class="new_message_respond" x-user="'+e.from+'">Say Hello!</div>':'<div class="new_message_respond" x-user="'+e.from+'">Reply</div>');var t=e.badge_id?'<img src="'+Ot+"/badges/"+e.badge_id+'.png" class="new_msg_badge" />':"";$(a).prepend('<div class="message_title">New Message!<span id="message_read"><i class="fa fa-times"></i></span></div>'+t+'<b class="user_card" x-user="'+e.from+'">'+e.from+"</b> "),$(a).append('<span class="triangle-down"></span>'),$(".floating_footer").append(a)}function n(){qa.on("trend",function(e){console.log(e);var a=e.trend;ua=a.flavour_id;for(var s,o=0;o<Pa.length;o++)if(Pa[o]._id===ua){s=Pa[o];break}Ua=a.bonus.toFixed(2),$(".trending #trend_bonus")[0].textContent=Ua,$(".trending h4 > span")[0].textContent=na(a.flavour_name)+" is trending",s?(T("update trending"),0==$('.currently_trending[x-id="'+ua+'"]').length?$(".trending .currently_trending_container").html('<span class="currently_trending tooltip" x-type="base" x-id="'+ua+'" id="'+a.flavour_name.replace(/\s+/g,"")+'"><img src="'+Ot+"/flavours/thumb/"+a.flavour_name.replace(/\s+/g,"")+'.png.gz" class="trending_img active" /></span></span>'):$(".trending #trend_bonus").text(Ua).show()):$(".trending .currently_trending_container").html('<span class="currently_trending tooltip" x-type="base" x-id="'+ua+'" id="'+a.flavour_name.replace(/\s+/g,"")+'"><img src="'+Ot+"/flavours/thumb/"+a.flavour_name.replace(/\s+/g,"")+'.png.gz" class="trending_img active trending_locked" /></span></span>'),$("#trend_left")[0].textContent=t(75e3-a.total_sold)+" left",$("#trend_sold_inner").css("width",a.total_sold/75e3*100+"%")}),qa.on("chat message",function(e){if(e.add_badge&&e.add_badge_id==Aa._id&&(Aa.badges.push(e.add_badge),E()),e.dunce&&e.dunce==Aa.name&&E("dunce",function(){Icecream.first_time_dunce()}),e.party&&("?"==e.party||e.party==Aa.name)){if("?"==e.party)return void(Aa.party_until=null);E("party",function(){Icecream.first_time_party()})}return e.sync&&e.sync==Aa._id&&window.location.reload(!0),e.room&&(console.log("message for room: "+e.room),e.room&&e.room!=Aa.room)?(St[e.room]||(St[e.room]=0),St[e.room]++,$('.chat_room_option[x-id="'+e.room+'"] > .chat_count')[0].textContent=St[e.room],$(".chat_rooms").attr("x-unread",!0),!1):void ia(e)}),qa.on("cow",function(e){console.log(e),e.resync&&(pa=null,Icecream.sync_cow()),e.experience&&(pa.experience=e.experience),pa.level<5&&e.level>5&&(R('<center><b>Your cow is growing up!</b><br><br><img src="'+Ot+'/skins/default.png" class="cow_evolve" /></center>',pa.name+" is evolving!"),pa=null,$(".cow")[0].textContent="",Icecream.sync_cow()),pa.level=e.level,pa.experience=e.experience,pa.happiness=e.happiness,e.item_change&&sa()}),qa.on("epic/aoc/log",function(e){var a="";e.power&&(Na=new Date,a=e.player+" attacked <i>"+e.fort+"</i> with <b>"+e.power+" power</b><small>"+new Date+"</small>"),e.health&&(a=e.player+" repaired <i>"+e.fort+"</i> for <b>"+e.health+" health</b><small>"+new Date+"</small>"),$(".aoc_log").append('<div class="aoc_log_msg">'+a+"</div>"),$(".aoc_log_msg").length>10&&$(".aoc_log_msg:first").remove()}),qa.on("update",function(e){e.gold&&(Aa.gold=parseFloat(e.gold)),e.ifr&&E("flavor"),e.chapter&&(L("You have unlocked <b>"+e.chapter+"</b>","Lore Chapter Unlocked!"),Aa.chapters_unlocked||(Aa.chapters_unlocked=[]),Aa.chapters_unlocked.push(e.chapter),$(".lore").attr("x-chapters",Aa.chapters_unlocked.length)),e.epic&&(Aa.epic_collected=e.epic,$(".user_epic_collected")[0].textContent=Aa.epic_collected),e.fort&&($('.aoc_dynamic[x-id="'+e.fort+'"] .fort_options span')[0].textContent=t(e.fort_health),e.fort_health<=0&&$('.aoc_dynamic[x-id="'+e.fort+'"]').remove()),e.messages&&o(e.messages[0]),e.room&&r(e.room),e.refresh&&(Nt=!1,$("body").append('<div class="white_overlay"><strong>Already signed in (or the server just went down)<br><br><small>Refreshing in 10 seconds</small></strong><i class="fa fa-times"></i></div>'),$(".white_overlay i").click(function(){$(".white_overlay").fadeOut(250,function(){$(this).remove(),Nt=!0})}),setTimeout(function(){Nt||window.location.reload(!0)},1e4)),e.trend&&($("#trend_left")[0].textContent=t(75e3-e.trend)+" left",$("#trend_sold_inner").css("width",e.trend/75e3*100+"%")),e.expertise&&e.expertise_position&&(Aa.flavors_sold[e.expertise_position]=e.expertise)}),qa.on("alert",function(e){if(e.error){$(".inline-message").remove();var a=["Ack Ack","Oh Noooo","Errrrar","Uh-oh","Bad news doc"];return void L(e.error,a[Math.floor(Math.random()*a.length)])}e.error&&L(e.error,"Error"),R(e.message,e.title)}),qa.on("join",function(e){var a=Icecream.get_friend(e._id);if(a){var t=new Date,s=new Date(a.updated_at);console.log("online -"+a.name+" ("+(t-s)+")"),a.is_away&&Aa.is_friend_notify&&t-s>6e4&&ia({_id:Math.random()+"online",user:":",badge:"1",text:"@"+a.name+" has come online",is_system:!0}),a.is_away=!1,la(a.name,2),$(".friends_counter span#count")[0].textContent=$(".friends_list_online > user, .friends_list_away > user").length+"/"+$(".friends_counter span#count").attr("x-length")}}),qa.on("sleep",function(e){var a=Icecream.get_friend(e._id);if(a){var t=new Date,s=new Date(a.updated_at);Aa.is_friend_notify&&a.is_away&&!e.sleep&&t-s>6e5&&ia({_id:Math.random()+"afk",user:":",badge:"1",text:"@"+a.name+" "+rs[Math.floor(Math.random()*rs.length)],is_system:!0}),a.is_away=e.sleep,a.updated_at=t,la(a.name,a.is_away?1:2)}}),qa.on("leave",function(e){var a=Icecream.get_friend(e._id);a&&(console.log("offline -"+a.name),a.updated_at=new Date,a.is_away=!0,la(a.name,0),$(".friends_counter span#count")[0].textContent=$(".friends_list_online > user, .friends_list_away > user").length+"/"+$(".friends_counter span#count").attr("x-length"))}),qa.on("typing",function(e){Xt[e._id]=new Date,setTimeout(function(){Xt[e._id]<new Date-900&&$('.is_typing[x-id="'+e._id+'"]').remove()},1e3),0===$('.is_typing[x-id="'+e._id+'"]').length&&$("#typing").append('<span class="is_typing" x-id="'+e._id+'">'+e.name+" is typing.</span>")}),Aa.room||(Aa.room="default"),r(Aa.room)}function r(e){if(as.length>0&&-1==as.indexOf(e))return!1;e!=Aa.room&&setTimeout(function(){Icecream.sync_chat()},1e3),Aa.room=e,St[e]=0;var a={sleep:!1,room:e};qa.emit("sleep",a),$(".current_room")[0].textContent=e,$(".chat_rooms .hidden").remove(),$(".chat_rooms").attr("x-unread",!1).append('<div class="hidden"></div>'),0===as.length&&(Aa.shadow_ban?as.push("swamp"):(as.push("default"),as.push("bug reports"),as.push("suggestions"),Aa.prestige_bonus>90&&as.push("Roleplay Closet"),(Aa.is_admin||Aa.is_mod)&&as.push("Mod Only"),(Aa.is_admin||Aa.is_mod)&&as.push("swamp"),Aa.badges&&-1!==Aa.badges.indexOf(1)&&as.push("donor lounge")));for(var t=0;t<as.length;t++)$(".chat_rooms .hidden").append(i(as[t]));$('.chat_room_option[x-id="'+Aa.room+'"]').addClass("active"),console.log(as)}function i(e){return St[e]||(St[e]=0),St[e]>0&&$(".chat_rooms").attr("x-unread",!0),'<div class="chat_room_option" x-id="'+e+'">'+e+' <span class="chat_count">'+St[e]+"</span></div>"}function l(e){if(!(!e&&yt.length>5||!pa)){var a=Math.floor(4*Math.random()),t=Math.random()*(.25*Wt-225)+25+.75*Wt,s=Math.random()<.1?"rock":"hay";"rock"===s&&(a=Math.random()<.1?2:1);var o=Math.random()+pa.magic_find;if(e&&(o+=.9),o>.8&&pa.level>5&&(pa.items.length<12||Math.random()<.5)){var n=[],r=["hat_basic","coat_basic","accessory_pipe/1/0/0","shoes_basic","hat_deerstalker","shoes_basic","shoes_cowboy"],i=["accessory_monocle/2/0/0/uncommon","wings_rainbow/1/0/0/uncommon","hat_fedora/-1/0/0/uncommon","hat_beerhat/0/0/2/uncommon","accessory_lei/0/0/1/uncommon","dress_lace/1/1/1/uncommon"],l=["hat_afro/0/2/0/rare","hat_crown/2/0/1/rare","tutu_pink/1/0/1/rare"];"523a1948750f2c0000000002"==Aa.last_flavor&&"525baaf765c3460000000007"==Aa.last_addon&&i.push("hat_rainbow afro/1/2/1/uncommon"),"524dd6ce8c8b720000000002"==Aa.last_flavor&&"52390634971a180000000003"==Aa.last_frankenflavour&&i.push("wings_bat/1/0/1/uncommon"),"523901fba4cc590000000007"===Aa.last_flavor&&"525bab2165c3460000000009"==Aa.last_addon&&(l.push("hat_astronaut/2/0/2/rare"),l.push("suit_astronaut/2/0/2/rare")),Aa.is_night&&"524dd72e8c8b720000000005"==Aa.last_flavor&&"525bab2165c3460000000009"==Aa.last_addon&&"5238fd44523fdc0000000004"==Aa.last_frankenflavour&&l.push("suit_batcow/2/1/1/rare"),"523d5c51fbdef6f047000025"==Aa.last_addon&&l.push("hat_golden afro/3/0/0/rare/Fnm04"),"524d0e141320310000000005"==Aa.last_flavor&&"523d5e603095960000000001"==Aa.last_frankenflavour&&"523d5727fbdef6f04700000c"==Aa.last_addon&&Math.random()<.2&&l.push("pet_blair/2/2/2/rare/Creeperkitty"),pa&&pa.items&&pa.items.length>3&&0===pa.items[0].indexOf("pet_blair")&&0===pa.items[1].indexOf("pet_blair")&&0===pa.items[2].indexOf("pet_blair")&&(l.push("pet_shiba/2/2/2/rare/Animefandk/doge (3)"),l.push("coat_fauxfur/3/0/1/rare/Animefandk/doge (3)"),l.push("boots_fauxfur/0/3/1/rare/Animefandk/doge (3)")),"525baa7865c3460000000006"==Aa.last_flavor&&"523903de9e47060000000002"==Aa.last_frankenflavour&&"523d5dbf171d3e0000000005"==Aa.last_addon&&l.push("mask_cthulhu/2/2/1/rare/Grakmarr"),(new Date).getHours()<2&&l.push("hat_wolf/2/2/1/rare/wolfcry");for(var c=Aa.flavors_sold.length>4,d=0;d<Aa.flavors_sold.length;d++){var p=Aa.flavors_sold[d];if(6076015>p&&(c=!1),4==d)break}c&&pa.magic_find>.1&&l.push("grabber_dino/-1/3.5/0/rare"),e&&"523d5abafbdef6f047000020"==Aa.last_addon&&"524d0d1e1320310000000004"==Aa.last_flavor&&(l.push("hat_mercow/2/2/-1/rare"),l.push("accessory_mercow/2/-1/2/rare"),l.push("tail_mercow/-1/2/2/rare")),"sprinkle"==at&&i.push("hat_cone/1/1/1/uncommon"),o>.8&&!e&&n.push.apply(n,r),o>.925&&!e&&n.push.apply(n,i),o>.975&&n.push.apply(n,l),s=n[Math.floor(Math.random()*n.length)]}var u=$("<div />",{"class":"item tooltip_click "+s,"x-num":yt.length,"x-name":s,"x-type":"item","x-from-cube":e,style:"bottom: 300px; opacity: 0; left: "+Math.floor(t)+"px",draggable:!0,html:'<div class="type_item" x-variance="'+a+'" x-type="'+s.split("/")[0]+'"></div>'});u.appendTo(".background_hill").animate({bottom:0,opacity:2},1e3),yt.push(s);{document.querySelectorAll(".item")}[].forEach.call(u,function(e){e.addEventListener("dragstart",h,!1),e.addEventListener("dragend",f,!1),e.addEventListener("drop",b,!1),e.addEventListener("dragover",w,!1)})}}function c(e,a){if(!e)return R("Could not find a cow","Error");e.items||(e.items=[]);var t=(new Date-new Date(e.created_at))/864e5,s="Baby",o="false";e.level>5&&t>12&&(s="Adult"),e.level>5&&t>32&&(s="Old",o="true");var n=e._id===pa._id?'<div class="button button_cow" x-action="rename">Rename</div><div class="button button_cow" x-action="skin">Skin</div><div class="button button_cow" x-action="adopt" x-enabled="'+o+'">'+na("Re-adopt")+"</div>":"";a&&(n='<user x-user="'+a.name+'">View '+a.name+"'s profile</user>");var r="",i="",l=[],c=0,h=0,f=0;if(e.level<5)e.skin="baby";else{for(var g=0;g<e.items.length;g++)if(e.items[g]){var b=e.items[g].split("/"),y=b[0].replace(/"/g,"").replace(/ /g,"");3>g&&(b[1]&&(c+=Number(b[1])),b[2]&&(h+=Number(b[2])),b[3]&&(f+=Number(b[3])),b[6]&&-1===l.indexOf(b[0])&&l.push(b[0])),4>g&&(i=i+'<div class="cow_attachment type_item" x-type="'+b[0]+'"></div>'),r=r+'<div class="inventory_slot" x-item="'+y+'"><img src="https://s3.amazonaws.com/icecreamstand.com/items/'+y+'.png" x-pos="'+g+'" x-name="'+e.items[g]+'" class="inventory_thumb tooltip" x-type="item" />'+(e._id==pa._id?'<div class="inventory_clear" x-num="'+g+'">+</div>':"")+"</div>"}3==l.length&&(c+=2,h+=2,f+=2)}var x=e.name.replace(/[\u00A0-\u9999<>\&]/gim,function(e){return"&#"+e.charCodeAt(0)+";"}),w=Number(e.intelligence)+Number(c),k=Number(e.strength)+Number(h),C=Number(e.constitution)+Number(f);e.total_happiness=100+Math.floor(w/2);var T=Math.ceil(e.level),I=100+(e.level-T)/.01;if(e.happiness>e.total_happiness&&(e.happiness=e.total_happiness),R('<div class="cow_inventory">'+r+'</div><div class="cow_stats"><b class="tooltip cow_card_stat" x-type="strength">Strength</b> '+k+'<br><b class="tooltip cow_card_stat" x-type="constitution">Constitution</b> '+C+'<br><b class="tooltip cow_card_stat" x-type="intelligence">Intelligence</b> '+w+'<br><br><b>Experience</b><div class="cow_card_experience" title="'+e.experience+'"><span style="width: '+I+'%"></span></div><br><b>Happiness</b><div class="cow_card_hapiness" title="'+e.happiness.toFixed(1)+"/"+e.total_happiness+'"><span style="width: '+e.happiness/e.total_happiness/.01+'%"></span></div><br><b>Bonus when happy</b> '+(k+10+e.level/2).toFixed(1)+"%<br><b>Age</b> "+t.toFixed(1)+" days ("+s+')<div class="cow_card_cow"><div class="cow_body" x-skin="'+e.skin+'"></div>'+i+'</div><div class="cow_buttons">'+n+"</div></div>",x+", lvl "+Math.floor(e.level)),e._id===pa._id){$(".inventory_slot").attr("draggable",!0);var q=document.querySelectorAll(".inventory_slot");[].forEach.call(q,function(e){e.addEventListener("dragstart",d,!1),e.addEventListener("dragend",p,!1),e.addEventListener("dragenter",u,!1),e.addEventListener("dragleave",v,!1),e.addEventListener("drop",m,!1),e.addEventListener("dragover",_,!1)})}}function d(e){this.style.opacity="1",nt=this,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("pos",$(this).find("img").attr("x-pos")),e.dataTransfer.setData("type","move_item"),$(".hovercard").remove()}function p(){$(".over").removeClass("over")}function u(){$(".over").removeClass("over"),this.classList.add("over")}function v(){$(".over").removeClass("over")}function _(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1}function m(e){if(console.log("dropping on item -> "+e.dataTransfer.getData("type")),e.preventDefault(),e.stopPropagation&&e.stopPropagation(),nt!=this&&"move_item"==String(e.dataTransfer.getData("type"))){var a=$(this).find("img").attr("x-pos"),t=e.dataTransfer.getData("pos"),s=pa.items[a];pa.items[a]=pa.items[t],pa.items[t]=s,Icecream.sync_cow(function(){T("inventory drop")},!0),oa(),c(pa)}return!1}function h(e){var a=parseInt($(this).attr("x-num"));return yt[a]!=$(this).attr("x-name")?(R("pickup ERROR - found "+yt[a]+" but picked up "+$(this).attr("x-name"),"Error"),$(this).remove(),!1):("rock"==$(this).attr("x-name")&&2==$(this).find(".type_item").attr("x-variance")&&H(this,"Coooooooo"),this.style.opacity="1",nt=this,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("num",a),e.dataTransfer.setData("type","item"),$("body").css("cursor",$(this).css("background-image")+", move !important"),$(".hovercard").remove(),void(Vt=!0))}function f(){console.log("item drag complete, cleaning up, "+Vt),$(".over").removeClass("over"),Vt&&g($(this)),$("body").css("cursor","")}function g(e){var a=parseInt($(e).attr("x-num"));if(console.log("removing "+a),isNaN(a))return!1;if($(e).remove(),0===$(".background_hill > .item").length)yt=[];else{yt.splice(a,1),console.log(yt);for(var t=a;t<=yt.length;t++)$('.background_hill > .item[x-num="'+t+'"]').attr("x-num",t-1)}window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}function b(e){return console.log("dropping on item"),$("body").css("cursor",""),e.stopPropagation&&e.stopPropagation(),Vt=!1,!1}function y(e){if($("body").css("cursor",""),e.stopPropagation&&e.stopPropagation(),nt!=this&&"item"==String(e.dataTransfer.getData("type"))){var a=parseInt(e.dataTransfer.getData("num")),t=yt[a];if("hay"==t)$(this).append('<div class="icecream_float cow_float float_hay">+1</div>'),$(".cow_float").animate({top:-50},1e3,function(){$(this).remove()}),Aa.silo_hay++,Aa.silo_hay>175+25*Aa.upgrade_silo_hay&&(Aa.silo_hay=175+25*Aa.upgrade_silo_hay),$(".silo_bar").css("height",Aa.silo_hay/(175+25*Aa.upgrade_silo_hay)/.01),g(e),Icecream.sync_cow();else if("rock"!=t){if(console.log(t),t.indexOf("rare")>-1)return Vt=!1,!1;var s=100;$(this).append('<div class="icecream_float cow_float float_hay">$'+s+"</div>"),$(".cow_float").animate({top:-50},1e3,function(){$(this).remove()}),Aa.gold+=s,qa.emit("item/sell",{value:s}),g(e)}}}function x(e){if($("body").css("cursor",""),e.stopPropagation&&e.stopPropagation(),nt!=this&&"item"==String(e.dataTransfer.getData("type"))){var a=parseInt(e.dataTransfer.getData("num")),t=yt[a];if(console.log("dropping "+t+" ("+a+") on cow"),"rock"==t)$(this).append('<div class="icecream_float cow_float float_failure">-30</div>'),$(".cow_float").animate({top:-50},1e3,function(){$(this).remove()}),pa.happiness-=30,pa.happiness<0&&(pa.happiness=0),T("cow drop: rock");else if("hay"==t)pa.happiness>=pa.total_happiness?(pa.happiness=pa.total_happiness,$(this).append('<div class="icecream_float cow_float">+0</div>')):(pa.happiness>90&&T("cow drop: hay"),pa.happiness+=10,pa.happiness>pa.total_happiness&&(pa.happiness=pa.total_happiness),$(this).trigger("mouseout").trigger("mouseover"),$(this).append('<div class="icecream_float cow_float float_success">+10</div>')),$(".cow_float").animate({top:-50},1e3,function(){$(this).remove()});else if("snowflake"==t)$(this).append('<div class="icecream_float cow_float"><img src="https://s3.amazonaws.com/icecreamstand.com/event/collectable_snowflake.png" /></div>'),$(".cow_float").animate({top:-50},1e3,function(){$(this).remove()}),qa.emit("epic"),Aa.epic_collected+=10,$(".user_epic_collected").text(Aa.epic_collected);else if("candycane"==t)$(this).append('<div class="icecream_float cow_float"><img src="https://s3.amazonaws.com/icecreamstand.com/event/collectable_candycane.png" /></div>'),$(".cow_float").animate({top:-50},1e3,function(){$(this).remove()}),qa.emit("epic"),Aa.epic_collected+=10,$(".user_epic_collected").text(Aa.epic_collected);else if(t)return pa.items||(pa.items=[]),pa.items.length>=12?(Vt=!1,R("<p>Your cow can't carry any more.</p>","Inventory Full")):(pa.items.push(t),J("545dad616c43abdf66d01472"),Icecream.sync_cow(function(){oa()},!0),!1);pa.experience+=1,pa.happiness<0&&(pa.happiness=0);var s=Math.ceil(pa.level),o=100+(pa.level-s)/.01;$(".cow_level_bar > #experience").attr("value",o),$(".cow_level_bar > #happiness").attr("x-full",pa.happiness==pa.total_happiness).attr("value",pa.happiness),Icecream.sync_cow(),g(e)}return!1}function w(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1}function k(){$(".over").removeClass("over"),this.classList.add("over")}function C(){$(".over").removeClass("over")}function T(e){e&&console.log("update_sell_value <- "+e);var a,s=0,o=Pa.length,n=0,r=za.length,i=!1;_a=null;for(var l=0;r>l;l++){var c=za[l];c._id==Aa.last_addon&&(s+=c.value,Ga=c.value);for(var d=0;5>d;d++)if("string"==typeof Aa.toppings[d]&&Aa.toppings[d]==c._id){var p=c.value;Za[d]=p;break}}A("trend"),A("event"),A("combo"),$(".banner#trending, .banner#event, .banner#combo").remove(),a=Icecream.get_flavor(Aa.last_flavor),Va=a.value;var u=parseFloat(Va);if(isNaN(u))return console.log("update sell: base is NaN");if(Aa.last_frankenflavour){var v=Icecream.get_flavor(Aa.last_frankenflavour);u=.75*(Va+v.value)}u+=et,Aa.last_flavor===ua&&Ua&&(u+=parseFloat(Ua)),Aa.last_addon===va&&va&&(u+=parseFloat(Aa.trend_bonus));for(var _=0;_<Ya.length;_++){var m=Ya[_];m.franken_id||(m.franken_id=null),m.topping_id===Aa.last_addon&&(m.flavor_id===Aa.last_flavor&&m.franken_id==Aa.last_frankenflavour||m.franken_id===Aa.last_flavor&&m.flavor_id==Aa.last_frankenflavour)&&(u+=parseFloat(m.value),$(".current_flavor").attr("x-combo",!0)[0].textContent=na(m.name),i=!0,D("combo","The active flavour is a combo, and gives a bonus when sold."),_a=m)}var h=.1*u*ut,f=u*(Aa.prestige_bonus/100),g=u+f+h;s+=g;for(var l=0;o>l;l++)for(var b=Pa[l],d=0;5>d;d++)if("string"==typeof Aa.flavors[d]&&Aa.flavors[d]==b._id){var u=b.value;b._id===ua&&""!=Ua&&(u+=parseFloat(Ua),$("#main_base .option_wrapper").eq(d).append('<img src="'+Ot+'/banner_trending_small.png" class="banner small" id="trending" />')),Aa.toppings[d]===va&&va&&(u+=parseFloat(Aa.trend_bonus),$("#main_base .option_wrapper").eq(d).append('<img src="'+Ot+'/banner_event_small.png" class="banner small" id="trending" />'));for(var _=0;_<Ya.length;_++){var m=Ya[_];if(m.flavor_id===Aa.flavors[d]&&m.topping_id===Aa.toppings[d]){u+=parseFloat(m.value),$("#main_base .option_wrapper").eq(d).append('<img src="'+Ot+'/banner_combo_small.png" class="banner small" id="combo" />');break}}var h=.1*u*parseInt($("#main_base .option_wrapper").eq(d).find(".expertise_level").text());isNaN(h)&&(console.log("NaN expertise"),h=0);var f=u*(Aa.prestige_bonus/100),g=Za[d]+u+h+f;Xa[d]=g,Ka[d]=b.value,n+=g;break}if(!i)if(Aa.last_frankenflavour)console.log("updating current flavour name (franken)"),$(".current_flavor").attr("x-combo",!1).html(ea(Aa.last_flavor,Aa.last_frankenflavour).name);else if(a){var y=$("#main_addon .selected > .option").attr("id")?na("with")+" "+$("#main_addon .selected > .option").attr("id"):"";console.log("updating current flavour name to "+a.name+" / "+y),$(".current_flavor").attr("x-combo",!1).html(a.name+" <br/>"+y)}Aa.last_flavor===ua&&""!=ua&&D("trend","You are selling a trending flavour"),Aa.last_addon===va&&""!=va&&D("event","The active add-on is part of an event and gives a bonus when sold"),Ba=parseFloat(s).toFixed(2),$(".current_value").text(Ba);var x=Aa.flavors.length>=5?5:Aa.flavors.length;Wa=n/x;var w=pa&&pa.total_bonus&&pa.happiness>=90?.01*Wa*pa.total_bonus:0;Ja=w,ha=Wa+w;var k=5-.25*Aa.upgrade_machinery,C=ot/k*ha*60+6*Aa.upgrade_autopilot*Ba;isNaN(C)?console.log("income is nan: "+ot+" - "+k+" -> "+Ba):$(".gold_sales span").text(t(C.toFixed(0))),Icecream.update_quest_bar()}function I(){R('<p><h2>Winter is Upon Ice Creamtopia!</h1>Help settle the score between two rival factions. Unlock limited time items, skins, and a badge as you pilot your team to victory.</p><p><img src="http://static.icecreamstand.ca/event/snowflakes.png" /><img src="http://static.icecreamstand.ca/event/candycanes.png" /><img src="'+Ot+'/event/collectable_snowflakes_all.png" /><img src="'+Ot+'/event/collectable_candycanes_all.png" /></p><p>The winter event lasts from December 13th to January 1st, with the winning team decided at midnight on January 1st. Candy canes and snowflakes can be found from breaking item chests or normal drops (with a 25% chance of spawning instead of hay).</p><p><a href="http://blog.samgb.com/ice-cream-stand-patch-1-44/" target="_blank">View the full patchnotes here</a></p>',"Winter Patch and Event"),$(".message").addClass("winter_alert")}function q(){ot=Aa.carts+2*Aa.employees+3*Aa.trucks+5*Aa.robots+10*Aa.rockets+15*Aa.aliens,$("#unlock_machine").attr("x-cost",15e3+15e4*Aa.upgrade_machinery),$("#unlock_machine .cost").text(t(15e3+15e4*Aa.upgrade_machinery)),$("#unlock_machine .sale_level").text(Aa.upgrade_machinery);var e=50+Aa.upgrade_flavor*Aa.upgrade_flavor*100;$("#unlock_research").attr("x-cost",e).find(".cost").text(t(e));var a=75+Aa.upgrade_addon*Aa.upgrade_addon*100;$("#unlock_addon").attr("x-cost",a).find(".cost").text(t(a));var s=1e6+3e6*Aa.upgrade_heroic;$("#unlock_heroic").attr("x-cost",s).find(".cost").text(t(s));var o=5e7+1e8*Aa.upgrade_legendary;$("#unlock_legendary").attr("x-cost",o).find(".cost").text(t(o)),$("#unlock_autopilot .unlock_text .cost")[0].textContent=t(Math.floor(ra(Aa.upgrade_autopilot,"autopilot"))),$("#unlock_autopilot .sale_level").text(Aa.upgrade_autopilot),$("#unlock_coldhands .unlock_text .cost")[0].textContent=t(Math.floor(ra(Aa.upgrade_coldhands,"coldhands"))),$("#unlock_coldhands .sale_level").text(Aa.upgrade_coldhands),$(".employees_inner .unlockable").each(function(){var e=$(this).attr("x-worker"),a=Aa[e+"s"],s=Math.floor(ra(a,e));$(this).attr("x-cost",s),$(this).find(".unlock_text .cost")[0].textContent=t(s)+" (x1)",$(this).find(".sale_level")[0].textContent=a}),$("#unlock_prestige .sale_level").text(Aa.prestige_level),$("#unlock_frankenflavour .sale_level").text(Aa.upgrade_frankenflavour),Aa.upgrade_machinery>0&&$('.option[x-type="machine"]').show(),10===Aa.upgrade_machinery&&$("#unlock_machine").hide(),250===Aa.upgrade_autopilot&&$("#unlock_autopilot").hide(),1e3===Aa.upgrade_coldhands&&$("#unlock_coldhands").hide(),3===Aa.upgrade_frankenflavour&&$("#unlock_frankenflavour").hide(),Aa.upgrade_heroic>0&&$("#unlock_heroic .sale_level").text(Aa.upgrade_heroic),Aa.upgrade_legendary>0&&$("#unlock_legendary .sale_level").text(Aa.upgrade_legendary),Aa.carts<10?$("#unlock_employee").addClass("locked"):$("#unlock_employee").removeClass("locked"),Aa.employees<10?$("#unlock_truck").addClass("locked"):$("#unlock_truck").removeClass("locked"),Aa.trucks<25?$("#unlock_robot").addClass("locked"):$("#unlock_robot").removeClass("locked"),Aa.robots<75?$("#unlock_rocket").addClass("locked"):$("#unlock_rocket").removeClass("locked"),Aa.rockets<200?$("#unlock_alien").addClass("locked"):$("#unlock_alien").removeClass("locked"),Aa.upgrade_frankenflavour>0&&$("#frankenflavour_tab").show(),3==Aa.upgrade_legendary&&$("#unlock_legendary .cost,#unlock_legendary button").hide(),Aa.carts>50&&J("52b535fd174e8f0000000001"),Aa.carts>=250&&J("52b53613174e8f0000000002"),1e3==Aa.carts&&1e3==Aa.employees&&1e3==Aa.trucks&&1e3==Aa.robots&&1e3==Aa.rockets&&1e3==Aa.aliens&&J("537bebae2b2b13b56a283b44")}function M(){$(".footer_cows").append(S(1))}function S(e){return""}function F(){if(Ha=!1,"#!donate"==location.hash&&$("#donate").click(),"#!event/winter"==location.hash&&I(),"#!u/"==location.hash.substring(0,4)&&e(location.hash.substring(4)),"en"!==Ta)for(var a=$(".lang").length,t=0;a>t;t++){var s=$(".lang").eq(t)[0];s.textContent=na(s.textContent)}$("body").attr("x-rand",Math.random()<.5),$(window).width()<800&&(Aa.is_animation_workers=!1,Aa.is_animation_clouds=!1,Aa.is_animation_cones=!1);var o={query:"id="+Aa._id+"&name="+Aa.name};if(qa=io("http://icecreamstand.ca",o),n(),Aa.titles&&"The Usurper"==Aa.titles[0]&&$("body").attr("x-epic","fallen"),La||(La=Aa.gold),Aa.dunce_until&&Icecream.first_time_dunce(),2==Aa.release_channel&&(Ot="https://s3.amazonaws.com/icecreamstand.com",console.log("ALPHA: switching off of CDN for quicker updates")),Aa.active_background||(Aa.active_background="default"),$("body").attr("x-background",Aa.active_background),Aa.upgrade_silo_hay||(Aa.upgrade_silo_hay=0),Aa.party_until&&Icecream.first_time_party(),Aa.is_animation_lore&&$(".lore").addClass("lore_float"),Aa.silo_hay||(Aa.silo_hay=0),$(".silo_bar").css("height",Aa.silo_hay/(175+25*Aa.upgrade_silo_hay)/.01),Aa.chapters_unlocked||(Aa.chapters_unlocked=[]),$(".lore").attr("x-chapters",Aa.chapters_unlocked.length),Aa.friends.length<2&&Math.random()<.1&&Aa.total_gold>200&&!Aa.is_guest&&setTimeout(function(){$.ajax({url:"/user/suggestion",dataType:"json",success:function(e){R('<p>Add some friends and help them out!</p><p>Would you like to add <b class="user_card" x-user="'+e.user+'">'+e.user+'</b> as a friend?<div class="button_container button_friendship_container"><div class="button decline_friendship">No thanks</div><div class="button accept_friendship" x-add="'+e.user+'">Sure!</div></div>',"Ice Cream Stand is better with friends!")
}})},5e3),Aa.badges){for(var t=0;t<Aa.badges.length;t++){var r=Aa.badges[t];$(".badge_inner").append('<img src="'+Ot+"/badges/"+r+'.png" class="individual_badge" x-badge="'+r+'" />')}Aa.badges[0]&&$(".badge_selector").css("background-image",'url("'+Ot+"/badges/"+Aa.badges[0]+'.png")')}$("form#new_message").attr("x-badge",Aa.badges[0]);var i=document.querySelectorAll(".cow");[].forEach.call(i,function(e){e.addEventListener("drop",x,!1),e.addEventListener("dragover",w,!1),e.addEventListener("dragenter",k,!1),e.addEventListener("dragleave",C,!1)});var i=document.querySelectorAll(".silo");[].forEach.call(i,function(e){e.addEventListener("drop",y,!1),e.addEventListener("dragover",w,!1),e.addEventListener("dragenter",k,!1),e.addEventListener("dragleave",C,!1)}),lt=!0,Icecream.get_tutorial();var l=document.getElementById("canvas_main");ga=l.getContext("2d");var l=document.getElementById("canvas_sales");ba=l.getContext("2d"),setInterval(function(){Icecream.canvas_icecream_sales()},100),setInterval(function(){Icecream.canvas_icecream_drop()},50),wa=setInterval(function(){Icecream.update_gold()},500),setInterval(function(){Qt||(Icecream.update_trending(),Icecream.update_flavors(),Icecream.cloud(3*Math.random()),setTimeout(function(){Icecream.cloud(3*Math.random())},1e4),Icecream.sync_cow())},6e4),Icecream.sync_online(),Icecream.sync_friends(),setTimeout(function(){Icecream.update_trending(),Icecream.update_flavors(),Icecream.sync_chat(),Icecream.sync_cow(),Icecream.cloud(2*Math.random()),K()},10),setTimeout(function(){Icecream.sync_messages()},2e3),ka=setInterval(function(){Icecream.process_clicks()},1e4),Icecream.employees_working(),M(),$("body").addClass(Da[Aa.release_channel]),$("#version_info").html('<a href="/stats" id="online_count" target="_blank"></a> <a href="http://blog.samgb.com/tag/ice-cream-stand/" target="_blank" id="version_num">'+ja+" "+Da[Aa.release_channel]+"</a>")}function N(e,a){$.ajax({url:"/flavors",data:{sort:"cost",limit:3*(Aa.upgrade_flavor+1)},type:"GET",dataType:"JSON",success:function(s){$("#upgrades .flavors_inner").text(""),$("#main_base .option_wrapper").remove(),Pa=s;for(var o=Aa.flavors.length,n=Pa.length,r=o-1;r>=0;r--){for(var i=Aa.flavors[r],s=0;n>s;s++)if(Pa[s]._id===i){i=Pa[s];break}var l=i.name.replace(/\W+/g,"");if(0===$("#main_base .option#"+l).length){var c=5>r?"src":"x-src";$("#main_base").prepend('<div class="option_wrapper'+(.1===i.value?" outofstock":"")+'" style="display: none;" x-new="true"><img '+c+'="'+Ot+"/flavours/thumb/"+l+'.png.gz" draggable="true" id="'+l+'"  x-id="'+i._id+'" class="option tooltip" x-base-value="'+i.base_value+'" x-value="'+i.value+'" x-type="base" /></div>')}}for(var s=0;n>s;s++){var i=Pa[s];if(-1===Aa.flavors.indexOf(i._id)){var l=i.name.replace(/\W+/g,"");$("#upgrades .flavors_inner").append('<div class="unlockable" id="'+i.name+'" x-cost="'+i.cost+'" x-id="'+i._id+'" x-new="true" x-type="base"><img src="https://s3.amazonaws.com/icecreamstand.com/flavours/thumb/'+l+'.png.gz" class="tooltip" /><div class="unlock_text">'+na(i.name)+' <span class="cost">'+t(i.cost)+"</span></div><button>Unlock</button></div>")}}$("#main_base.inner_flavor_container .option_wrapper").each(function(){$(this).parent().is(".page_wrap")&&$(this).unwrap()});for(var d=$("#main_base.inner_flavor_container .option_wrapper:gt(4)"),r=0;r<d.length;r+=15)d.slice(r,r+15).wrapAll("<div class='page_wrap' x-page='"+Math.floor(r/15)+"' style='display:none;'></div>");if(0===$("#main_base > .base_active").length&&$("#main_base").prepend('<div class="base_active"></div>'),V(),0==$("#upgrades .flavors_inner").text().length)if(Aa.upgrade_flavor<23){var p=$("#unlock_research img").attr("x-src");p&&($("#unlock_research img").attr("src",p),$("#unlock_research img").removeAttr("x-src")),$("#upgrades .flavors_inner").html($("#unlock_research")[0].outerHTML)}else if(Aa.upgrade_heroic<3){var p=$("#unlock_heroic img").attr("x-src");p&&($("#unlock_heroic img").attr("src",p),$("#unlock_heroic img").removeAttr("x-src")),$("#upgrades .flavors_inner").html($("#unlock_heroic")[0].outerHTML)}else if(Aa.upgrade_legendary<3){var p=$("#unlock_legendary img").attr("x-src");p&&($("#unlock_legendary img").attr("src",p),$("#unlock_legendary img").removeAttr("x-src")),$("#upgrades .flavors_inner").html($("#unlock_legendary")[0].outerHTML)}else $("#upgrades .flavors_inner").html("<h3>"+na("Every flavour unlocked")+"</h3>");return Icecream.paginate(bt),e&&"sort_flavour"===e&&a&&"function"==typeof a&&a(),e&&"base"===e?(a&&"function"==typeof a&&a(),$('.flavor .option[x-id="'+Aa.last_flavor+'"]').eq(0).click(),T("base"),void Icecream.update_worker_fx("main flavours")):void O(e,a)}})}function O(e,a){$.ajax({url:"/toppings",data:"cache="+Math.random(),type:"GET",dataType:"JSON",success:function(e){za=e,$("#upgrades .toppings_inner").text(""),$("#main_addon .option_wrapper").remove();for(var s=Aa.toppings.length,o=s-1;o>=0;o--){var n=Icecream.get_addon(Aa.toppings[o]),r=ns.indexOf(n.name)>-1;if(0==$('.option[x-id="'+n._id+'"]').length){var i=n.name.replace(/\s+/g,""),l=r?Ot+"/addons/thumb/"+i+".png.gz":Ot+"/toppings/"+i+"_thumb.png";$(".flavor div#main_addon").prepend('<div class="option_wrapper" x-new-art="'+r+'"><img src="'+l+'" id="'+n.name+'" x-id="'+n._id+'" class="option tooltip" x-value="'+n.value+'" x-type="addon" /></div>')}}for(var o=0;o<za.length;o++){var n=za[o];if(-1===Aa.toppings.indexOf(n._id)){var r=ns.indexOf(n.name)>-1,i=n.name.replace(/\s+/g,""),l=r?Ot+"/addons/thumb/"+i+".png.gz":Ot+"/toppings/"+i+"_thumb.png";$("#upgrades .toppings_inner").append('<div class="unlockable" id="'+n.name+'" x-cost="'+n.cost+'" x-id="'+n._id+'" x-type="addon" x-new-art="'+r+'"><div class="unlock_art_wrapper tooltip"><img src="'+l+'" /></div><div class="unlock_text">'+na(n.name)+' <span class="cost">'+t(n.cost)+"</span></div><button>"+na("Unlock")+"</button></div>")}}$("#main_addon.inner_flavor_container .option_wrapper").each(function(){$(this).parent().is(".page_wrap")&&$(this).unwrap()});for(var c=$("#main_addon.inner_flavor_container .option_wrapper:gt(4)"),o=0;o<c.length;o+=15)c.slice(o,o+15).wrapAll("<div class='page_wrap' x-page='"+Math.floor(o/15)+"' style='display:none;'></div>");if(0===$("#main_addon .base_active").length&&$("#main_addon").prepend('<div class="base_active"></div>'),Icecream.update_worker_fx("first time"),Qt||fa===Aa.upgrade_machinery||(clearInterval(xa),xa=setInterval(function(){Icecream.employees_working()},5e3),fa=Aa.upgrade_machinery,Icecream.get_quests("main topping"),$('.flavor .option[x-id="'+Aa.last_flavor+'"]').eq(0).click(),$('.flavor .option[x-id="'+Aa.last_addon+'"]').eq(0).click(),"undefined"==Aa.last_addon&&$("#main_addon .option").eq(0).click()),0==$("#upgrades .toppings_inner").text().length)if(Aa.upgrade_addon<23){var d=$("#unlock_addon img").attr("x-src");d&&($("#unlock_addon img").attr("src",d),$("#unlock_addon img").removeAttr("x-src")),$("#upgrades .toppings_inner").html($("#unlock_addon")[0].outerHTML)}else if(Aa.upgrade_heroic<3){var d=$("#unlock_heroic img").attr("x-src");d&&($("#unlock_heroic img").attr("src",d),$("#unlock_heroic img").removeAttr("x-src")),$("#upgrades .toppings_inner").html($("#unlock_heroic")[0].outerHTML)}else if(Aa.upgrade_legendary<3){var d=$("#unlock_legendary img").attr("x-src");d&&($("#unlock_legendary img").attr("src",d),$("#unlock_legendary img").removeAttr("x-src")),$("#upgrades .toppings_inner").html($("#unlock_legendary")[0].outerHTML)}else $("#upgrades .toppings_inner").html("<h3>"+na("Every add-on unlocked")+"</h3>");a&&"function"==typeof a&&a()}})}function E(e,a){return console.log("main <- "+e),e&&"base"===e?void N(e,a):e&&"addon"===e?void O(e,a):void $.ajax({url:"/me",type:"GET",dataType:"JSON",timeout:1e4,success:function(t){j(t,e,a)},error:function(){if(Nt){Nt=!1,rt++,rt>20&&(rt=20);var e=10*rt;L(na("Trying again in")+" "+e+" "+na("seconds"),"Connectivity Issues");for(var a=0;e>=a;a++)setTimeout("Icecream.reconnect("+(e-a)+")",1e3*a)}}})}function j(e,a,o){if(e.badges||(e.badges=[]),e.cones||(e.cones=[]),e.ignore?e.ignore_list=e.ignore.split(","):e.ignore="",e.upgrade_coldhands||(e.upgrade_coldhands=0),e.badge_off||(e.badge_off=!1),e.is_night?$("body:not(.night)").addClass("night"):e.is_auto_daynight&&(new Date).getHours()>20&&$("body:not(.night)").addClass("night"),!e.last_icecube_at&&e.total_gold<100&&(e.last_icecube_at=new Date),A("firstwin"),es=!1,(!e.last_icecube_at||new Date-new Date(e.last_icecube_at)>864e5)&&(es=!0,D("firstwin","Daily x2 Ice Cube Bonus available")),$(".friend_gold").remove(),e.friend_gold&&$(".floating_footer").append('<div class="friend_gold"><span class="money_icon is_white">'+t(e.friend_gold.toFixed(0))+'</span><img src="'+Ot+'/moneybag.png" id="moneybag" /></div>'),Aa=e,Ha&&F(),a&&"badges"===a&&($(".badge_inner .individual_badge").remove(),Aa.badges)){for(var n=0;n<Aa.badges.length;n++){var r=Aa.badges[n];$(".badge_inner").append('<img src="'+Ot+"/badges/"+r+'.png" class="individual_badge" x-badge="'+r+'" />')}Aa.badges[0]&&$(".badge_selector").css("background-image",'url("'+Ot+"/badges/"+Aa.badges[0]+'.png")')}Aa.release_channel>0&&(ct=!0),Aa.is_guest&&Aa.total_gold>1e3&&$("body").append('<h4 class="inline-message view_settings" id="guest" style="cursor:pointer;">'+na("Set a name and password!")+"<br /><small>"+na("Click here to save your account and set a username.")+"</small></h4>"),!Aa.email&&Aa.total_gold>2e5&&$("body").append('<h4 class="inline-message view_settings" id="guest" style="cursor:pointer;">'+na("Set an Email")+"<br /><small>"+na("Secure your account and set your email address by clicking here.")+"</small></h4>"),!Aa.email_verified&&Aa.email&&Aa.total_gold>2e5&&$("body").append('<h4 class="inline-message view_settings" id="guest" style="cursor:pointer;">'+na("Verify your email address")+"<br /><small>"+na("If you did not get a verification email go to settings to re-send.")+"</small></h4>"),$(".login #name").text(e.name).attr("x-user",e.name).prepend('<i class="fa fa-cog"></i>').css("display","inline-block"),$(".inventory_item").remove();for(var i=Aa.items,n=0;i>n;n++){var l=Aa.items[n];$(".floating_footer").append('<div class="inventory_item tooltip" x-type="inventory" x-name="'+l+'"><img src="'+Ot+"/items/"+l.replace(/\s+/g,"")+'.png" /></div>')}return q(),1e3==Aa.carts&&J("52b5361e174e8f0000000003"),Aa.display_settings||(Aa.display_settings=[1,1,1,1]),Aa.quests[1]&&"0"===Aa.quests[1].split("&")[1]||(console.log("hiding trends"),Aa.display_settings=[1,1,0,1]),(Aa.quests.length>1||Aa.quests[0]&&"0"==Aa.quests[0].split("&")[1])&&$(".tab#employees").removeClass("locked"),(Aa.quests.length>2||Aa.quests[1]&&"0"==Aa.quests[1].split("&")[1])&&(jt||(jt=!0,Icecream.update_event(),$(".trending_and_events.main_container").removeClass("hidden"))),0==Aa.display_settings[0]?$(".flavor.main_container").addClass("hidden"):$(".flavor.main_container").removeClass("hidden"),0==Aa.display_settings[1]?$(".quests.main_container").addClass("hidden"):$(".quests.main_container").removeClass("hidden"),0==Aa.display_settings[2]?$(".trending_and_events.main_container").addClass("hidden"):$(".trending_and_events.main_container").removeClass("hidden"),0==Aa.display_settings[3]?$(".chat.main_container").addClass("hidden"):$(".chat.main_container").removeClass("hidden"),1==Aa.display_settings[1]&&0==Aa.display_settings[2]&&$(".quests.main_container").removeClass("half_size"),0==Aa.display_settings[1]&&1==Aa.display_settings[2]&&$(".trending_and_events.main_container").removeClass("half_size"),0!=Aa.display_settings[2]&&0!=Aa.display_settings[1]&&($(".quests.main_container:not(.half_size)").addClass("half_size"),$(".trending_and_events.main_container:not(.half_size)").addClass("half_size")),Qa=Aa.flavors.length,P(Aa),!a||"carts"!==a&&"employees"!==a&&"trucks"!==a&&"robots"!==a&&"rockets"!==a&&"aliens"!==a&&"repaint"!==a?a&&"quest"===a?(console.log("getting quests..."),void Icecream.get_quests()):(s(),void N(a,o)):(Icecream.update_worker_fx("main workers"),T("bought worker"),void(o&&"function"==typeof o&&o()))}function D(e,a){-1===ts.indexOf(e)&&(ts.push(e),$(".buff_container").append('<div class="buff tooltip" x-type="buff" x-id="'+e+'" x-hover-text="'+a+'"></div>'))}function A(e){-1!=ts.indexOf(e)&&(ts.splice(ts.indexOf(e),1),$('.buff[x-id="'+e+'"]').remove())}function P(e){var a=e.total_prestige_gold,t=25*(a/(a+1e6));t>25&&(t=25);var s=e.flavors.length+e.toppings.length,o=s/180*25,n=parseFloat(t+o).toFixed(5);return $("#prestige_amount").text(n),n}function z(e,a){if(Nt)if(a){var t=-1,s=Math.floor(5*Math.random());if(Ka[s]>.1&&dt&&30>ht&&s<Aa.flavors.length){var o=Math.random()*Wt*.25;mt.push([s,Math.random()>.5?o:Wt-o,-90+-100*s,1]),ht=mt.length}if(t>-1&&Aa.flavors.length>5){console.time("sell_icecream oos");for(var n=$("#main_base .option_wrapper").eq(t),r=$(n)[0].outerHTML,i=(parseFloat($(n).find(".option").attr("x-base-value")),5),l="",s=5;s<Aa.flavors.length;s++)if(!$("#main_base .option_wrapper").eq(s).hasClass("outofstock")){i=s,l=$("#main_base .option_wrapper").eq(s).find(".option").attr("x-id");break}console.log(".. new place: "+i),$.ajax({url:"/switch",data:{1:$(n).find(".option").attr("x-id"),2:l},dataType:"JSON",type:"POST"});var c=Aa.flavors[t],d=Aa.flavors_sold[t];if(Aa.flavors[t]=Aa.flavors[i],Aa.flavors[i]=c,Aa.flavors_sold[t]=Aa.flavors_sold[i],Aa.flavors_sold[i]=d,!$("#main_base .option_wrapper")[i])return;$(n)[0].outerHTML=$("#main_base .option_wrapper")[i].outerHTML,$("#main_base .option_wrapper")[i].outerHTML=r,V(),T("sell icecream"),Icecream.update_worker_fx("sell icecream")}{parseFloat(ot*ha)}Aa.gold+=parseFloat(ot*ha),console.log("worker sales ("+e+"), backlog: "+os),qa.emit("sell/worker",{g:Aa.gold,d:ha,a:e,ds:Qt,v:ja,dsq:os}),os>0&&(os=0)}else console.log("ice cream sale ("+e+")"),qa.emit("sell",{g:Aa.gold,d:ha,a:e,addon:Ga,ta:va==Aa.last_addon,c:_a?_a.value:"false",e:ut,t:Ua,cbv:Va,cone:et,fp:Mt,ds:Qt,v:ja})}function L(e,a,t){var s="toast"+Math.random();a||(a="Notice"),$(".inline-message").remove(),$("body").append('<h4 class="inline-message" id="'+s+'">'+a+"<br /><small>"+e+"</small></h4>"),t||setTimeout(function(){$(".inline-message").slideUp(500,function(){$(this).remove()})},5e3)}function R(e,a){if(Kt||$("#friend_message_textarea").length>0)return Bt.unshift({msg:e,title:a}),!1;if(Jt&&Ia){if(Ia.title===a){$(".message #description").html(e),Ia.msg=e;var t=Ht-$(".message").height();return Ia.top=0>t?0:t/2,void $(".message").css("top",Ia.top)}$("body").append('<div class="alert_shadow" style="top: '+Ia.top+'px;"><h4>'+Ia.title+'</h4><span id="description">'+Ia.msg+"</span></div>"),$(".alert_shadow").each(function(){var e=$(this).offset().top-window.scrollY,a=parseInt($(this).css("margin-left")),t=$(this).css("opacity");$(this).css("top",e-20).css("margin-left",a-20+"px").css("opacity",t-.2)}),Bt.unshift(Object.create(Ia)),console.log(Bt)}Ia={msg:e,title:a},Jt=!0,$(".hovercard").remove(),"undefined"==typeof a&&(a=na("New Message")),$(".message, .darkness").remove(),$("body").append('<div class="message"><div class="message_close"><i class="fa fa-times"></i></div><h4 id="title">'+a+'</h4><span id="description">'+e+'</span></div></div><div class="darkness"></div>');var t=Ht-$(".message").height();Ia.top=0>t?0:t/2,$(".message").css("top",Ia.top)}function U(){var e=$(".message:visible"),a=Ht-e.height();e.top=0>a?0:a/2,$(".message").css("top",e.top)}function H(e,a){$(".alert_inline").remove(),$(e).prepend('<div class="alert_inline">'+a+'<div class="triangle-down"></div></div>'),setTimeout(function(){$(".alert_inline").remove()},2500)}function Y(e,a){$(".achievement_bubble").remove(),"undefined"==typeof e&&(e="unlocked"),$("body").append('<div class="achievement_bubble"><img src="'+Ot+'/achievement_thumb.png" /><span id="title">'+na("Achievement")+": "+e+'</span><span id="description">'+a+"</span></div>"),setTimeout("$('.achievement_bubble').fadeOut(1000);",1e4)}function B(e){e=e.substring(2).split("&")[0].split(",");var a=["[disaster]! Help [name] the [title] by selling [amount] [type] flavour ice cream cones.","[disaster]! Help [name] the [title] by feeding your cow [amount] bushels of hay.","[name] the [title] wants the perfect cone. Reach expertise 10 with [type] flavour",'[title] [name] needs you to sell [amount] [type] flavour ice cream cones. He says: "[disaster]."'],s=["There's a huge flood and the ice cream supply factories are closing down","Global warming is leading to a shortage of ice cream","The ice cream republic is passing a bill that will outlaw ice cream","Ice cream has been banned from schools, causing a black market ice cream trade to spring up","Gandhi threatens your ice cream stand with nuclear war if his appetite isn't quenched","Sic Semper Tyrannis! An evil tryant has just been revealed to be allergic to ice cream","He who controls the ice cream controls the universe","Sell! Sell! Sell!","Ice cream is HOT right now. Quickly before it melts","Plutonians love Ice Cream (and being told pluto is a planet), they are also very rich","Gotham is in trouble. A clown is holding hostages ransom and demands ice cream","An icey king has taken the Princess hostage. You must rescue her","A giant is rampaging across the countryside. Calm her down with some ice cream","The cold has become a real bother for me. Please sort that out"],o=["Sam","Jordi","Shai","Nubbins","Skulk","Doran","Cassia","Maaaaarrrrr","Ben","Tim","Kip","Mon Mon","Soup","Jenkins","Hatty","Davos","Joffery","Tyrion","Jessica","Scroopy Noopers","Morty","PJ"],n=["Glutinous","Malcontent","Stupendous","Enchanter","Visionary","Golden","Grumpy","Aged","Unfortunate","Sweet-tooth","Artist","Magician","Cold","Stone Cold"],r=Icecream.get_flavor(e[4]).name;return a[e[0]].replace("[disaster]",s[e[1]]).replace("[name]",o[e[2]]).replace("[title]",n[e[3]]).replace("[type]",r).replace("[amount]",t(e[5]))}function J(e){for(var a=Aa.achievements.length,t=0;a>t;t++)if(Aa.achievements[t]===e)return;Aa.achievements.push(e),$.ajax({url:"register_achievement",data:"id="+e,dataType:"JSON",type:"POST",success:function(e){e.name&&e.description?Y(e.name,e.description):console.log(e)}})}function W(){R(". . .","Achievements"),$.ajax({url:"achievements",dataType:"JSON",type:"GET",success:function(e){for(var a="",t="",s=e.length,o=Aa.achievements.length,n=0;s>n;n++){for(var r=e[n],i=!1,l=0;o>l;l++)if(Aa.achievements[l]===r._id){i=!0;break}i?a+=G(r):t+=G(r)}R("<h5>Achievement points: "+10*Aa.achievements.length+'</h5><div class="achievements_unlocked">'+a+"</div><h5>Remaining Achievements..."+S(10)+'</h5><div class="achievements_locked">'+t+"</div>","Achievements")}})}function G(e){return'<div class="achievements_container" x-id="'+e._id+'"><div class="achievement_badge">'+(e.badge_id?'<img src="'+Ot+"/badges/"+e.badge_id+'.png" />':"")+'</div><div class="achievement_descript"><b>'+e.name+"</b>"+e.description+"</div></div>"}function Q(e){if(0==Va||-1===Mt)return void console.log("expertise bp1");for(var a=Aa.flavors_sold[Mt],s=0,o=0,n=0,r=0;15>=r;r++){var i=pt[r]+n;if(15==r||i>a){s=r,15>r?o=i:(o=0,a=0,n=0);break}n=i}ut!=s&&(1==s&&J("52857dd1def8030000000001"),5==s&&J("5287a8051834ee0000000003"),10==s&&J("5287a7dd1834ee0000000002"),15==s&&J("53eac41538574559408a53e1"),Icecream.update_worker_fx("expertise"),ut=s,$('#main_base .option[x-id="'+Aa.last_flavor+'"]').parent().find(".expertise_level").text(s),T("expertise"));var l,c=100*((a-n)/(o-n));15==s?(c=100,l="MAX"):l=t(a-n)+" / "+t(o-n),0==$(".expertise_bar_outer").length?($(".sell_value").after('<div class="expertise_bar_outer tooltip" x-type="expertise"><div class="expertise_bar_inner" style="height: '+(100-c)+'%;"></div><div class="expertise_hover">'+l+'</div><div class="expertise_number">'+s+'</div><div class="expertise_ball"></div></div>'),0===Aa.total_gold&&$(".expertise_bar_outer").css("opacity",.25)):($(".expertise_bar_inner").css("height",100-c+"%"),$(".expertise_number").text(s),$(".expertise_hover").text(l)),e&&"function"==typeof e&&e()}function V(){for(var e=Aa.flavors.length,a=0;e>a;a++)for(var t=$("#main_base .option").eq(a),s=0,o=0;15>=o;o++){var n=pt[o]+s;if(Aa.flavors_sold[a]<n||15==o){0==t.parent().find(".expertise_level").length?t.after('<div class="expertise_level">'+o+"</div>"):t.parent().find(".expertise_level").text(o);break}s=n}}function X(e){tt+=e,Aa.gold+=parseFloat(Ba)*e,Mt>-1&&(Aa.flavors_sold[Mt]=parseInt(Aa.flavors_sold[Mt])+e,Q(function(){Icecream.update_quest_bar()}))}function K(){if(console.log("init canvas"),Yt!=$(document).height()){Ht=window.innerHeight,Yt=$(document).height(),Wt=$("#canvas_main").width(),$("canvas[x-resize]").each(function(){$(this).attr("width",$(this).width()),$(this).attr("height",$(this).height())});var e=$(".chat.main_container").height();$(".chat.main_container").is(":visible")||(e=0),vt=parseInt($("canvas#canvas_main").attr("width")),at&&!ya&&(ya=new Image,ya.src=Ot+"/cones/thumb/"+at+".png.gz")}for(var a=0;4>a;a++)$t[a]||($t[a]=new Image,$t[a].src=Ot+"/clouds/cloud_"+(a+1)+".png");if($a||($a=new Image,$a.src=Ot+"/scoopling_spritesheet.png"),!kt[6]){var t=Icecream.get_flavor(Aa.last_flavor);t?(kt[6]=new Image,kt[6].src=Ot+"/flavours/thumb/"+t.name.replace(/\s+/g,"")+".png.gz",Ct[6]=document.getElementById("topping")):console.log("could not find img[6]: "+Aa.last_flavor)}}function Z(){var e=$(".col_3.franken_left .option").attr("x-id"),a=$(".col_3.franken_right .option").attr("x-id");if(!e||!a)return"Select your flavours";var t=ea(e,a);return'<span id="franken_name">'+t.name+"</span><br>$"+t.value+"<br>Duration: 20 minutes"}function ea(e,a){for(var t,s,o=0;o<Pa.length;o++){var n=Pa[o];if(e===n._id&&(t=n),a===n._id&&(s=n),t&&s)break}if(!t||!s)return{name:"Mystery",value:"?"};var r=(.75*(t.value+s.value)).toFixed(2);return{name:aa(t.name,s.name),value:r}}function aa(e,a){var t=e.substring(0,e.length/2),s=a.substring(a.length/2);return t+s}function ta(){var e=$(".col_3.franken_left .option").attr("src"),a=$(".col_3.franken_right .option").attr("src");return e&&a?'<div class="franken_composite"><div class="franken_img" style="background-image: url('+e+')"></div><div class="franken_img second" style="background-image: url('+a+');"></div></div>':"&lt; - - - - - &gt;"}function sa(){pa.experience||(pa.experience=1),pa.happiness||(pa.happiness=75);for(var e=0,a=0,t=0,s=0,o=0,n=0,r=[],i=0;i<pa.items.length;i++)if(pa.items[i]){var l=pa.items[i].split("/");3>i&&(l[1]&&(e+=Number(l[1])),l[2]&&(a+=Number(l[2])),l[3]&&(t+=Number(l[3])),("hat_jester"==l[0]||"accessory_marotte"==l[0])&&(s+=.05),l[6]&&-1===r.indexOf(l[0])&&r.push(l[0])),l[0].indexOf("afro")>-1&&o++,l[0].indexOf("crown")>-1&&n++}else pa.items.splice(i,1),i--;3==r.length&&(e+=2,a+=2,t+=2),pa.con_mod=t,pa.magic_find=s,pa.total_bonus=10+pa.level/2+pa.strength+a,pa.total_happiness=100+Math.floor((pa.intelligence+e)/2);var c=(new Date-new Date(pa.created_at))/864e5;c>20&&0==pa.memories.length&&R('<p>If your cow could talk, what would it say? </p><textarea id="cow_memory"></textarea><input type="submit" class="button" value="Teach" id="cow_teach">',"Teaching "+pa.name+" to talk"),12===o&&J("546b81c020a4efc62a12e68d"),12===n&&J("547c13af8ea9309921367dca")}function oa(){if($("#unlock_cow, .cow > .cow_attachment, .cow > .cow_body").remove(),pa.items&&pa.level>=5)for(var e=0;e<pa.items.length;e++){var a=pa.items[e].split("/")[0].replace(/"/,"");if($(".cow").append('<div class="cow_attachment type_item" x-type="'+a+'">'),3===e)break}pa.level<5&&(pa.skin="baby"),$(".cow_level_bar").remove();var t=Math.ceil(pa.level),s=100+(pa.level-t)/.01;pa.skin||(pa.skin="default"),$(".cow").prepend('<div class="cow_body" x-skin="'+pa.skin+'"></div><div class="cow_level_bar"><progress id="experience" value="'+s+'" max="100"></progress><progress id="happiness" value="'+pa.happiness+'" max="'+pa.total_happiness+'" x-full="'+(pa.happiness==pa.total_happiness)+'"></progress></div>')}function na(e){if("en"===Ta)return e;var a=Et[e];return a||(console.log("language cache miss for: "+e),a=Et[e]=e),a}function ra(e,a){return"cart"==a?25+Math.pow(e,2)/4:"employee"==a?150+100*e:"truck"==a?1e3+e*e*50:"robot"==a?5e3+e*e*100:"rocket"==a?5e4+e*e*500:"alien"==a?5e5+30*Math.pow(e,2.5):"autopilot"==a?250*(e+1)*(e+1)+Math.pow(1.05,2*e):"coldhands"==a?250*Math.pow(2*e,1.6):"silo"==a?5e5+30*Math.pow(e,6):void 0}function ia(e){if(Aa.chat_off)return!1;if(!e.user)return console.log("No user attached to this message");if($('.chat[x-id="'+e._id+'"]').length>0)return console.log("Message already loaded");if(Aa.ignore_list&&Aa.ignore_list.indexOf(e.user)>-1)return!1;if(!dt){Ft++;var a=na(1==Ft?"Chat Message":"Chat Messages");document.title=Ft+" "+a+" - "+na("Ice Cream Stand"),e.text.toLowerCase().indexOf("@"+Aa.name)>-1&&(Rt=!0,document.title=e.user.substring(0,1).toUpperCase()+e.user.substring(1)+" "+na("mentioned you")+"! - "+na("Ice Cream Stand"))}if(Lt){var a=na("Unread Message!");document.title=a+" - "+na("Ice Cream Stand")}var t=[];e.is_system&&t.push("message_system"),e.is_admin&&t.push("admin"),8==e.badge&&t.push("chat_mod");var s=$("<div />",{"class":"chat "+t.join(" "),"x-id":e._id,title:e.created_at}),o=$("<span />",{html:e.text.replace(/[\u00A0-\u9999<>\&]/gim,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/(https?:\/\/[^\s]*)/g,'<a href="$1" target="_blank">$1</a>').replace(/(^| )@([^\W]*)/g,' <div class="user_card" x-user="$2">@$2</div>').replace(/:party:/g,' <img src="'+Ot+'/party.png" class="party_icon" />').replace(/:easter:/g,' <img src="'+Ot+'/easter/chocbunny.png" class="party_icon" />'),"class":"chat_textbody"});o.find("a").each(function(){var e=$(this).attr("href"),a=e.substring(e.length-4);(".png"==a||".jpg"==a||".gif"==a)&&$(this).after('<div class="img_inline" x-href="'+$(this).attr("href")+'">view</div>')}),$(s).prepend(o);var n=$("<span />",{text:e.user,"class":"user_card","x-user":e.user});e.badge&&$(n).prepend('<img src="'+Ot+"/badges/"+e.badge+'.png" class="chat_badge" />'),e.text.indexOf(":party:")>-1&&$(o).css("color","#"+Ra[Math.floor(Math.random()*Ra.length)]).css("font-weight","bold"),$(s).prepend(n),$("#chat_window").append(s);for(var r=$("#chat_window > .chat").length,i=$(".chat.main_container .expand").hasClass("active")?75:15;r>i;)$("#chat_window > .chat:first").remove(),r--}function la(e,a){var t=$('.friends_counter user[x-user="'+e+'"]');if(0===t.length){var s,o=$("<user />",{"class":a>0?"online":"offline","x-away":1==a,"x-user":e,html:'<span class="friend_options"><span class="friend_delete"></span></span>'+e});s=1==a?".friends_list_away":2==a?".friends_list_online":".friends_list_offline",$(s).append(o)}else t.attr("class",a>0?"online":"offline"),1==a?(t.attr("x-away",!0),t.detach().appendTo(".friends_list_away")):2==a?(t.attr("x-away",!1),t.detach().appendTo(".friends_list_online")):t.detach().appendTo(".friends_list_offline")}function ca(e,a,s){Zt||(Zt=1),Dt=e*Ba,Sa+=Dt,At++;t(Dt.toFixed(2));if(isNaN(Dt))return console.log("float value is NaN ("+e+" "+Ba+" "+Zt+")");10===At?($("#icecream_float_text").remove(),$(".icecream").append('<div id="icecream_float_text">Icey x2</div>'),$("#icecream_float_text").animate({top:"0"},1e3,function(){$(this).remove()}),Zt=2):30===At?($("#icecream_float_text").remove(),$(".icecream").append('<div id="icecream_float_text">Stone Cold x3</div>'),$("#icecream_float_text").animate({top:"0"},1e3,function(){$(this).remove()}),Zt=3):100===At?($("#icecream_float_text").remove(),$(".icecream").append('<div id="icecream_float_text">Frosty x4</div>'),$("#icecream_float_text").animate({top:"0"},1e3,function(){$(this).remove()}),Zt=4):150===At&&($("#icecream_float_text").remove(),$(".icecream").append('<div id="icecream_float_text">Frozen! x5</div>'),$("#icecream_float_text").animate({top:"0"},1e3,function(){$(this).remove()}),Zt=4),Kt&&($(".infocube_multiplier")[0].textContent=Zt+"x"+(es?" +2x":"")),!Pt&&Sa>Aa.highest_accumulation&&(Pt=!0);var o=$("<div />",{"class":"icecream_float",text:t(Dt.toFixed(2))});return $("body").append(o),$(o).css("color","#"+Ra[Math.floor(Math.random()*Ra.length)]).animate({"margin-top":"-100"},500,function(){$(this).remove()}),a&&s&&$(o).css("top",s).css("left",a-30),Aa.is_animation_cones&&dt&&50>ht&&(mt.push(1==e?[6,50*parseInt(Math.random()*Wt/50),90*Math.floor(-3*Math.random()),1]:[6,50*parseInt(Math.random()*Wt/50),90*Math.floor(-3*Math.random()),1.5]),ht=mt.length),!1}function da(e){var a=$(e).attr("x-src");"undefined"!=typeof a&&($(e).attr("src",a),$(e).removeAttr("x-src"))}var pa,ua,va,_a,ma,ha,fa,ga,ba,ya,$a,xa,wa,ka,Ca,Ta,Ia,qa,Ma,Sa,Fa,Na,Oa,Ea,ja="1.49",Da=["Main","Beta","Alpha"],Aa={name:"newbie",gold:0},Pa=[],za=[],La=null,Ra=["9a2f2f","5f2f9a","2f8f9a","2f9a39","919a2f","52509e","454392","4b4975","9a2f8f"],Ua=0,Ha=!0,Ya=[],Ba=0,Ja=0,Wa=0,Ga=0,Qa=0,Va=0,Xa=[0,0,0,0,0],Ka=[0,0,0,0,0],Za=[0,0,0,0,0],et=0,at="default",tt=0,st=0,ot=0,nt=null,rt=0,it={},lt=!1,ct=!1,dt=!0,pt=[15,50,150,300,600,900,1600,2400,4e3,1e4,5e4,95e3,225e3,1e6,5e6,1e7],ut=0,vt=0,_t=0,mt=[],ht=0,ft=[],gt=0,bt=null,yt=[],$t=[],xt=[],wt=!0,kt=[0,0,0,0,0,0,0],Ct=[0,0,0,0,0,0,0],Tt=0,It=0,qt="",Mt=-1,St={},Ft=0,Nt=!0,Ot="http://static.icecreamstand.ca",Et=[],jt=!1,Dt=0,At=0,Pt=!1,zt=0,Lt=!1,Rt=!1,Ut=[],Ht=0,Yt=0,Bt=[],Jt=!1,Wt=0,Gt=15,Qt=!1,Vt=!0,Xt={},Kt=!1,Zt=1,es=!1,as=[],ts=[],ss=0,os=0,ns=["cherries","sprinkles","jelly beans","peanuts","gummy worms","peanut butter","onions","honey","berry jelly","gummy sodas","blackberries","raspberries","chopped strawberries","marshmallow cream","vanilla frosting","chocolate frosting","crumbled candy bars","sugar cookies","crumbled brownies","crumbled fudge","red velvet cake","cookie dough","m&m's","oreo","chocolate chips","white chocolate chips","dark chocolate chips","pecans","acorns","almonds","gumballs","mini marshmallows","candied lemon rinds","rice","chili peppers","gravy","coconut","peas","fudge ripple","chopped peaches","chopped pineapple","croutons","fries","olives","candied bacon","bacon","shrimp","blueberries","raisins","waffles","cheese","eyeballs","bat wings","nuts and bolts","warts","oil","sausage","pepperoni","ram","egg","gold nuggets","pearls","gun powder","flowers","coffee beans","caviar","ice cubes","snowflakes","mint","telescope","calculator","constellation"],rs=["is back in Ice Creamtopia","is baaaccckkkk"," returns","joins us mortals","makes an appearance","has been summoned","apparates","appears out of thin air","emerges from the shadows","is back","swoops in","dances into view","wiggles about","pops out of a bush","can be sensed nearby","jumps out of the hay","rolled a natural 20","rolled a natural 1"];return $(document).ready(function(){function o(e){0>e&&(e=0);var a=Ea.text.split(" "),t=Math.floor(a.length/140);e>t&&(e=t);var s=e,o=a.slice(140*s,140*s+140).join(" ").replace(/\n/g,"<br>"),n='<div class="lore_page_controls"><div class="lore_pback button" x-page="'+(e-1)+'">Previous Page</div><b>'+(s+1)+" of "+(t+1)+'</b><div class="lore_pnext button" x-page="'+(e+1)+'" x-is-max="'+(e==t)+'">Next Page</div></div>';R('<p class="lore_p">'+o+"</p>"+n+(e==t?S(5):""),Ea.title),$(".message").addClass("fullscreen")}function n(e){$.ajax({url:"/chapters",data:{offset:e},dataType:"json",success:function(a){for(var t="",s=0;s<a.length;s++){var o=a[s];t=t+'<div class="lore_view_chapter" x-id="'+o._id+'"><div class="lore_bubble"></div>'+(o.badge_id?'<img src="'+Ot+"/badges/"+o.badge_id+'.png" class="chapter_badge" />':"")+'<div class="lore_inner"><b>'+o.title+"</b>"+o.saga+"</div></div>"}var n="",r=Aa.chapters_unlocked.length,i=e/6;0===a.length?t="<center>No chapters unlocked yet.</center>":n='<div class="lore_chapter_controls"><div class="lore_chap_pback button" x-page="'+(e-6)+'">Previous Page</div><b>'+(i+1)+" of "+(Math.floor(r/6)+1)+'</b><div class="lore_chap_pnext button" x-page="'+(e+6)+'" x-is-max="'+(i==Math.floor(r/6))+'">Next Page</div></div>',R(t+n,'<img class="lore_in_title" src="http://static.icecreamstand.ca/lore_noglow.png"> Lore Journal')}})}function i(){$.ajax({url:"/me",type:"GET",dataType:"JSON",success:function(e){Aa=e,$.ajax({url:"/combos",type:"GET",dataType:"JSON",success:function(e){Ya=e;
var a=Aa.combos.length;$("#main_combo p.help_text").remove(),0==a&&$("#main_combo").append('<p class="help_text">Certain combinations of Ice Cream provide bonuses. Mix and match to discover new combos.</p>');for(var t=0;a>t;t++){var s=Aa.combos[t];if(0===$('.combo_option[x-id="'+s+'"]').length){var o=Icecream.get_combo(s);if("mystery"==o.name)console.log("combo load - mystery combo");else{var n=null,r=Icecream.get_flavor(o.flavor_id),i=Icecream.get_addon(o.topping_id);o.franken_id&&(n=Icecream.get_flavor(o.franken_id));var l=ns.indexOf(i.name)>-1,c=l?Ot+"/addons/thumb/"+i.name.replace(/\W/g,"")+".png.gz":Ot+"/toppings/"+i.name.replace(/\W/g,"")+".png",d=$("<div />",{"class":"combo_option tooltip option","x-type":"combo","x-id":s,"x-addon":i._id,"x-flavor":r._id,"x-franken":o.franken_id,"x-value":o.value,"x-name":o.name,"x-new-art":l,draggable:!0,style:"background-image:url("+c+"), url("+Ot+"/flavours/thumb/"+r.name.replace(/\s+/g,"")+".png.gz)",html:o.name+(n?'<div class="combo_split" style="background-image: url('+Ot+"/flavours/thumb/"+n.name.replace(/\s+/g,"")+'.png.gz)"></div>':"")});$(".flavor div#main_combo").prepend(d),$(d).wrap('<div class="option_wrapper"></div>')}}}$("#main_combo.inner_flavor_container .option_wrapper").each(function(){$(this).parent().is(".page_wrap")&&$(this).unwrap()});for(var p=$("#main_combo.inner_flavor_container .option_wrapper:gt(4)"),t=0;t<p.length;t+=15)p.slice(t,t+15).wrapAll("<div class='page_wrap' x-page='"+Math.floor(t/15)+"' style='display:none;'></div>");$(".flavor.main_container .expand").hasClass("active")&&Icecream.paginate(0)}})}})}function l(){$(".shop_table tr:gt(5)").hide(),U()}function d(e,a,s){return e+'<tr><td><img src="https://s3.amazonaws.com/icecreamstand.com/items/'+a.replace(/\s/g,"")+'.png" class="tooltip inventory_thumb" x-type="item" x-name="'+a+"/"+s["int"]+"/"+s.str+"/"+s.con+"/"+s.rarity+'" /> '+a.replace(/_/g," - ")+'</td><td><div class="shop_button button" x-cost="'+s.cost+'" x-item="'+a+'"><span class="money_icon is_white">'+t(s.cost)+"</span></div></td></tr>"}function p(e,a,s){console.log(s);var o=s.badge;return e+'<tr><td><img src="https://s3.amazonaws.com/icecreamstand.com/badges/'+o+'.png" class="inventory_thumb" x-type="badge" /> '+a.replace(/_/g," - ")+'</td><td><div class="shop_button button" x-cost="'+s.cost+'" x-item="'+a+'" x-is-badge="true"><span class="money_icon is_white">'+t(s.cost)+"</span></div></td></tr>"}function u(e,a,s){console.log("displaying skin: "+a);var o="";if(s["match-expertise"]){var n=Icecream.get_flavor(s["match-expertise"]);o="Requires level 15 expertise with "+n.name}return s["match-item"]&&(o="Requires the item: "+s["match-item"]),s["match-badge"]&&(o='Requires the badge: <img src="'+Ot+"/badges/"+s["match-badge"]+'.png" width="25" />'),s.note&&(o=s.note),e+'<tr><td class="skin_td"  x-background="'+s.background+'"><img src="https://s3.amazonaws.com/icecreamstand.com/skins/'+a.replace(/\s/g,"").toLowerCase()+'.png" class="tooltip inventory_thumb thumb_wide" x-type="skin" x-name="'+a+'" /></td><td>'+a.replace(/_/g," - ")+'<div class="item_req">'+o+'</div></td><td><div class="shop_button button" x-cost="'+s.cost+'" x-item="'+a+'" x-is-skin="true" x-unlocked="'+(pa.skins_unlocked&&pa.skins_unlocked.indexOf(a)>-1)+'"><span class="money_icon is_white">'+t(s.cost)+"</span></div></td></tr>"}function v(){return"<table><tr><td>Total money</td><td>$"+t(Aa.total_gold.toFixed(2))+"</td></tr><tr><td>Total money this prestige</td><td>$"+t(Aa.total_prestige_gold.toFixed(2))+"</td></tr><tr><td>Today's money</td><td>$"+t(Aa.today_gold.toFixed(2))+"</td></tr><tr><td>This week's money</td><td>$"+t(Aa.week_gold.toFixed(2))+"</td></tr><tr><td>Money from friends</td><td>"+t(parseFloat(Aa.friend_total_gold).toFixed(2))+"</td></tr><tr><td>Sale Accumulation Record</td><td>"+t(Aa.highest_accumulation.toFixed(2))+"</td></tr><tr><td>Ice Cube Time Record</td><td>"+Math.floor(Aa.accumulation_time/60)+":"+Aa.accumulation_time%60+"</td></tr><tr><td>Flavours</td><td>"+Aa.flavors.length+"</td></tr><tr><td>Add-ons</td><td>"+Aa.toppings.length+"</td></tr><tr><td>Quests</td><td>"+Aa.quests.length+"</td></tr><tr><td>Ice cream sold</td><td>"+t(Aa.icecream_sold)+"</td></tr><tr><td>Sales every "+(5-.25*Aa.upgrade_machinery)+" seconds</td><td>"+ot+"</td></tr><tr><td>Hours since first win ice cube bonus:</td><td> "+((new Date-new Date(Aa.last_icecube_at))/1e3/60/60).toFixed(2)+" Hours</td></tr><tr><td>Prestige Values: </td><td>"+Aa.prestige_array.join("<br>")+"</td></tr></table>"}function _(e){console.log("marking "+e+" read"),Lt=!1,$.ajax({url:"message/read/"+e,dataType:"json",type:"post",success:function(){if(Icecream.sync_messages(),$("message-controls").length>0){var e=parseInt($("message-controls").attr("x-start"));w(e)}}})}function m(){if(Kt){var e=xt.length;if(0!==e){var a=(new Date-Ma)/1e3,s=Math.floor(a/60),o=(a%60).toFixed(1);$(".infocube_time")[0].textContent=(10>s?"0":"")+s+":"+(10>o?"0":"")+o,$(".infocube_money")[0].textContent=t(Sa.toFixed(0));var n=At/50;n>10&&(n=10);for(var r=0;e>r;r++){var i=xt[r];i&&i[4]<8&&(i[0]-=1+n,i[0]<0-n&&(h(),i[0]=200))}}}}function h(){if(console.log("... ending ice cubes"),qa.emit("accumulation",{a:Sa,t:(new Date-Ma)/1e3,is_first_win:es,flavour:Aa.last_flavor,addon:Aa.last_addon}),setTimeout(function(){$(".cube_infobar").remove(),$("#canvas_sales").hide(),xt=[],ba.clearRect(0,0,400,400)},3e3),clearInterval(Fa),Kt=!1,Zt=1,Pt){var e=$("<div />",{id:"icecream_float_text",text:"New Record "+t(Sa.toFixed(0))});$(".icecream").append(e),$(e).animate({top:"0"},3e3,function(){$(this).remove()}),Aa.highest_accumulation=Sa}if(es&&(es=!1,A("firstwin")),Bt.length>0){for(var a=0;a<Bt.length;a++){var s=Bt[a];R(s.msg,s.title)}Bt=[]}Aa.icecream_sold+=tt,z(tt,!1),tt=0,Aa.icecream_sold>=2e6&&J("5280ef1cb61b420000000009"),Aa.icecream_sold>=1e6?J("5280ef12b61b420000000008"):Aa.icecream_sold>=5e5?J("5280ef02b61b420000000006"):Aa.icecream_sold>=1e5?J("5280eee1b61b420000000004"):Aa.icecream_sold>=1e4?J("5280eeeab61b420000000005"):Aa.icecream_sold>=1e3?J("5280ee78b61b420000000003"):Aa.icecream_sold>=100&&J("5280ee5fb61b420000000001"),0===Aa.quests.length&&Icecream.get_quest("cubes"),Icecream.get_tutorial()}function f(e,a){for(var t=0;t<xt.length;t++){var s=xt[t];if(b(s[1],e,s[2],a,50))return!0}return!1}function g(e){var a=190,t=175;if(At>2)do a=65+275*Math.random(),t=65+275*Math.random();while(f(a,t));if(e)return void xt.push([150,a,t,30,Math.floor(7*Math.random())+8]);var s=Math.floor(At/10);s>6&&(s=6),xt.unshift([100,a,t,30,s+1]),s>2&&g(!0),s>5&&g(!0),7===s&&g(!0)}function b(e,a,t,s,o){return e>a-o&&a+o>e&&t>s-o&&s+o>t}function y(e,a,t){e||a&&(e=a,a=""),t||(t=""),R((a?"<p>"+a+"</p>":"")+'<textarea id="friend_message_textarea" placeholder="Message">'+t+'</textarea><button x-user="'+e+'" id="friend_message_button">Send</button>',na("Message")+" "+e.substring(0,1).toUpperCase()+e.substring(1)),$("#friend_message_textarea").select().focus()}function x(e){$(".thread_active").removeClass("thread_active"),$('.mailbox_list > .thread_user[x-user="'+e+'"]').addClass("thread_active"),$(".mailbox_thread")[0].textContent="",$.ajax({url:"messages/read/"+e+"/"+Aa.name,dataType:"json",success:function(a){for(var t=a.length,s=0;t>s;s++){var o=a[s],n=$("<div />",{"class":"thread_msg","x-align":e==o.from?"left":"right","x-read":Boolean(o.is_read),text:o.text});s>5&&n.hide(),$(".mailbox_thread").prepend(n)}t>5&&$(".mailbox_thread").prepend('<div class="thread_controls"><b>'+(t-6)+'</b><i class="fa fa-arrow-up"></i></div>'),$(".mailbox_thread").prepend('<div class="thread_controls_down"><b></b><i class="fa fa-arrow-down"></i></div>'),$(".mailbox_thread").append('<form action="message" method="post" class="thread_msg thread_reply" x-align="right"><textarea></textarea><input type="submit" class="button button_green" value="Send" style="display: none;"></div>'),$(".mailbox_thread").scrollTop(1e4),U()}})}function w(e,a){a||(a=5),console.log("displaying messages "+e+" - "+(e+a)),$.ajax({url:"messages",data:{start:e},success:function(t){var s="",o=t.length;if(0==o)s="<tr><td>-</td><td>You have no messages</td></tr>";else for(var n=0;o>n;n++){var r=t[n];if(r){var i=r.is_read?"Unread":"Read",l=(new Date(r.created_at)+"").split(" "),c=r.badge_id?'<img src="'+Ot+"/badges/"+r.badge_id+'.png" class="message_badge" />':"";s=s+'<tr><td id="message_status_'+i+'"><user x-user="'+r.from+'">'+c+r.from+"</user><time>"+[l[1],l[2],l[4]].join(" ")+'</time></td><td class="message_body">'+r.text.replace(/(<|>)/gi,"")+'</td><td class="message_options" x-id="'+r._id+'"><span id="message_mark_read">Mark '+i+'</span><span class="friend_reply" x-user="'+r.from+'"></span><span id="message_remove">X</span></td></tr>'}if(n>=a)break}var d="Messages "+e+" to "+(e+a);e>0&&(d="<message-prev>Back</message-prev>"+d),5===o&&(d+="<message-next>Next</message-next>"),R('<table id="message_list">'+s+'</table><message-controls x-start="'+e+'" x-len="'+a+'">'+d+'</message-controls><div id="compose_message"><input id="compose_to" placeholder="Player"><button id="compose_send">Write</button></div>',"Private Messages")}})}function k(e){$.ajax({url:"friend/new",data:{friend:e},type:"POST",dataType:"JSON",success:function(a){var t=e.substring(0,1).toUpperCase()+e.substring(1);return a.err?R(a.err,"Can not add friend"):(Aa.friends=a.friends,Tt="",Icecream.sync_friends(),void R("Added "+t+" as a friend!","New Friend"))}})}function C(e,a){for(var t=50,s=120,o=0;ht>o;o++){var n=mt[o],r=n[1],i=n[2];if(e>r&&r+t>e&&a>i&&i+s>a){ga.clearRect(n[1],n[2]-25,50*n[3],100*n[3]),ft.push({x:n[1],y:n[2]-10,width:68.5*n[3],height:50*n[3],speed:Math.random()<.5?-5:5,variation:Math.floor(4*Math.random())}),gt++,mt.splice(o,1),ht--;for(var o=0;2>o;o++)$(".icecream").trigger("mousedown")}}}Ta=$("html").attr("lang"),_t=$(document).height(),"en"!==Ta&&$.ajax({url:Ot+"/"+$("html").attr("lang")+".json.gz",type:"GET",dataType:"JSON",success:function(e){Et=e},error:function(e){console.log("error loading languages: "+e)}}),user_start?j(user_start,"start"):E(),$("body").on("click",".lore_pback, .lore_pnext",function(){$(".message_close:visible").click(),o(Number($(this).attr("x-page")))}),$("body").on("click",".lore_chap_pback, .lore_chap_pnext",function(){$(".message_close:visible").click(),n(Number($(this).attr("x-page")))}),$("body").on("click",".share_frankenflavour",function(){var e=$(".franken_left img").attr("x-id"),a=$(".franken_right img").attr("x-id");return e&&a?($.ajax({url:"/facebook/share/frankenflavour/"+e+"/"+a}),$(this).html('<i class="fa fa-facebook"></i> Thank you!'),!1):(L("Please select both flavours","Error"),!1)}),$("body").on("click",".lore_view_chapter",function(){$.ajax({url:"/chapter/"+$(this).attr("x-id"),dataType:"json",success:function(e){Ea=e,o(0)}})}),$("body").on("click",'.lore, [x-link="lore"]',function(){n(0)}),$("body").on("click",".flavor .flavor_tab",function(){var e=$(this).attr("x-id");if($(".flavor .inner_flavor_container").hide(),$("#"+e).show().find("img[x-src]").each(function(){var e=$(this).attr("x-src");"undefined"!=typeof e&&$(this).attr("src",e).removeAttr("x-src")}),$(".flavor .flavor_tab.active").removeClass("active"),$(this).addClass("active"),bt>0&&(bt=0),Icecream.paginate(bt),"main_combo"==e)i();else if("main_franken"==e){$("#main_franken").remove();var a='<a href="/facebook/share/frankenflavour" class="button button_facebook share_frankenflavour" x-require-facebook="true"><i class="fa fa-facebook"></i> Share Frankenflavour</a>';$(".flavor").append('<div class="inner_flavor_container" id="main_franken"><div class="col_3 franken_left"><div class="option_wrapper" x-franken="franken_left"></div></div><div class="col_3 franken_center"><b>&lt; - - - - - &gt;</b><p>Select your flavours<br><br></p><button class="button_green">Combine!</button><br><br>'+a+S(3)+'</div><div class="col_3 franken_right"><div class="option_wrapper" x-franken="franken_right"></div></div></div>')}K()}),$("body").on("click",".franken_option",function(){for(var e,a=$(this).text(),t=Pa.length,s=0;t>s&&(e=Pa[s],e.name!=a);s++);var o=e.name.replace(/\s+/g,"");$('.option_wrapper[x-franken="'+$(this).closest(".franken_selector").attr("x-franken")+'"]').html('<img x-type="base" x-value="'+e.value+'" x-base-value="'+e.base_value+'" class="option tooltip" x-id="'+e._id+'" id="'+o+'" src="'+Ot+"/flavours/thumb/"+o+'.png.gz">'),$(".franken_selector").remove(),$(".franken_center p").html(Z()),$(".franken_center b").html(ta())}),$("body").on("click","#main_franken button",function(){var e=$(".col_3.franken_left .option").attr("x-id"),a=$(".col_3.franken_right .option").attr("x-id");return e&&a&&e!=a?void $.ajax({url:"/last/franken",data:{one:e,two:a},dataType:"json",type:"POST",success:function(t){return t.message?R(t.message):(Aa.last_flavor=e,Aa.last_frankenflavour=a,Aa.last_frankenflavour_at=new Date,E("base"),void _gaq.push(["_trackEvent","Flavour","Combined a frankenflavour",$("#franken_name").text()]))}}):R("Please select two different flavours to combine.")}),$("body").on("click","#main_franken .option_wrapper",function(e){$(".franken_selector").remove(),$(".flavor.main_container").after('<div class="franken_selector" x-franken="'+$(this).attr("x-franken")+'"><div class="selector_nav"><div class="col_3 active" x-show="selector_normal">Normal</div><div class="col_3" x-show="selector_heroic">Heroic</div><div class="col_3" x-show="selector_legendary">Legendary</div></div><p id="selector_normal"></p><p id="selector_heroic" style="display: none;"></p><p id="selector_legendary" style="display: none;"></p><div class="franken_close">Close</div></div>');for(var a=Pa.length,t=0;a>t;t++)72>t?$(".franken_selector p#selector_normal").append('<div class="franken_option">'+Pa[t].name+"</div>"):81>t&&Aa.upgrade_frankenflavour>=2?$(".franken_selector p#selector_heroic").append('<div class="franken_option">'+Pa[t].name+"</div>"):3==Aa.upgrade_frankenflavour&&$(".franken_selector p#selector_legendary").append('<div class="franken_option">'+Pa[t].name+"</div>");return e.stopPropagation(),e.stopImmediatePropagation(),!1}),$("body").on("click",".franken_selector .col_3",function(){$(".franken_selector .col_3").removeClass("active"),$(this).addClass("active");var e=$(this).attr("x-show");$(".franken_selector p").hide(),$(".franken_selector p#"+e).show()}),$("body").on("click",".franken_close",function(){$(".franken_selector").remove()}),$("body").on("click",".highscores .button_container .flavor_tab, .highscores .flavor_tab#hide",function(){return"hide"==$(this).attr("id")?($(".highscores").hide(),void K()):($(this).parent().find(".active").removeClass("active"),$(this).addClass("active"),void $(".refresh_highscores").click())}),$("body").on("click",".tab",function(){return $(this).hasClass("locked")?!1:($(".tab.active").removeClass("active"),$(this).addClass("active"),$(".flavors_inner, .employees_inner, .upgrades_inner, .toppings_inner, .cones_inner").hide(),$("."+$(this).attr("id")+"_inner").show(),void $("."+$(this).attr("id")+"_inner img[x-src]").each(function(){var e=$(this).attr("x-src");"undefined"!=typeof e&&$(this).attr("src",e).removeAttr("x-src")}))}),$("body").on("click",".controls_forward",function(){return $(".tab#flavors").hasClass("active")&&$(".flavors_inner .unlockable:visible").slice(0,5).hide(),$(".tab#toppings").hasClass("active")&&$(".toppings_inner .unlockable:visible").slice(0,5).hide(),!1}),$("body").on("click",".controls_show",function(){return $(".tab#flavors").hasClass("active")&&($(".flavors_inner .unlockable:hidden").show(),$(".flavors_inner").css("overflow-y","scroll")),$(".tab#toppings").hasClass("active")&&($(".toppings_inner .unlockable:hidden").show(),$(".toppings_inner").css("overflow-y","scroll")),!1}),$("body").on("click",".controls_back",function(){return $(".tab#flavors").hasClass("active")&&$(".flavors_inner .unlockable:hidden").slice(-5).show(),$(".tab#toppings").hasClass("active")&&$(".toppings_inner .unlockable:hidden").slice(-5).show(),!1}),$("body").on("click",".flavor .expand",function(){$(".page_wrap").hide(),$(this).hasClass("active")?($("#main_base, #main_addon, #main_combo, #main_cone").removeClass("expanded").css("overflow","hidden"),$(this).text("Expand").removeClass("active"),$(".filter_box").remove(),bt=null):(bt=0,$("#main_base, #main_addon, #main_combo, #main_cone").addClass("expanded").css("overflow","visible"),Icecream.paginate(bt),$(this).text("Minimize").addClass("active")),K()}),$("body").on("click",".quests .expand",function(){$(this).hasClass("active")?($(".quest").hide(),$(".quest:first").show(),$(this).text("Expand").removeClass("active")):($(".quest").show(),$(this).text("Minimize").addClass("active")),K()}),$("body").on("click",".shop_button",function(){var e=$(this).attr("x-item"),a="true"==$(this).attr("x-is-skin"),t="true"==$(this).attr("x-is-badge"),s=parseInt($(this).attr("x-cost"));if(!isNaN(s)&&Aa.gold<s)return R("<p>You need more money to buy this item!</p>","Can not Afford");if(!pa)return R('<p>"Come back when you have a cow."</p><p>Who said that? You only see a cart.</p>',"A talking cart?");if(e&&!a&&!t){if(pa.items.length>=12)return R("<p>Your inventory is full</p>","Inventory Full");R('<p>Success! You have purchased <b class="tooltip" x-type="item" x-name="'+e+'">'+e.replace(/_/g," - ")+"</b> for "+pa.name+".</p>","Purchased")}return a&&pa.skins_unlocked&&pa.skins_unlocked.indexOf(e)>-1?R("<p>You already own the <b>"+e+"</b> cow skin.</p>","Already own"):void $.ajax({url:"/shop/item",data:{item:e},dataType:"json",type:"post",success:function(e){return e.error?R(e.error):(isNaN(s)||(Aa.gold=Aa.gold-parseInt(s)),e.gamble?(pa={},Icecream.sync_cow(function(){oa(),T("shopping")}),R('<p>Success! You have found a <b class="tooltip" x-type="item" x-name="'+e.gamble+'">'+e.gamble.split("/")[0].replace(/_/g," - ")+"</b> for "+e.cow.name+".</p>","Mystery Item")):e.unlocked_skin?(pa.skins_unlocked||(pa.skins_unlocked=[]),pa.skins_unlocked.push(e.unlocked_skin),R("<p>Success! You have unlocked the <b>"+e.unlocked_skin+"</b> skin for "+pa.name+".</p>","Skin Unlocked")):e.unlocked_badge?(Aa.badges.push(msg.add_badge),E(),R("<p>Success! You have unlocked a new badge.</p>","Badge Unlocked")):(pa=e,oa(),void E()))}})}),$("body").on("click",".chat.main_container .expand",function(){$(this).hasClass("active")?($(".chat.main_container").attr("x-expand",!1),$("#chat_window").css("overflow-y","hidden"),$(this).text("Expand").removeClass("active")):($(".chat.main_container").attr("x-expand",!0),$("#chat_window").css("overflow-y","scroll"),$(this).text("Minimize").addClass("active")),qt="",$("#chat_window").text(""),Icecream.sync_chat()}),$("body").on("click",".tooltip_click",function(){$(this).addClass("tooltip").trigger("mouseover")}),$("body").on("mouseout",".option, .unlockable, .tooltip, .hovercard",function(){$(".hovercard").remove(),$(this).hasClass(".tooltip_click")&&$(this).removeClass(".tooltip")}),$("body").on("click",".shop",function(){$.ajax({url:"https://s3.amazonaws.com/icecreamstand.com/shop.json.gz",data:{cache:Math.random()},dataType:"json",success:function(e){var a='<tr><td><img src="https://s3.amazonaws.com/icecreamstand.com/gamble.png" class="tooltip inventory_thumb" x-type="gamble" /> Mystery Item</td><td><div class="shop_button button" x-cost="250000"><span class="money_icon is_white">250,000</span></div></td></tr>',t="",s="";for(var o in e){var n=e[o],r=n.cost;(!r||isNaN(r))&&(r=0),"skin"==n.type?t=u(t,o,n):"badge"==n.type?s=p(s,o,n):n["match-name"]?n["match-name"]==Aa.name&&(a=d(a,o,n)):n["match-badge"]?Aa.badges&&Aa.badges.indexOf(n["match-badge"])>-1&&(a=d(a,o,n)):n["match-epic"]?(console.log(n["match-epic"]+" - "+Aa.epic_id),Aa.epic_id&&Aa.epic_id==n["match-epic"]&&(!n["match-epic-collected"]||Aa.epic_collected>n["match-epic-collected"])&&(a=d(a,o,n))):r&&(a=d(a,o,n))}R('<div class="shop_nab button_container"><div class="settings_tab" x-active="true" x-area="shop_tab_items" x-type="shop">Items</div><div class="settings_tab" x-area="shop_tab_skins" x-type="shop">Skins</div><div class="settings_tab" x-area="shop_tab_badges" x-type="shop">Badges</div></div><table class="shop_table settings_area" x-active="true" x-index="0" x-page="5" x-area="shop_tab_items">'+a+'</table><table class="shop_table settings_area" x-area="shop_tab_skins" x-index="0" x-page="3">'+t+'</table><table class="shop_table settings_area" x-area="shop_tab_badges" x-index="0" x-page="5">'+s+'</table><div class="shop_page_container"><div onclick="Icecream.shop_paginate(-1)" class="filter_prev button"><img src="http://static.icecreamstand.ca/arrow.svg"></div><div onclick="Icecream.shop_paginate(1)" class="filter_next button"><img src="http://static.icecreamstand.ca/arrow_right.svg"></div></div>',"Bovine Boutique"),l()},error:function(e,a){console.log(a),R("The shop is closed.","Come back later!")}})}),$("body").on("click",".inline-message",function(){$(this).hide()}),$("body").on("mouseover",".worker_increment",function(){var e=$(this).closest(".unlockable"),a=Number($(this).attr("x-amount")),s=e.attr("x-type").replace("sales_",""),o=Number(e.find(".sale_level").text());if(o>=1e3)return void(e.find(".cost")[0].textContent="Maxed");for(var n=0,r=0,i=o;o+a>i;i++){var l=ra(i,s);if(n+=l,r++,n>Aa.gold||i>=1e3)break}e.find(".cost")[0].textContent=t(Math.floor(n))+" (x"+r+")"}),$("body").on("mouseover",".tooltip",function(){if(!($(".hovercard").length>0)&&Aa.is_tooltip){$("body").append('<div class="hovercard"><div></div></div>');var e=$(this).offset().left;e>$(document).width()-250&&(e=$(document).width()-250),$(".hovercard").css("left",e);var a,s=document.documentElement,o=(window.pageYOffset||s.scrollTop)-(s.clientTop||0),n=$(this).offset().top-20;150+o>n&&(n+=225,a=!0),$(".hovercard").css("top",n-o);var r=$(this).attr("x-type"),i=$(this).attr("x-id"),l=this;if(!r){r=$(this).parent().attr("x-type");var i=$(this).parent().attr("x-id");l=$(this).parent()}if("sales_cart"==r){var c=5-.25*Aa.upgrade_machinery,d=Aa.carts/c*60,p=d*Wa;$(".hovercard").html('<div class="hover_title">'+na("Cart")+'<span class="level">'+Aa.carts+"</span></div><p>"+na("Automatically sells 1 ice cream every")+" "+(5-.25*Aa.upgrade_machinery)+" "+na("seconds")+". You earn $"+t(Math.floor(p))+' from carts every minute.</p><p class="flavor_text">'+na("Workers sell your top row. Can be leveled up to 1000.")+"</p>")}else if("sales_employee"==r){var c=5-.25*Aa.upgrade_machinery,d=2*Aa.employees/c*60,p=d*Wa;$(".hovercard").html('<div class="hover_title">'+na("Employees")+'<span class="level">'+Aa.employees+"</span></div><p>"+na("Automatically sells 2 ice cream every")+" "+(5-.25*Aa.upgrade_machinery)+" "+na("seconds")+". You earn $"+t(Math.floor(p))+' from employees every minute.</p><p class="flavor_text">'+na("Workers sell your top row. Can be leveled up to 1000.")+" "+na("Unlocks after you have 10 Carts.")+"</p>")}else if("sales_truck"==r){var c=5-.25*Aa.upgrade_machinery,d=3*Aa.trucks/c*60,p=d*Wa;$(".hovercard").html('<div class="hover_title">'+na("Truck")+'<span class="level">'+Aa.trucks+"</span></div><p>"+na("Automatically sells 3 ice cream every")+" "+(5-.25*Aa.upgrade_machinery)+" seconds. You earn $"+t(Math.floor(p))+' from trucks every minute.</p><p class="flavor_text">Workers sell your top row. Can be leveled up to 1000. Unlocks after you have 10 Employees.</p>')}else if("sales_robot"==r){var c=5-.25*Aa.upgrade_machinery,d=5*Aa.robots/c*60,p=d*Wa;$(".hovercard").html('<div class="hover_title">'+na("Robot")+'<span class="level">'+Aa.robots+"</span></div><p>"+na("Automatically sells 5 ice cream every")+" "+(5-.25*Aa.upgrade_machinery)+" seconds. You earn $"+t(Math.floor(p))+' from robots every minute.</p><p class="flavor_text">Workers sell your top row. Can be leveled up to 1000. Unlocks after you have 25 Trucks.</p>')}else if("sales_rocket"==r){var c=5-.25*Aa.upgrade_machinery,d=10*Aa.rockets/c*60,p=d*Wa;$(".hovercard").html('<div class="hover_title">'+na("Rocket")+'<span class="level">'+Aa.rockets+"</span></div><p>"+na("Automatically sells 10 ice cream every")+" "+(5-.25*Aa.upgrade_machinery)+" seconds. You earn $"+t(Math.floor(p))+' from rockets every minute.</p><p class="flavor_text">Workers sell your top row. Can be leveled up to 1000. Unlocks after you have 75 Robots.</p>')}else if("sales_alien"==r){var c=5-.25*Aa.upgrade_machinery,d=15*Aa.aliens/c*60,p=d*Wa;$(".hovercard").html('<div class="hover_title">'+na("Alien")+'<span class="level">'+Aa.aliens+"</span></div><p>"+na("Automatically sells 15 ice cream every")+" "+(5-.25*Aa.upgrade_machinery)+" seconds. You earn $"+t(Math.floor(p))+' from aliens every minute.</p><p class="flavor_text">Workers sell your top row. Can be leveled up to 1000. Unlocks after you have 200 Rockets.</p>')}else if("machine"==r)$(".hovercard").html('<div class="hover_title">'+na("Machinery")+'<span class="level">'+Aa.upgrade_machinery+"</span></div><p>Increases the speed that your workers make ice cream. Currently it takes them "+(5-.25*Aa.upgrade_machinery)+" seconds, level up to decrease it by .25s</p>");else if("research"==r)$(".hovercard").html('<div class="hover_title">'+na("Flavor research")+'<span class="level">'+Aa.upgrade_flavor+"</span></div><p>Each level unlocks 3 new flavors of ice cream</p>");else if("research_addon"==r)$(".hovercard").html('<div class="hover_title">'+na("Add-on research")+'<span class="level">'+Aa.upgrade_addon+"</span></div><p>Each level unlocks 3 new add-ons for your ice cream</p>");else if("trending"==r)$(".hovercard").html('<div class="hover_title">Trending</div>This flavour is in demand! Sell it quickly while it\'s hot. As it gets sold more it becomes less popular.<p class="flavor_text">Every 1,000 sales reduces the bonus by $0.05. After 75,000 sales the trend cycles out.</p>');else if("adopt_cow"==r)$(".hovercard").html('<div class="hover_title">'+na("Adopt a Cow")+'</div>Adopt a helper to increase your Ice Cream sales. Cows can equip items, and have ability scores (Strength, Constitution, Intelligence).<p class="flavor_text">Cows persist through prestige. Adoption has a $100 fee.</p>');else if("friend"==r)$(".hovercard").html('<div class="hover_title">'+na("Friend")+"</div><p>Make the Ice Cream Stand more exciting and play with friends. Every day your friends get a bonus .01% of any money you earn. This doesn't take away from what you earn. It's a fascimile of social interaction that gives you some of the benefits.</p>");else if("search"==r)$(".hovercard").html('<div class="hover_title">'+na("Search")+"</div><p>Search for a player...</p>");else if("skin"==r)$(".hovercard").html('<div class="hover_title">'+$(this).attr("x-name")+"</div><p>This is a skin for your cow.</p>"),$(".hovercard").css("z-index",12);else if("background"==r)$(".hovercard").html('<div class="hover_title">'+$(this).attr("x-value")+"</div><p>This is a custom skin for Ice Cream Stand.</p>"),$(".hovercard").css("z-index",12);else if("buff"==r){var u=$(this).attr("x-hover-text");$(".hovercard").html('<div class="hover_title">'+$(this).attr("x-id")+"</div><p>"+u+"</p>")}else if("silo"==r)$(".hovercard").html('<div class="hover_title">Silo</div><p>You can store up to 175 bushels of hay here. Instead of your cow losing happiness, it will instead consume hay from the silo. You are using '+Aa.silo_hay.toFixed(1)+"/"+(175+25*Aa.upgrade_silo_hay)+".</p>");else if("item"==r){var v=0,_=0,m=0,h="",f=$(this).attr("x-name"),g=f.split("/"),b=g[0].replace(/_/g,": ");g[1]&&!isNaN(g[1])&&(v=g[1]),g[2]&&!isNaN(g[2])&&(_=g[2]),g[3]&&!isNaN(g[3])&&(m=g[3]);var y=g[4]?'<p class="rarity" x-rarity="'+g[4]+'">'+g[4]+"</p>":"";("hat: jester"==b||"accessory: marotte"==b)&&(h='<p class="flavor_text">Improves your chances of finding rare items by 5%</p>'),"hat: birthday"==b&&(h='<p class="flavor_text">Only available on birthdays. Allows the wearer to /party.</p>'),g[5]&&(h='<p class="flavor_text">Created by '+g[5]+"</p>"),g[6]&&(h=h+'<p class="flavor_text">This item is part of the <b>'+g[6]+"</b> set.<br><small>Equipping all 3 items of this set gives +2 to each stat.</small></p>");var x="<p><b>Strength</b>: "+_+"<br><b>Constitution</b>: "+m+"<br><b>Intelligence</b>: "+v+"</p>";"hay"==f&&(g[0]="hay_0",x="This item <b>increases Happiness</b> by 10. Drag this onto your cow to gain experience, or onto your silo to be automatically used when your cow is hungry."),"rock"==f&&(x="This item <b>decreases Happiness</b> by 40. Drag this onto your cow."),$(".hovercard").addClass("auto_height").html('<div class="hover_title" style="padding-left: 40px;">'+b+'</div><img src="'+Ot+"/items/"+g[0].replace(/ /g,"")+'.png" class="tooltip_item" />'+x+y+h),$(".hovercard").css("z-index",12).css("margin-top",-1*$(".hovercard").height())}else if("gamble"==r)$(".hovercard").html('<div class="hover_title">'+na("Mystery Item")+"</div><p>This will give you a mystery item, including items not normally available.</p>"),$(".hovercard").css("z-index",12);else if("strength"==r)$(".hovercard").html('<div class="hover_title">Strength</div><p>Strength increases the % bonus increase of your cow. Every 1 point of strength gives an additional 1% bonus to income.</p>'),$(".hovercard").css("z-index",12);else if("constitution"==r)$(".hovercard").html('<div class="hover_title">Constitution</div><p>Constitution decreases the rate at which your happiness declines. Each point in constitution decreases the decline rate by 5%.</p>'),$(".hovercard").css("z-index",12);else if("intelligence"==r)$(".hovercard").html('<div class="hover_title">Intelligence</div><p>Intelligence increases the total amount of happiness your cow can have. Every 2 points of intelligence increase your total happiness by 1.</p>'),$(".hovercard").css("z-index",12);else if("autopilot"==r)$(".hovercard").html('<div class="hover_title">'+na("Autopilot")+'<span class="level">'+Aa.upgrade_autopilot+"</span></div><p>automatically sells your active flavor for you. Selling once every 10 seconds per level of autopilot.</p><p>It can be leveled up to 250.</p>");else if("coldhands"===r)$(".hovercard").html('<div class="hover_title">'+na("Cold Hands")+'<span class="level">'+Aa.upgrade_coldhands+"</span></div><p>Clicking an Ice Cube sells an additional 0.25 Ice cream.</p><p>It can be leveled up to 1000.</p>");else if("shop"===r)$(".hovercard").html('<div class="hover_title">'+na("The Bovine Boutique")+"</div><p>Buy powerful items for your cow.</p>");else if("cone"===r)i||(i=$(this).find(".option").attr("x-id")),$(".hovercard").html("baby"===i?'<div class="hover_title">Baby Cone <span class="level flavor_current money_icon is_white">0.10</span></div><p>This cone gives a bonus with every sale.</p><p class="flavor_text">Cones only affect your sales and your autopilot sales. Cones persist through prestige and are affected by prestige and expertise.</p>':"waffle"===i?'<div class="hover_title">Waffle Cone <span class="level flavor_current money_icon is_white">0.25</span></div><p>This cone gives a bonus with every sale.</p><p class="flavor_text">Cones only affect your sales and your autopilot sales. Cones persist through prestige and are affected by prestige and expertise.</p>':"chocolate"===i?'<div class="hover_title">Chocolate Dipped Cone <span class="level flavor_current money_icon is_white">0.50</span></div><p>This cone gives a bonus with every sale.</p><p class="flavor_text">Cones only affect your sales and your autopilot sales. Cones persist through prestige and are affected by prestige and expertise.</p>':"whitechocolate"==i?'<div class="hover_title">White Chocolate Cone <span class="level flavor_current money_icon is_white">0.75</span></div><p>This cone gives a bonus with every sale.</p><p class="flavor_text">Cones only affect your sales and your autopilot sales. Cones persist through prestige and are affected by prestige and expertise.</p>':"sugar"==i?'<div class="hover_title">Sugar Cone <span class="level flavor_current money_icon is_white">1.00</span></div><p>This cone gives a bonus with every sale.</p><p class="flavor_text">Cones only affect your sales and your autopilot sales. Cones persist through prestige and are affected by prestige and expertise.</p>':"sprinkle"==i?'<div class="hover_title">Sprinkle Cone <span class="level flavor_current money_icon is_white">1.25</span></div><p>This cone gives a bonus with every sale.</p><p class="flavor_text">Cones only affect your sales and your autopilot sales. Cones persist through prestige and are affected by prestige and expertise.</p>':"mintycat"==i?'<div class="hover_title">Minty Cat Cone <span class="level flavor_current money_icon is_white">1.50</span></div><p>This cone gives a bonus with every sale.</p><p class="flavor_text">Cones only affect your sales and your autopilot sales. Cones persist through prestige and are affected by prestige and expertise.</p>':"doublechocolate"==i?'<div class="hover_title">Double Chocolate Cone <span class="level flavor_current money_icon is_white">1.75</span></div><p>This cone gives a bonus with every sale.</p><p class="flavor_text">Cones only affect your sales and your autopilot sales. Cones persist through prestige and are affected by prestige and expertise.</p>':'<div class="hover_title">Starter Cone <span class="level flavor_current money_icon is_white">0.00</span></div><p>This cone does not give a bonus when sold.</p><p class="flavor_text">Cones only affect your sales and your autopilot sales. Cones persist through prestige and are affected by prestige and expertise.</p>');
else if("highscore"===r)i=$(this).attr("id"),$(".hovercard").html("this_day"===i?'<div class="hover_title">Daily Highscores</div><p>These are the totals for money earned today. This list resets at 12PM EST.</p>':"this_week"===i?'<div class="hover_title">Weekly Highscores</div><p>These are the totals for money earned this week. This list resets weekly.</p>':"all_time"===i?'<div class="hover_title">All Time Highscores</div><p>This is a leaderboard for total money earned. This list does not reset.</p>':"up_and_coming"===i?'<div class="hover_title">Up and Coming Highscores</div><p>This is a leaderboard for total money earned for accounts newer than 30 days.</p>':"prestige"===i?'<div class="hover_title">Prestige Highscores</div><p>This is a leaderboard for the total prestige amount.</p>':"cowlv"===i?'<div class="hover_title">Cow Highscores</div><p>This is a leaderboard for the cow levels of active cows.</p>':"accumulation_time"===i?'<div class="hover_title">Ice Cube Time Highscores</div><p>This is a leaderboard for the highest time accumulating ice cubes.</p>':'<div class="hover_title">Ice Cube Highscores</div><p>This is a leaderboard for the amount of money earned in one consecutive batch.</p>'),$(".hovercard").css("height",80);else if("inventory"===r){var b=$(this).attr("x-name");$(".hovercard").html('<div class="hover_title">'+b+'</div><img src="'+Ot+"/items/"+b.replace(/\s+/g,"")+'.png" class="inventory_hover_img" /><p>This is an item in your inventory.</p>')}else if("ipm"===r){var c=5-.25*Aa.upgrade_machinery,d=ot/c*60,w=d*Wa,k=d*Ja,C=6*Aa.upgrade_autopilot*Ba;$(".hovercard").html('<div class="hover_title">Income Breakdown</div><table class="ipm_breakdown"><tr><td>Average worker value</td><td>$'+Wa.toFixed(2)+"</td></tr><tr><td>Number of Sales</td><td>x"+ot+"<br><tr><td>Income from workers</td><td>$"+t(w.toFixed(2))+"</td></tr><tr><td>Income from autopilot</td><td>$"+t(C.toFixed(2))+'</td></tr><tr style="display:none;"><td><b>Total before bonuses</b></td><td>$'+t((C+w).toFixed(2))+"</td></tr><tr><td>Income Bonus - Cow</td><td>$"+t(k.toFixed(2))+"</td></tr></table>")}else if("vote"===r){var T=$(this).attr("x-name"),I=T?"Vote for "+T:"Voting";$(".hovercard").html('<div class="hover_title">'+I+'</div><p>The ice cream conglomerates will make the public want a flavour of ice cream enough to pay a premium.</p><p class="flavor_text">The flavour with the most votes will be the next to trend. The bonus goes up by $.05 for each vote. Vote once every 10 minutes.</p>')}else if("expertise"==r)$(".hovercard").css("left","23%"),$(".hovercard").html('<div class="hover_title">Expertise level</div><p>Sell this flavor to raise your expertise level. Higher value flavors are more difficult to master. Each level gives a bonus +10% to the flavor\'s value for you and your workers. The maximum expertise level is 15.</p>');else if("frankenflavour"==r)$(".hovercard").html('<div class="hover_title">Frankenflavour</div><p>Combine two flavours into one stronger flavour. Frankenflavour transformations last 20 minutes.</p><p class="flavor_text">To unlock each of the additional tiers requires the item "lab parts". Frankenflavours do not last through prestige. </p>');else if("prestige"==r){$(".hovercard").css("height",180).css("font-size","12px");var q=P(Aa);if(Aa.prestige_level<8)$(".hovercard").html('<div class="hover_title">Prestige<span class="level">'+Aa.prestige_bonus+"%</span></div><p><b>Restart the game with a bonus</b> based on cash balance, flavors unlocked, and add-ons unlocked</p><p>This restarts the game and increases sales values by "+parseFloat(parseFloat(Aa.prestige_bonus)+parseFloat(q)).toFixed(5)+"%.You can upgrade Prestige up to 8 times, after that the lowest prestige bonus can be redone. Each time you upgrade you will get a bonus from 1-50% based on your progress. <b>This bonus adds with your past prestige bonuses.</b></p>");else{for(var M=Aa.prestige_array[0],S=1;S<Aa.prestige_array.length;S++)Aa.prestige_array[S]<M&&(M=Aa.prestige_array[S]);var F=parseFloat(parseFloat(Aa.prestige_bonus)-parseFloat(M)+parseFloat(q)).toFixed(5);$(".hovercard").html('<div class="hover_title">Prestige<span class="level">'+Aa.prestige_bonus+"%</span></div><p><b>Restart the game with a bonus</b>, overwriting your current lowest prestige score ("+parseFloat(M).toFixed(5)+"%)</p><p>New Prestige Bonus: "+F+"%</p>")}Aa.last_prestige_at&&$(".hovercard").append('<div class="last_prestige">Last prestiged: '+Aa.last_prestige_at.substring(0,10)+"</div>")}else if("heroic"==r)$(".hovercard").html('<div class="hover_title">erer<span class="level">'+Aa.upgrade_heroic+"</span></div><p>Unlock 3 high level flavors and add-ons. This can be upgraded 3 times.</p>");else if("legendary"==r)$(".hovercard").html('<div class="hover_title">Legendary Tier<span class="level">'+Aa.upgrade_legendary+"</span></div><p>Unlock 3 high level flavors and add-ons. This can be upgraded 3 times. You must have 1 level of Prestige to unlock this.</p>");else if("combo"==r){for(var N=parseFloat($(l).attr("x-value")),O=0,E=0,j=Pa.length,D=za.length,S=0;j>S;S++)if(Pa[S]._id==$(l).attr("x-flavor")){O=Pa[S].value;break}for(var S=0;D>S;S++)if(za[S]._id==$(l).attr("x-addon")){E=za[S].value;break}$(".hovercard").html('<div class="hover_title">'+$(l).attr("x-name")+'<span class="level flavor_current">'+(N+O+E).toFixed(2)+"</span></div><p>Click this ice cream to switch to it for a bonus <b>$"+parseFloat($(this).attr("x-value")).toFixed(2)+'</b></p><p class="flavor_text">Combos are made by matching a certain base and addon into an even better flavor. Increases the value of the flavor.</p>')}else if("value"==r){var n=parseInt($(l).offset().top)-40;$(".hovercard").css("top",n-$(window).scrollTop()).css("margin-left",(vt/4-300)/2+"px");var A,z=Icecream.get_flavor(Aa.last_flavor),L=Icecream.get_addon(Aa.last_addon),R="Flavour",U="";if(Aa.last_frankenflavour){R="Frankenflavour";var H=Icecream.get_flavor(Aa.last_frankenflavour);A=.75*(z.value+H.value);var Y=new Date-new Date(Aa.last_frankenflavour_at);U='<span class="time_left">'+(20-Y/1e3/60).toFixed(1)+" Mins</span>"}else A=z.value;var B=0;$(".hovercard").html('<div class="hover_title">'+$(".current_flavor").text()+" "+U+'</div><p style="text-align: right;">'+R+" value: $"+parseFloat(A).toFixed(2)+" (+"+parseFloat(L.value).toFixed(2)+" add-on)<br /></p>"),et>0&&($(".hovercard p").append("Cone bonus: $"+parseFloat(et).toFixed(2)+"<br />"),B+=parseFloat(et));for(var S=0;S<Ya.length;S++){var J=Ya[S];J.flavor_id===Aa.last_flavor&&J.topping_id===Aa.last_addon&&($(".hovercard p").append("Combo bonus: $"+J.value.toFixed(2)+"<br />"),B+=J.value)}Aa.last_flavor==ua&&""!=ua&&($(".hovercard p").append("Trending bonus: $"+parseFloat(Ua).toFixed(2)+"<br />"),B+=parseFloat(Ua)),Aa.last_addon==va&&""!=va&&($(".hovercard p").append("Event bonus: $"+Aa.trend_bonus+"<br />"),B+=Aa.trend_bonus);var W=0;if(ut>0&&(W=.1*(A+B)*ut,$(".hovercard p").append(ut+"0% (x $"+(A+B).toFixed(2)+") Expertise: $"+parseFloat(W).toFixed(2)+"<br />")),Aa.prestige_bonus>0){var G=(A+B)*(Aa.prestige_bonus/100);$(".hovercard p").append(Aa.prestige_bonus+"% (x $"+(A+B).toFixed(2)+") Prestige: $"+parseFloat(G).toFixed(2)+"<br />")}$(".hovercard").css("left",$(l).offset().left-25+"px")}else if("base"==r){var Q=Icecream.get_flavor($(l).attr("x-id"));if("mystery"!=Q.name){var V=Q.name.replace(/\s+/g,""),X=!0,K=parseInt($(l).parent().find(".expertise_level").text());isNaN(K)&&(K=0);var Z=.1*Q.value*K,ea=Q.value*(Aa.prestige_bonus/100),aa=Q.value+Z+ea,ta=Aa.flavors.indexOf(Q._id),sa=parseInt(Aa.flavors_sold[ta])>0?Aa.flavors_sold[ta]:"0";$(".hovercard").html('<div class="hover_title">'+na(Q.name)+'<span class="level flavor_current money_icon is_white">'+parseFloat(aa).toFixed(2)+"</span></div><p>"+Q.description+'</p><p>Value <span class="money_icon">'+parseFloat(Q.value).toFixed(2)+'</span> (Max <span class="money_icon">'+parseFloat(Q.base_value).toFixed(2)+"</span>). "+na("sold")+": "+t(sa)+'</p><p class="flavor_text">'+na("Flavour value fluctuates over time based on supply.")+"</p>"),$(".hovercard").attr("x-new-art",!0),$(".hovercard").append('<div class="icecream_hovercard_art" style="background-image: url('+Ot+"/flavours/thumb/"+V+".png.gz), url(http://static.icecreamstand.ca/cones/thumb/"+(at?at:"default")+'.png.gz);"></div>')}else $(".hovercard").html('<div class="hover_title">'+na($(l).attr("id"))+'<span class="level flavor_current">?</span></div><p>This flavour has not yet been unlocked</p><p>Maximum base value ? You\'ve sold: 0</p><p class="flavor_text">Flavour value fluctuates over time based on supply.</p>'),$(".hovercard").attr("x-new-art",!0),$(".hovercard").append('<div class="icecream_hovercard_art" style="background-image: url('+Ot+"/flavours/thumb/"+$(l).attr("id")+".png.gz), url(http://static.icecreamstand.ca/cones/thumb/"+(at?at:"default")+'.png.gz);"></div>')}else if("addon"==r){var oa=Icecream.get_addon($(l).attr("x-id")),X=ns.indexOf(oa.name)>-1;if($(".hovercard").html('<div class="hover_title">'+na(oa.name)+'<span class="level flavor_current money_icon is_white">'+(oa.value?oa.value.toFixed(2):"?")+"</span></div><p>"+na("Add-ons can be used with a flavour to increase the value of ice cream.")+'</p><p class="flavor_text">'+na("Add-ons increase the value of every ice cream you or your workers sell and do not decrease in value over time.")+"</p>"),X){var Q=Icecream.get_flavor(Aa.last_flavor);$(".hovercard").attr("x-new-art",!0),$(".hovercard").append('<div class="icecream_hovercard_art" style="background-image: url('+Ot+"/flavours/thumb/"+Q.name.replace(/\s+/g,"")+".png.gz), url(http://static.icecreamstand.ca/cones/thumb/"+(at?at:"default")+'.png.gz);"><img src="'+Ot+"/addons/thumb/"+oa.name.replace(/\s+/g,"")+'.png.gz" class="hovercard_addon" /></div>')}}$(".hovercard").append(a?'<div class="triangle-up"></div>':'<div class="triangle-down"></div>')}}),$("body").on("click",".prestige_cancel",function(){$(this).parent().find(".button").show(),$(this).parent().find("button").remove(),$(this).parent().find(".prestige_cancel").remove()}),$("body").on("click",".button_quest",function(){$(".message_close:last").click()}),$("body").on("click",".prestige_button",function(){$(this).after('<button>Confirm</button><div class="button prestige_cancel">Cancel</div>'+S(9)),$(this).hide()}),$("body").on("click",".currently_trending",function(){$("#main_base .option#"+$(this).attr("id")).click()}),$("body").on("click",".flavor .combo_option",function(){$('#main_base .option[x-id="'+$(this).attr("x-flavor")+'"]').click(),$('#main_addon .option[x-id="'+$(this).attr("x-addon")+'"]').click();var e=$(this).attr("x-franken");e&&$.ajax({url:"/last/franken",data:{one:$(this).attr("x-flavor"),two:e},dataType:"json",type:"POST",success:function(){E("flavour")}})}),$("body").on("click","#main_cone .option_wrapper",function(){var e=$(this).find(".option").attr("x-id");if(at&&at==e)return!1;at=$(this).find(".option").attr("x-id");var a={"default":0,baby:.1,waffle:.25,chocolate:.5,whitechocolate:.75,sugar:1,sprinkle:1.25,mintycat:1.5,doublechocolate:1.75};et=a[at],$(".flavor #main_cone .selected").removeClass("selected"),$(this).addClass("selected"),$(".icecream").attr("x-cone",at).css("background-image",'url("'+Ot+"/cones/"+at+'.png.gz")'),T("main cone")}),$("body").on("click","#main_addon .option_wrapper",function(){$("#main_addon .option_wrapper").removeClass("selected"),$(this).addClass("selected");var e=$(this).find(".option").attr("id"),a=ns.indexOf(e)>-1,t=a?Ot+"/addons/"+e.replace(/\W/g,"")+".png.gz":Ot+"/toppings/"+e.replace(/\W/g,"")+".png";$(".icecream #topping").attr("style","background-image: url("+t+");"),$(".icecream #topping").attr("x-addon",e).attr("x-new-art",a),(0===Ya.length||Aa.last_addon!=$(this).find(".option").attr("x-id"))&&(Aa.last_addon=$(this).find(".option").attr("x-id"),$.ajax({url:"last_flavor",data:"f="+Aa.last_flavor+"&a="+Aa.last_addon,dataType:"JSON",type:"POST",success:function(e){for(var a=0;a<e.length;a++)-1==Aa.combos.indexOf(e[a]._id)&&(Aa.combos.push(e[a]._id),L("Unlocked the <b>"+e[a].name+"</b> combo!","Combo Unlocked"));Ya=e,T("main addon"),Icecream.update_worker_fx("addon click")}}));parseFloat($("#main_base .option_wrapper.selected").attr("x-value"))+parseFloat($("#main_addon .option_wrapper.selected").attr("x-value"))}),$("body").on("click","#main_base .option_wrapper",function(){$(".flavor #main_base .option_wrapper").removeClass("selected"),$(this).addClass("selected");var e=$(this).find(".option").attr("x-id"),a=Icecream.get_flavor(e);$(".icecream, .sell_value").css("display","block");var t=a.name.replace(/\s+/g,""),s=!0;if(Kt&&h(),Aa.last_flavor===e){if($(".icecream_franken, .icecream_flavour").remove(),$(".icecream").css('url("'+Ot+"/cones/"+at+'.png.gz")'),$(".icecream").prepend('<div class="icecream_flavour" x-name="'+t+'" x-new="'+s+'" style="background-image: url(https://s3.amazonaws.com/icecreamstand.com/'+(s?"flavours/":"")+t+".png"+(s?".gz":"")+');"></div>'),Aa.last_frankenflavour){var o=Icecream.get_flavor(Aa.last_frankenflavour),n=o.name.replace(/\s+/g,""),r=!0;$(".icecream").prepend('<div class="icecream_franken" x-name="'+n+'" x-new="'+r+'" style="background-image: url(https://s3.amazonaws.com/icecreamstand.com/'+(r?"flavours/":"")+n+".png"+(r?".gz":"")+');"></div>'),$(".icecream_flavour").attr("x-franken-half",!0)}T("main base"),K()}else Aa.last_flavor=e,Aa.last_frankenflavour=null,$.ajax({url:"last_flavor",data:"f="+Aa.last_flavor+"&a="+Aa.last_addon,dataType:"JSON",type:"POST",success:function(e){Ya=e,Q(),T("main base"),K()}}),$(".icecream").stop().animate({left:"-100%"},500,function(){$(".icecream_franken, .icecream_flavour").remove(),$(".icecream").prepend('<div class="icecream_flavour" x-name="'+t+'" x-new="'+s+'" style="background-image: url(https://s3.amazonaws.com/icecreamstand.com/flavours/'+t+'.png.gz);"></div>'),$(".icecream").animate({left:"0"},1e3)});Mt=Aa.flavors.indexOf(Aa.last_flavor),Q()}),$("body").on("mouseleave","#upgrades .unlockable button",function(){$(".unlock_update").remove()}),$("body").on("click","#upgrades .unlockable button",function(){Kt&&(h(),$(this).attr("x-cube-pend",!0),setTimeout(function(){$("button[x-cube-pend]").click().removeAttr("x-cube-pend")},500));var e=$(this).closest(".unlockable").attr("x-type"),a=this;return"prestige"==e&&(Nt=!1),"legendary"==e&&0===Aa.prestige_level?($(this).append('<div class="unlock_update">Requires 1 level of Prestige.</div>'),void setTimeout(function(){$(".unlock_update").remove(),$(".upgrade_error").removeClass("upgrade_error")},3e3)):($(this).hasClass("sell")&&$(this).addClass("upgrade_sell"),$(".unlock_update").remove(),$(".upgrade_error").removeClass("upgrade_error"),$(".upgrade_success").removeClass("upgrade_success"),void $.ajax({url:"/unlock",data:{id:$(this).closest(".unlockable").attr("x-id"),type:e,sell:$(this).hasClass("sell"),amount:$(this).attr("x-amount")},dataType:"JSON",type:"POST",success:function(e){if(e.message)return R(e.message,"Result");if(e.err&&R(e.err),e.error)Aa.is_tooltip&&(isNaN(e.error)||(e.error=e.error>1e9?"Need $"+(e.error/1e9).toFixed(0)+"B":e.error>1e6?"Need $"+(e.error/1e6).toFixed(0)+"M":"Need $"+t(e.error)),$(a).addClass("upgrade_error").append('<div class="unlock_update">'+e.error+"</div>"),setTimeout(function(){$(".unlock_update").remove(),$(".upgrade_error").removeClass("upgrade_error")},1500));else{if(e.reload)return location.reload(!0);e.msg&&Aa.is_tooltip&&($(a).addClass("upgrade_success").append('<div class="unlock_update">'+e.msg+"</div>"),setTimeout(function(){$(".unlock_update").remove(),$(".upgrade_success").removeClass("upgrade_success")},1500)),"base"==$(".upgrade_success").closest(".unlockable").attr("x-type")&&$("#main_base .option_wrapper").remove()}e.user&&(Aa=e.user),e.success&&($(".hovercard").remove(),E(e.success,function(){$(".flavor.main_container .expand").hasClass("active")&&Icecream.paginate(bt),Icecream.update_quest_bar(),"cone"==e.success&&s()})),e.cow&&(pa=e.cow,Icecream.sync_cow(),R("<p>You have adopted a new cow. Cows need to be fed hay to be happy, but a happy cow is a happy life and will help make your ice cream better. Drag hay to your cow to make it happy. Click your cow to see stats.</p>","You have adopted "+pa.name))},error:function(){$(a).addClass("upgrade_error").append('<div class="unlock_update">Error</div>'),setTimeout(function(){$(".unlock_update").remove(),$(".upgrade_error").removeClass("upgrade_error")},1500)}}))}),window.onblur=function(){dt=!1,Kt&&h()},window.onresize=function(){K()},window.onfocus=function(){dt=!0,wt=!0,Rt=!1,Ft>0&&($("title").text("Ice Cream Stand"),Ft=0),Qt&&Icecream.deep_sleep()},$("body").attr("x-scroll-down",window.pageYOffset>400),$(document).scroll(function(){$("body").attr("x-scroll-down",window.pageYOffset>400)}),$("body").on("click",".message_close, .darkness",function(){if(!$(this).hasClass("update")){var e=document.body.scrollTop;window.location.hash=" ",document.body.scrollTop=e,$(".message, .darkness, .alert_shadow:last").remove(),$(".alert_shadow").each(function(){var e=$(this).offset().top-window.scrollY,a=parseInt($(this).css("margin-left")),t=$(this).css("opacity");$(this).css("top",e+20).css("margin-left",a+20+"px").css("opacity",t+.2)}),Jt=!1,Bt.length>0&&(R(Bt[0].msg,Bt[0].title),Bt.shift())}}),$("body").on("click",".settings_tab",function(){var e=$(this).attr("x-area");"true"!==$(this).attr("x-active")&&($('.settings_tab[x-active="true"], .settings_area[x-active="true"]').attr("x-active","false"),$(this).attr("x-active","true"),$('.settings_area[x-area="'+e+'"]').attr("x-active","true")),"shop"==$(this).attr("x-type")&&Icecream.shop_paginate(0)}),$("body").on("click",".view_settings",function(){var e="(optional)</span>",a="",t=Icecream.get_flavor(Aa.flavors[Math.floor(Math.random()*Aa.flavors.length)]);Aa.email_verified?(e="verified!",Aa.facebook_token||(a='<div class="squish"><a href="auth/facebook" class="button button_facebook"><i class="fa fa-facebook"></i> Connect Facebook</a></div>')):Aa.email&&(e='<a href="verify/resend">resend verification</a>');for(var s="",o=0;o<Aa.titles.length;o++)s=s+"<option>"+Aa.titles[o]+"</option>";for(var n=["default","retro","fallen","attack on the castle","winter"],r="",o=0;o<n.length;o++)r=r+'<div class="background_option tooltip'+(n[o]==Aa.active_background?" active":"")+'" x-type="background" x-value="'+n[o]+'"></div>';return R('<form action="user/update" method="POST" class="alert-form"><div class="button_container" x-for="settings"><a href="http://en.gravatar.com/" target="_blank" title="Set your avatar through Gravatar" class="settings_avatar" style="background-image: url('+Ot+"/flavours/thumb/"+t.name+'.png.gz)"></a><div class="settings_tab" x-area="1" x-active="true">Basic</div><div class="settings_tab" x-area="2" x-active="false">Advanced</div><div class="settings_tab" x-area="3" x-active="false">Animations</div><div class="settings_tab" x-area="4" x-active="false">Emails</div><div class="settings_tab" x-area="5" x-active="false">Display</div></div><div class="settings_area" x-area="1" x-active="true"><div class="squish">Player Name<input type="text" placeholder="USERNAME" name="username" value="'+Aa.name+'"></div><div class="squish">Password <span class="setting_hint">(optional)</span><input type="password" placeholder="Password (optional)" name="password"></div><div class="squish">Email <span class="setting_hint">'+e+'</span><input type="text" placeholder="Email (optional)" name="email" value='+(Aa.email?Aa.email:"")+"></div>"+a+'</div><div class="settings_area" x-area="2" x-active="false"><div class="squish">Ignore List (comma seperated)<input type="text" placeholder="ignore list" name="ignore" value="'+(Aa.ignore?Aa.ignore:"")+'"></div><div class="squish">Release channel <input type="radio" name="release_channel" value="0" />Main <input type="radio" name="release_channel" value="1" />Beta '+(-1===Aa.badges.indexOf(1)?" &nbsp; <small>You must be a donor to access Alpha</small>":'<input type="radio" name="release_channel" value="2" />Alpha')+'</span></div><div class="squish">Title: <select>'+s+'</select></div><div class="squish">Language: <a href="/lang/en">English</a> <a href="/lang/jp">Japanese</a> <a href="/lang/ru">Russian</a></div><div class="squish"><div class="toggle_outer"><div class="toggle_container" x-key="chat_off">Disable Chat</div><div class="toggle_container" x-key="is_night">Night Mode</div><div class="toggle_container" x-key="is_display_friendcows">Display friends cows</div><div class="toggle_container" x-key="is_tooltip">Tooltips</div><div class="toggle_container" x-key="is_friend_notify">Notify on friend activity</div><div class="toggle_container" x-key="badge_off">Hide Badge</div><div class="toggle_container" x-key="is_second_row">New below top row</div><div class="toggle_container" x-key="is_auto_daynight">Auto day/night</div></div><div class="display_settings"></div></div></div><div class="settings_area" x-area="3" x-active="false"><div class="squish"><div class="toggle_container" x-key="is_animation_clouds">Clouds</div></div><div class="squish"><div class="toggle_container" x-key="is_animation_cones">Falling Cones</div></div><div class="squish"><div class="toggle_container" x-key="is_animation_workers">Worker Sales</div></div><div class="squish"><div class="toggle_container" x-key="is_animation_money">Money Updates</div></div><br><div class="squish"><div class="toggle_container" x-key="is_animation_lore">Lore books</div></div><br></div><div class="settings_area" x-area="4" x-active="false"><div class="squish"><div class="toggle_container" x-key="is_email_holiday">Email me with Holiday Events</div></div><div class="squish"><div class="toggle_container" x-key="is_email_holiday">Email me when my password changes</div></div><div class="squish"><div class="toggle_container" x-key="is_email_message">Email me when my messages go unread</div></div><br><br></div><div class="settings_area" x-area="5" x-active="false"><div class="squish">Background: <br>'+r+'</div><br><br></div><input type="submit" value="Update" class="button update" id="settings_update"></form>',na("Update Your Settings"),na("Cancel")),$(".display_settings").html('<div class="toggle_display toggle_container" x-id="flavor">Ice Cream</div><div class="toggle_display toggle_container" x-id="quests">Quests</div><br /><div class="toggle_display toggle_container" x-id="achievements">Trending and Event</div></div>'),$('.alert-form input[type="radio"][value="'+Aa.release_channel+'"]').attr("checked",!0),Aa.display_settings&&0==Aa.display_settings[0]||$('.toggle_display[x-id="flavor"]').addClass("checked"),Aa.display_settings&&0==Aa.display_settings[1]||$('.toggle_display[x-id="quests"]').addClass("checked"),Aa.display_settings&&0==Aa.display_settings[2]||$('.toggle_display[x-id="achievements"]').addClass("checked"),Aa.display_settings&&0==Aa.display_settings[3]||$('.toggle_display[x-id="chat"]').addClass("checked"),$(".toggle_container[x-key]").each(function(){var e=$(this).attr("x-key");Aa[e]&&$(this).addClass("checked")}),!1}),$("body").on("click",".easter",function(){var e=$(this).attr("x-num");$(this).remove(),$.ajax({url:"easter/"+e+"/"+btoa("e at ics"+e+"pleasedontcheat"+Aa.name),type:"GET",dataType:"text",success:function(e){R(e,"Easter!"),E()}})}),$("body").on("click",".view_stats",function(){return E("stats",function(){$(".message > #description").html(v())}),R(v(),"Stats"),!1}),$("body").on("click","#cow_teach",function(){var e=$("#cow_memory").val();pa.memories.push(e),qa.emit("cow/update",{memory:e}),$(".message_close:last").click()}),$("body").on("click",".vote_box",function(){$(this).css("bottom",-10);var e=$(this).attr("x-name");$.ajax({url:"vote/"+$(this).attr("x-id"),dataType:"json",type:"post",success:function(a){a.success?(Icecream.update_flavors(),_gaq.push(["_trackEvent","Flavour","Voted for a flavour",e])):a.error&&R(a.error)}})}),$("body").on("click",".nav_triangle",function(){$(".main_nav").is(":visible")?($(".main_nav").slideUp(500),$(this).addClass("inactive")):($(".main_nav").slideDown(500),$(this).removeClass("inactive"))}),$("body").on("click",".friends_list_title > small",function(){var e=$(this).parent().next().attr("x-state");"hidden"==e?($(this)[0].textContent="Hide",$(this).parent().next().attr("x-state","visible")):($(this)[0].textContent="Show",$(this).parent().next().attr("x-state","hidden"))}),$("body").on("click","#message_read",function(){$(this).closest(".new_message").hide(),_($(this).closest(".new_message").attr("x-id"))}),$("body").on("click","#message_mark_read",function(){_($(this).closest(".message_options").attr("x-id"))}),$("body").on("click","#message_remove",function(){var e=$(this).parent();$.ajax({url:"message/remove/"+$(e).attr("x-id"),dataType:"json",type:"post",success:function(){e.hasClass("new_message")&&$(e).hide(),$(".message").length>0&&$(".friends_button_container").click()}})}),$("body").on("click","#friend_message_button",function(){var e=$(this).attr("x-user");$.ajax({url:"/message/"+e,data:{message:$("#friend_message_textarea").val()},dataType:"json",type:"post",success:function(a){return a.error?R(a.error):($(".message_close:last").click(),void qa.emit("message",{to:e}))}})}),$("body").on("click",".background_option",function(){var e=$(this).attr("x-value");$(".background_option.active").removeClass("active"),$(this).addClass("active"),$("body").attr("x-background",e),$.ajax({url:"toggle/background",data:{value:e},type:"POST"})}),$("body").on("click",".toggle_container",function(){$(this).toggleClass("checked");var e=$(this).attr("x-key");e&&$.ajax({url:"toggle",data:{toggle:$(this).attr("x-key")},type:"POST",dataType:"json",success:function(a){return a.err?R(a.err):(Aa[e]=!Aa[e],void("chat_off"==e?($("#chat_window").text(""),qt="",Icecream.sync_chat()):"is_night"==e&&(Aa[e]?$("body").addClass("night"):$("body").removeClass("night"))))}});$(this).hasClass("checked");$(this).hasClass("toggle_display")&&$.ajax({url:"toggle_display",data:{type:$(this).attr("x-id")},type:"POST",success:function(){E("repaint",function(){K()})}})}),$("body").on("dragstart",".flavor.main_container .option",function(e){$(this).addClass("drag"),nt=this,e.originalEvent.dataTransfer.effectAllowed="move",e.originalEvent.dataTransfer.setData("text/html",this.outerHTML),$(".hovercard").remove()}),$("body").on("dragend",".flavor.main_container .option",function(){$(this).removeClass("drag"),$(".option.over").removeClass("over")}),$("body").on("dragenter",".flavor.main_container .option",function(){$(this).addClass("over")}),$("body").on("dragleave",".flavor.main_container .option",function(){$(this).removeClass("over")}),$("body").on("dragover",".flavor.main_container .option",function(e){return e.preventDefault&&e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="move",!1}),$("body").on("drop",".flavor.main_container .option",function(e){var a=e.originalEvent.dataTransfer.getData("text/html");if("hay"==a||"rock"==a)return!1;if(nt!=this){nt.outerHTML=this.outerHTML,this.outerHTML=a;var t=$(".option.over").attr("x-id"),s=$(".option.drag").attr("x-id"),o=$(this).attr("x-type");if(o||(o=$(this).parent().attr("x-type")),"addon"===o){var n=Aa.toppings.indexOf(t),r=Aa.toppings.indexOf(s);Aa.toppings[n]=s,Aa.toppings[r]=t,$.ajax({url:"/switch/addon",data:"1="+t+"&2="+s,dataType:"JSON",type:"POST"})}else if("combo"===o){var n=Aa.combos.indexOf(t),r=Aa.combos.indexOf(s);Aa.combos[n]=s,Aa.combos[r]=t,$.ajax({url:"/switch/combo",data:"1="+t+"&2="+s,dataType:"JSON",type:"POST"})}else if("cone"===o){var n=Aa.cones.indexOf(t),r=Aa.cones.indexOf(s);Aa.cones[n]=s,Aa.cones[r]=t,$.ajax({url:"/switch/cone",data:"1="+t+"&2="+s,dataType:"JSON",type:"POST"})}else{var n=Aa.flavors.indexOf(t),r=Aa.flavors.indexOf(s);Aa.flavors[n]=s,Aa.flavors[r]=t;var i=Aa.flavors_sold[n];Aa.flavors_sold[n]=Aa.flavors_sold[r],Aa.flavors_sold[r]=i,$.ajax({url:"/switch",data:"1="+t+"&2="+s,dataType:"JSON",type:"POST"})}$(".option.over").parent().hasClass("outofstock")?($(".option.over").parent().removeClass("outofstock"),$(".option.drag").parent().addClass("outofstock")):$(".option.drag").parent().hasClass("outofstock")&&($(".option.drag").parent().removeClass("outofstock"),$(".option.over").parent().addClass("outofstock")),$(".option.over").removeClass("over"),$(".option.drag").removeClass("drag"),V(),T("main base drop"),Icecream.update_worker_fx("flavour drop")}return!1}),$("body").on("keydown","#new_message input",function(){qa.emit("typing",{room:Aa.room})}),$("body").on("submit","#new_message",function(){if(0===Aa.prestige_level&&!Aa.quests)return R("<p>Please play the game a bit more before chatting.</p><p>Sorry for any inconvience, this is to stop others from abusing chat.</p>","Not Yet"),!1;var e=$('#new_message input[type="text"]').val();if("/pm"==e.substring(0,3)){e=e.substring(4);var a=e.substr(0,e.indexOf(" ")+1).trim(),t=e.substr(e.indexOf(" ")+1).trim();return y(a,"",t),!1}if("/afk"==e.substring(0,4))return Icecream.deep_sleep(),$('#new_message input[type="text"]').val(""),!1;$('#new_message input[type="text"]').val("").focus();var s=Aa.badge_off?"":$(this).attr("x-badge"),o={badge:s,text:e};return qa.emit("chat message",o),!1}),$("body").on("click",".chat_popout",function(){return Nt=!1,qa.emit("disconnect"),$("body").append('<div class="white_overlay"><strong>Switch to Chat Popout</small></strong><i class="fa fa-times"></i></div>'),$(".white_overlay i").click(function(){$(".white_overlay").fadeOut(250,function(){window.location.reload(!0)})}),window.open("http://icecreamstand.ca/chat","Chat","width=600,height=800"),!1}),$("body").on("click",".individual_badge",function(){var e=$(this).attr("x-badge");$(".badge_selector").css("background-image",'url("'+Ot+"/badges/"+e+'.png")'),$("form#new_message").attr("x-badge",e),$.ajax({url:"badge/update/"+e,type:"post",dataType:"json",success:function(e){Aa.badges=e.badges,$(".individual_badge").remove();for(var a=0;a<Aa.badges.length;a++){var t=Aa.badges[a];$(".badge_inner").append('<img src="'+Ot+"/badges/"+t+'.png" class="individual_badge" x-badge="'+t+'" />')}K()}})}),$("body").on("click",".next_tutorial, .tutorial_shadow",function(){Aa.tutorial++,Icecream.get_tutorial(),$.ajax({url:"tutorial",data:"tutorial="+Aa.tutorial,dataType:"JSON",type:"POST",success:function(){}})}),$("body").on("click",".img_inline",function(){var e=$(this).text();"view"==e?($(this)[0].textContent="hide",$(this).after('<img class="img_inline_after" src="'+$(this).attr("x-href")+'" />')):($(this)[0].textContent="view",$(this).next(".img_inline_after").remove()),K()}),$("body").on("click",".friend_gold",function(){$(this).fadeOut(1e3,function(){$(this).remove()}),$.ajax({url:"redeem_friend",dataType:"JSON",success:function(e){return e.err?R(e.err):void E("friend gold",function(){La=Aa.gold})}})}),$("body").on("click",".complete_quest",function(){if(Kt)return $(this).attr("x-queue","true"),h(),setTimeout(function(){$("[x-queue]").removeAttr("x-queue").click()},500),!1;var e=this;$.ajax({url:"complete_quest",data:"id="+$(this).closest(".quest").attr("x-id"),dataType:"JSON",type:"POST",success:function(a){if(a.error)return $(e).addClass("upgrade_error").append('<div class="unlock_update">'+a.error+"</div>"),setTimeout(function(){$(".unlock_update").remove(),$(".upgrade_error").removeClass("upgrade_error")},2500),!1;Icecream.cloud(2*Math.random()),_gaq.push(["_trackEvent","Quest","Completed Quest",Aa.quests.length]),2==Aa.quests.length&&($(".quests").addClass(".half_size"),jt=!0,Icecream.update_flavors(),Icecream.update_trending());var t=$(e).closest(".quest").attr("x-id");"526745240fc3180000000002"==t?R('<img class="quest_princess" src="'+Ot+'/princess_quest.png">Congratulations! Successfully completed the final quest of the main storyline, earning + $1.00 when a flavor trends or there is an add-on event.<br /><br /><b>Now onward to dynamic quests!</b>',"Quest Complete"):"52577a6288983d0000000001"==t?(R('<div class="quest_image_container" x-type="icecream"><img class="quest_princess" src="'+Ot+'/flavours/strawberry.png.gz"></div>Congratulations! Successfully completed the quest, in return Joy grants you a workers permit. Bring on the minimum wage!<br /><br /><b>Unlocked Workers</b>',"Quest Complete"),0==Aa.prestige_level&&(Icecream.sync_chat(),$.ajax({url:"/unlock",data:{type:"adopt_cow"},dataType:"json",type:"POST",success:function(e){return $(this).attr("x-loading",!1),e.error?R(e.error,"Error"):(pa=null,$(".cow")[0].textContent="",Icecream.sync_cow(),void R("<p><b>You have unlocked a cow!</b> Feed cows hay (by dragging to improve their happiness.</p><p>A happy cow will give you a bonus to ice cream production. Your cow will become an adult once it hits level 5, allowing you to equip items.</p>","Adopted!"))
}}))):"52672bedde0b830000000001"==t?(R('<img class="quest_princess" src="'+Ot+'/princess_quest.png">Zing! Successfully completed the quest, in return Joy teaches you trends and events. So much to learn!<br /><br /><b>Unlocked trends and add-on events</b>',"Quest Complete"),Icecream.update_trending(),Icecream.update_event()):"dynamic quest"==a.name?R('<img class="quest_princess" src="'+Ot+'/princess_quest.png">Boo-Yah! Successfully completed the quest, earning + $0.25 when there is an add-on event.<br /><br /><b>The next quest will unlock soon.</b>',"Quest Complete"):R('<img class="quest_princess" src="'+Ot+'/princess_quest.png">Huzzah! Successfully completed the quest, earning + $1.00 when there is an add-on event.<br /><br /><b>The next quest will unlock soon.</b>',"Quest Complete"),E("quest"),$(e).addClass("upgrade_success"),$(".upgrade_success").append('<div class="unlock_update">QUEST COMPLETE</div>'),setTimeout(function(){$(".unlock_update").remove(),$(".upgrade_success").removeClass("upgrade_success")},2500)},error:function(){$(e).addClass("upgrade_error"),$(e).append('<div class="unlock_update">Error</div>'),setTimeout(function(){$(".unlock_update").remove(),$(".upgrade_error").removeClass("upgrade_error")},2500)}})}),$("body").on("click",".donate_once",function(){$(".donate_anchor").show(),$(this).hide()}),$("body").on("click",'.link_underline[x-link="winter"]',function(){document.location.hash="#!event/winter",I()}),$("body").on("click",'#donate, .link_underline[x-link="donate"], .next_tutorial[x-link="donate"]',function(){document.location.hash="#!donate",R('<p><b>100% of the donations go to making the game better!</b> Leave a note with your player name to earn a donation badge, access to alpha, and exclusive donor items. Alpha channel lets you see changes as they are being made and added to the game, before anyone else. </p> <a href="http://www.patreon.com/icecream" target="_blank" class="button donate_button">Support Ice Cream Stand</a> <small class="donate_once" x-section="1">Click here to make a one-time donation</small><div class="donate_anchor" x-anchor="1" style="display: none;"><p>Donor Rewards for one-time donations are the same as ongoing donations viewable here: <a href="http://www.patreon.com/icecream" target="_blank">http://www.patreon.com/icecream</a></p><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top"><input type="hidden" name="cmd" value="_donations"><input type="hidden" name="business" value="48U9KJ3T3UWK2"><input type="hidden" name="lc" value="CA"><input type="hidden" name="item_name" value="Ice Cream Stand"><input type="hidden" name="currency_code" value="USD"><input type="hidden" name="bn" value="PP-DonationsBF:btn_donateCC_LG.gif:NonHosted"><input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!"><img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1"></form></div>',"Donate")}),$("body").on("click",'#invite, .link_underline[x-link="invite"], .next_tutorial[x-link="invite"]',function(){document.location.hash="#!invite";var e="http://icecreamstand.ca/sign_up?refer="+btoa(Aa.name);return R('<p><b>Give your friend this URL</b> to sign up with and get 25% of their money for that day whenever they complete a quest!</p><center><input type"text" id="refer_url" value="'+e+'"></center>',"Refer a friend"),$("#refer_url").select().focus(),!1}),$("body").on("click","user, .user_info_tab",function(){$(".user_info_tab_active").removeClass("user_info_tab_active"),$(this).addClass("user_info_tab_active"),$(".playercard_anchor").hide(),$('.playercard_anchor[x-anchor="'+$(this).attr("x-section")+'"]').fadeIn(250)}),$("body").on("click","user, .user_card",function(){return $(this).attr("x-cow")?void $.ajax({url:"/cow/"+$(this).attr("x-cow"),dataType:"json",success:function(e){c(e.cow,e.user)}}):void e($(this).attr("x-user"))}),$("body").on("click",".icecream",function(){if(Kt||$(".cube_infobar").length>0)return!1;_gaq.push(["_trackEvent","Ice Cube","Start"]),Kt=!0,Ma=new Date,Sa=0,Pt=!1,At=0,Zt=1,$(".cube_infobar").remove(),$("#canvas_sales").show(),$(".icecream").prepend('<div class="cube_infobar"><span class="infocube_time">00:00</span> <span class="money_icon infocube_money">0</span> <span class="infocube_multiplier"></span></div>'),$(".infocube_multiplier")[0].textContent=Zt+"x"+(es?" +2x":""),Fa=setInterval(function(){m()},100);100*Math.random();xt=[],g(),0===Aa.tutorial&&(Aa.tutorial++,Icecream.get_tutorial(),$.ajax({url:"tutorial",data:"tutorial="+Aa.tutorial,dataType:"JSON",type:"POST"}))}),$("body").on("mousemove","#canvas_sales",function(e){return!1}),$("body").on("click","#canvas_sales",function(e){if(!Kt)return!1;e.preventDefault(),e.stopPropagation();for(var a=e.pageX-$("#canvas_sales").offset().left,t=e.pageY-$("#canvas_sales").offset().top,s=xt.length,o=0;s>o;o++){var n=xt[o],r=n[1],i=n[2];if(b(a,r,t,i,30)){zt=0,n[4]<=1?(xt=[],ba.clearRect(0,0,400,400),g()):n[4]>7?(n[0]=200,h()):(n[4]--,n[3]&&n[3]>10&&(n[3]-=20));var l=es?2:1,c=(1+Aa.upgrade_coldhands/4)*Zt*l;return Icecream.canvas_icecream_sales(),ca(c,e.pageX,e.pageY),X(c),!1}}return zt++,zt>10&&(xt=[],ba.clearRect(0,0,400,400),setTimeout(function(){ba.clearRect(0,0,400,400),xt=[];for(var e=0;2>e;e++){var a=25+160*Math.random(),t=25+125*Math.random();xt.push([1,a,t,0,Math.floor(4*Math.random())])}zt=5},5e3),zt=-1e3),!1}),$("body").on("click",".new_message_respond",function(){var e=$(this).parent().find(".user_card").attr("x-user");return _($(this).parent().attr("x-id")),y(e),!1}),$("body").on("click",".friend_reply",function(){var e=$(this).attr("x-user"),a=$(this).closest("tr").find(".message_body").text();y(e,a)}),$("body").on("click","#compose_send",function(){var e=$("#compose_to").val();e&&y(e)}),$("body").on("click",".view_achievements",function(){return W(),!1}),$("body").on("click",".view_credits",function(){return $.ajax({url:"https://s3.amazonaws.com/icecreamstand.com/credits.json.gz",data:{cache:Math.random()},dataType:"json",success:function(e){var a="";for(var t in e)a=a+'<div class="credits_entry"><b>'+t+"</b> "+e[t]+"</div>";R("Special thanks to:<br>"+a+S(8),"Credits")}}),!1}),$("body").on("click",".thread_user",function(){return $(this).hasClass("thread_active")?(e($(this).attr("x-user")),!1):void x($(this).attr("x-user"))}),$("body").on("focus",".thread_reply",function(){$(this).find("input").show()}),$("body").on("submit",".thread_reply",function(){var e=$(".thread_user.thread_active").attr("x-user");return $.ajax({url:"/message/"+e,data:{message:$(this).find("textarea").val()},dataType:"json",type:"post",success:function(a){return a.error?R(a.error):(qa.emit("message",{to:e}),void x(e))}}),!1}),$("body").on("click","[x-require-facebook]",function(){return Aa.facebook_token?void 0:(window.open("http://icecreamstand.ca/auth/facebook","Link Facebook - Ice Cream Stand","scrollbars=no,width=650,height=500"),Nt=!1,qa.emit("disconnect"),$("body").append('<div class="white_overlay"><strong>Please link your Facebook</small></strong><i class="fa fa-times"></i></div>'),$(".white_overlay i").click(function(){$(".white_overlay").fadeOut(250,function(){window.location.reload(!0)})}),!1)}),$("body").on("click",".thread_controls",function(){var e=$(".mailbox_thread").attr("x-docked"),a=!Boolean("true"==e);$(".mailbox_thread").attr("x-docked",a),$(this).find("i").attr("class",a?"fa fa-arrow-up":"fa fa-arrow-down")}),$("body").on("click",".friends_button_container",function(){R('<div class="mailbox_container"><div class="mailbox_list"></div><div class="mailbox_thread" x-docked="true"></div></div>',"Mail Box"),$(".message").addClass("extended"),$.ajax({url:"messages/read",dataType:"JSON",type:"GET",success:function(e){for(var a=0,t=0;t<e.length;t++){var s=e[t];if(0===$('.mailbox_list > .thread_user[x-user="'+s.from+'"]').length){var o=$("<div />",{"class":"thread_user","x-user":s.from,"x-read":Boolean(s.is_read),text:s.from});s.badge_id&&o.prepend('<img src="'+Ot+"/badges/"+s.badge_id+'.png" />'),$(".mailbox_list").append(o),0===t&&x(s.from),a++}if(12===a)break}U()}})}),$("body").on("click","message-next",function(){var e=parseInt($("message-controls").attr("x-start")),a=parseInt($("message-controls").attr("x-len"));w(e+a,a)}),$("body").on("click","message-prev",function(){var e=parseInt($("message-controls").attr("x-start")),a=parseInt($("message-controls").attr("x-len"));w(e-a,a)}),$("body").on("click",".mobile_menu",function(){$("#upgrades.section-side, .mobile_menu").toggleClass("active"),$(this).hasClass("active")&&window.scrollTo(0,0)}),$("body").on("click",".send_message",function(){var e=$(this).attr("x-user");return e||(e=$(this).closest("user").attr("x-user")),e?y(e):R("Could not find player","Error"),!1}),$("body").on("click","#feedback",function(){return y("sam"),!1}),$("body").on("click",".friend_delete",function(){var e=$(this).closest("user").attr("x-user");return $.ajax({url:"delete/"+e,success:function(){$(".friends_counter user").remove(),Icecream.sync_friends()}}),!1}),$("body").on("click",".decline_friendship",function(){$(".message_close").click()}),$("body").on("click",".accept_friendship",function(){k($(this).attr("x-add"))}),$("body").on("click",".friends_add",function(){$(this).text()===na("Search")?(""!==$(".friends_add_text").val()&&e($(".friends_add_text").val()),$(this).html('<i class="fa fa-search"></i>'),$(".friends_add_text").hide()):($(".friends_add_text").val("").show().focus(),$(this).text(na("Search")))}),$("body").on("click",".add_friend",function(){return k($(this).attr("x-user")),!1}),$("#canvas_main").click(function(e){var a=e.pageX,t=(e.pageY,document.documentElement),s=(window.pageYOffset||t.scrollTop)-(t.clientTop||0);C(a,e.pageY-s+50)}),$("body").on("click",".filter_flavour_options span",function(e){$.ajax({url:"/sort_flavour/"+$(this).attr("id"),success:function(){E("sort_flavour",function(){Icecream.paginate(bt)})}}),e.stopPropagation()}),$("body").on("click",".filter_addon_options span",function(e){$.ajax({url:"/sort_addon/"+$(this).attr("id"),success:function(){E("sort_addon",function(){Icecream.paginate(bt)})}}),e.stopPropagation()}),$("body").on("submit",".ajaxify",function(){var e=$(this).attr("x-update"),a=$(this).serialize();return $.ajax({url:$(this).attr("action"),data:a,type:$(this).attr("method"),success:function(a){return a.err?R(a.err):($(".darkness").click(),void("refresh"===e&&location.reload()))},error:function(e){console.log(e)}}),!1}),$("body").on("click","#filter_flavour",function(){if(0===$("#filter_flavour > div").length){var e="main_base"==$(".flavor.main_container .flavor_tab.active").attr("x-id")?"filter_flavour_options":"filter_addon_options";$(this).append('<div class="'+e+'"><span id="base_value">Max Value (ASC)</span><span id="-base_value">Max Value (DESC)</span><span id="name">Name (ASC)</span><span id="-name">Name (DESC)</span></div>'),$("#filter_flavour > div").slideDown(250)}else $("#filter_flavour > div").slideUp(250,function(){$(this).remove()})}),$("body").on("click",".inventory_clear",function(){for(var e=Number($(this).attr("x-num")),a=$(".cow_inventory > .inventory_slot").length,t=e;a>t;t++){var s=$('.inventory_clear[x-num="'+t+'"]');s.attr("x-num",Number(s.attr("x-num"))-1)}$(this).parent(".inventory_slot").remove(),pa.items.splice(e,1),Icecream.sync_cow(function(){oa()},!0)}),$("body").on("click",".user_cow_title, .cow_background",function(){$.ajax({url:"cow/"+$(this).attr("x-id"),dataType:"json",type:"get",success:function(e){c(e.cow,e.user)}})}),$("body").on("click",".cow_skin",function(){$(".cow_skin.selected").removeClass("selected"),$(this).addClass("selected");var e=parseInt($(this).attr("x-num"));pa.skin=isNaN(e)?"default":pa.skins_unlocked[e],Icecream.sync_cow(function(){oa(),Bt=[],$(".alert_shadow, .message").remove(),c(pa)},!0)}),$("body").on("click",".button_cow",function(){var e=$(this).attr("x-action");if("rename"==e)R('<form class="ajaxify" x-update="refresh" action="cow/update" method="post"><p class="p_adopt">Renaming your cow can have severe consequences on its identity and sense of self.</p><input name="name" value="'+pa.name+'" maxlength="20"><input type="submit" value="Rename"></form>',"Rename "+pa.name);else if("skin"==e){var a='<div class="cow_skin" x-id="default"></div>';if(pa.skins_unlocked)for(var t=0;t<pa.skins_unlocked.length;t++)pa.skins_unlocked[t]&&(a=a+'<div class="cow_skin" x-num="'+t+'" x-id="'+pa.skins_unlocked[t].toLowerCase().replace(/\s/g,"")+'"></div>');R(a,"Cow Skins"),pa.skin||(pa.skin="default"),$('.cow_skin[x-id="'+pa.skin+'"]').addClass("selected")}else{var s=(new Date-new Date(pa.created_at))/864e5;if(20>s)return R("Your cow is too young, it must be at least 20 days old.","I'm afraid I can't let you do that"+S(7));if(pa.level<30)return R("Your cow is too weak, it must be much stronger first! At least level 30.","I'm afraid I can't let you do that"+S(7));R('<img src="https://s3.amazonaws.com/icecreamstand.com/icon_breed.png" /><form class="ajaxify cow_readopt" x-update="refresh" action="cow/new" method="post"><p class="p_adopt">Re-adoption Improves the potential stats of your new cow by 1 for every cow you have owned.<br>This is a big commitment, if you are ready.. what would you like your new cow to be named?'+S(7)+'</p>Name: <input name="name" value="'+pa.name+'"><input type="submit" value="Adopt" class="button_adopt"><br><small x-require-facebook="true"><input type="checkbox" name="fb_adopt_share" id="fb_adopt_share"><label for="fb_adopt_share"> Share on Facebook</label></small></form>',"Adopting a new Cow")}}),$("body").on("click",".cow",function(){return pa&&pa.name?void c(pa):!1}),$("body").on("click",".unlockable_ajax",function(){var e=$(this).attr("x-upgrade"),a=Number($(this).attr("x-cost"));return a>Aa.gold?R("Not enough money","Error"):(Aa.gold-=a,$.ajax({url:"/unlock",data:{type:e},type:"post",success:function(){E("upgrade")}}),void $(".message_close").click())}),$("body").on("click",".silo",function(){var e=ra(Aa.upgrade_silo_hay+1,"silo");R("<table><tr><td><b>Upgrade Silo capacity</b> - Lv"+Aa.upgrade_silo_hay+S(2)+'<p>This increases Silo storage capacity by 25</p><div class="button button_green unlockable_ajax" x-upgrade="silo_hay" x-cost="'+e+'" >Upgrade $'+t(e)+"</div></td></tr></table>","Silo")}),$("body").on("click",'.type_item[x-variance="2"][x-type="rock"]',function(){return H(this,"Coooooooo"),!1}),$("body").on("keydown",'#new_message input[type="text"]',function(e){var a=e.keyCode||e.which;if(9==a&&(e.preventDefault(),$(".mention_suggestion.active").click()),40==a)return $(".mention_suggestion.active").next().addClass("active"),2==$(".mention_suggestion.active").length&&$(".mention_suggestion.active:first").removeClass("active"),e.preventDefault(),!1;if(38==a)return $(".mention_suggestion.active").prev().addClass("active"),2==$(".mention_suggestion.active").length&&$(".mention_suggestion.active:last").removeClass("active"),e.preventDefault(),!1;var t=($(this).val()+String.fromCharCode(a)).toLowerCase();if($(this).data("cache")!=t&&($(".mention_suggestion_box").remove(),$(this).data("cache",t),t.match(/@([^\s]*)$/))){for(var s=t.split("@"),o=s[s.length-1].replace(/[^a-zA-Z0-9_]/gi,""),n=$("<div />",{"class":"mention_suggestion_box"}),r=[],i=Ut.length,l=0;i>l;l++){var c=Ut[l];if(0===c.name.indexOf(o)&&(r.push(c),r.length>5))break}r.sort(function(e,a){return new Date(a.updated_at)-new Date(e.updated_at)});for(var l=0;l<r.length;l++){var d=new Date(r[l].updated_at);n.append('<div class="mention_suggestion '+(0===l?"active":"")+" "+(new Date-d<18e5?"online":"offline")+'" x-away="'+r[l].is_away+'">'+r[l].name+"</div>")}$(".mention_suggestion_box").remove(),$(this).after(n)}}),$("body").on("click",".mention_suggestion",function(){var e=$('#new_message input[type="text"]'),a=e.val().replace(/@([^\W]*)$/,"@"+$(this).text());e.val(a),$(".mention_suggestion_box").remove()}),$("body").on("click",".chat_room_option",function(){return $(this).hasClass("active")?!1:void r($(this).attr("x-id"))}),$("body").on("click",'.login a[href="logout"]',function(){return R(na("Are you really sure you want to log out?")+' <a href="/logout" class="button" id="settings_update" style="margin-bottom:10px;">'+na("Log Out")+"</a>",na("Log Out"),na("Cancel")),!1}),$("body").on("click",".view_highscores, .refresh_highscores",function(){$(".highscores").show();var e="all";return $("#this_week").hasClass("active")&&(e="week"),$("#this_day").hasClass("active")&&(e="today"),$("#up_and_coming").hasClass("active")&&(e="upandcoming"),$("#prestige").hasClass("active")&&(e="prestige"),$("#accumulation").hasClass("active")&&(e="accumulation"),$("#accumulation_time").hasClass("active")&&(e="accumulation_time"),$("#trend_today").hasClass("active")&&(e="trend_today"),$("#cowlv").hasClass("active")&&(e="cow"),$.ajax({url:"/highscores",type:"GET",data:{type:e,limit:$(".active#top_100").length>0?100:10,show:$(".active#show_friends").length>0?"friends":""},dataType:"JSON",success:function(e){$(".highscores ol").html("");var s=new Date,o=new Date(s.getTime()-18e5),n=10;$(".active#top_100").length>0&&(n=100);for(var r=e.length,i=0;r>i&&!(i>=n);i++){var l=e[i],c=new Date(l.updated_at).getTime()>o?"online":"offline",d=0;if(l.total_gold&&(d=l.total_gold),l.today_gold&&(d=l.today_gold),l.week_gold&&(d=l.week_gold),l.today_trending&&(d=l.today_trending),l.highest_accumulation)$(".highscores ol").append('<li class="'+c+'"><user x-user="'+l.name+'" class="highscore_user">'+l.name+"</user>  &nbsp; "+t(l.highest_accumulation.toFixed(2))+"</span></li>");else if(l.accumulation_time){var p=Math.floor(l.accumulation_time/60),u=(l.accumulation_time%60).toFixed(2);$(".highscores ol").append('<li class="'+c+'"><user x-user="'+l.name+'" class="highscore_user">'+l.name+"</user>  &nbsp; "+p+":"+(10>u?"0"+u:u)+"</span></li>")}else $(".highscores ol").append(l.level?'<li><user x-cow="'+l._id+'" class="highscore_user">'+l.name+"</user>  &nbsp; "+l.level.toFixed(2)+"</span></li>":l.prestige_bonus?'<li class="'+c+'" ><user x-user="'+l.name+'" class="highscore_user">'+l.name+"</user>  &nbsp; "+l.prestige_bonus.toFixed(5)+"</span></li>":'<li class="'+c+'"><user x-user="'+l.name+'" class="highscore_user">'+l.name+'</user>  &nbsp; <span class="flavor_current">'+t(a(d,0))+"</span></li>")}K()},error:function(){$(".highscores ol").html("<div>Error loading highscores, please try again</div>")}}),!1})}),{paginate:function(e){var a=$(".inner_flavor_container:visible .option_wrapper").length;if(null===e||5>a)return $(".inner_flavor_container:visible .option_wrapper").hide(),$(".inner_flavor_container:visible .option_wrapper").slice(0,5).show(),$(".filter_box").remove(),!1;$(".inner_flavor_container:visible .option_wrapper").slice(0,5).show();var t=5,s=Math.ceil((a-t)/15)-1;if(e>s)return e=s,!1;if(0>e)return e=0,!1;if(bt===e)$(".page_wrap:visible").hide(),$('.page_wrap[x-page="'+e+'"]').css("left",0).show(),$('.page_wrap[x-page="'+e+'"] .option_wrapper').show();else{var o=bt>e;bt=e,$(".page_wrap:visible").animate({left:o?1e3:-1e3},500,function(){$(this).hide()}),console.log("loading page: "+e),$('.page_wrap[x-page="'+e+'"]').css("left",o?-1e3:1e3).show().animate({left:0},500),$('.page_wrap[x-page="'+e+'"] .option_wrapper').show()}if($(".inner_flavor_container:visible .option_wrapper:visible img[x-src]").each(function(){da(this)}),$(".filter_box").remove(),20>a)return!1;$(".inner_flavor_container:visible").after('<div class="filter_box"><div id="filter_flavour"></div><div class="filter_prev button" onclick="Icecream.paginate('+(e-1)+')"><i class="fa fa-arrow-left"></i></div><div class="filter_next button" onclick="Icecream.paginate('+(e+1)+')"><i class="fa fa-arrow-right"></i></div></div>'),0==e&&$(".filter_prev").css("opacity","0.5"),e==s&&$(".filter_next").css("opacity","0.5");for(var n=0;6>n;n++)$(".filter_box").append('<span class="filter_page '+(n==e?"active":"")+'" onclick="Icecream.paginate('+n+')">'+(n+1)+"</span>")},shop_paginate:function(e){var a=parseInt($(".shop_table:visible").attr("x-index")),t=parseInt($(".shop_table:visible").attr("x-page"))||5,s=a+e;0>s&&(s=0);var o=(s+1)*t;return s>0&&0==$(".shop_table:visible tr:gt("+(o-t-1)+")").length?!1:($(".shop_table:visible").attr("x-index",s),$(".shop_table:visible tr").show(),$(".shop_table:visible tr:gt("+(o-1)+")").hide(),void $(".shop_table:visible tr:lt("+(o-t)+")").hide())},employees_working:function(){if(pa&&(Math.random()<.8&&l(),Math.random()<.8&&l(),Math.random()<.25&&pa.happiness>0)){var e=(pa.constitution+pa.con_mod)/30;console.log(e),e>.9&&(e=.9),Aa.silo_hay>0&&Qt?(Aa.silo_hay-=1-e,pa.experience+=.25,Aa.silo_hay<0&&(Aa.silo_hay=0),$(".silo_bar").css("height",Aa.silo_hay/(175+25*Aa.upgrade_silo_hay)/.01)):(pa.happiness-=1-e,$(".cow_level_bar > #happiness").attr("x-full",!1).attr("value",pa.happiness))}$("#upgrades .unlockable[x-cost]").each(function(){var e=$(this).attr("x-cost");$(this).find("button:first").css("background-size",Aa.gold/e/.01+"% 100%")}),Qt&&(os++,100>os)||ot>0&&Nt&&z(ot,!0)},update_quest_bar:function(){if(!Aa.quests||0===Aa.quests.length)return!1;var e,a=Aa.quests[Aa.quests.length-1],t=a.split("&");if("!"===a.substring(0,1)){var s=parseInt(t[2]),o=t[0].split(","),n=parseInt(o[5]),r=o[4],i=Aa.flavors.indexOf(r),l=i>-1?Aa.flavors_sold[i]:0;e=100*((l-s)/n)}else{var c=parseInt(t[2]);if("52577a6288983d0000000001"===t[0]){var d=Aa.flavors.indexOf("5238d9d376c2d60000000002");if(d>-1){var p=Aa.flavors_sold[d];e=100*(p/pt[c-1])}}else if("52672bedde0b830000000001"===t[0])e=100*(Aa.carts/c);else if("52672dea3a8c980000000001"===t[0])e=100*(Aa.combos.length/c);else if("526744f40fc3180000000001"===t[0])e=100*(Aa.trucks/c);else if("526745240fc3180000000002"===t[0]){for(var u=0,v=Aa.flavors_sold.length,_=0;v>_;_++)Aa.flavors_sold[_]>99&&u++;e=100*(u/c)}}e>100&&(e=100),ma&&(ma!=e?$("#complete_quest_progress").addClass("active"):$("#complete_quest_progress").removeClass("active")),ma=e,$("#complete_quest_progress").css("width",e+"%")},cloud:function(e){if(!Qt&&Aa.is_animation_clouds&&dt&&!(gt>10-e)){for(var a=0;e>a;a++){var t=Math.floor(4*Math.random())-2;0===t&&(t=1);var s=200+175*Math.random(),o=t>0?0-s:vt;ft.push({x:o,y:Math.floor(Math.random()*(_t/2)),width:s,height:.75*s,speed:t,variation:Math.floor(4*Math.random())})}gt=ft.length}},canvas_icecream_sales:function(){var e=xt.length;if(0!=e){for(var a=0;e>a;a++){var t=xt[a];ba.clearRect(t[1]-60-2,t[2]-60-2,125,125)}for(var a=0;e>a;a++){var t=xt[a];ba.beginPath(),ba.arc(t[1],t[2],t[3]+8,0,2*Math.PI,!1),ba.globalAlpha=.5,ba.fillStyle="white",ba.fill(),ba.globalAlpha=1,ba.beginPath(),t[0]>0&&ba.arc(t[1],t[2],t[3]/2+8,-.5*Math.PI,(t[0]/50-.5)*Math.PI),ba.lineWidth=t[3],ba.strokeStyle=t[0]<=100?"#7F7DC7":"#BC0000",ba.stroke(),$a.complete&&ba.drawImage($a,180*Math.floor(t[4]%5),130*Math.floor(t[4]/5),180,130,t[1]-t[3],t[2]-t[3],2*t[3],1.7222*t[3]),t[3]<50&&(t[3]+=10),t[4]>7&&t[4]<14&&(t[4]+=.2),1==t[4]||t[4]>=1.5&&t[4]<2?t[4]=0:t[4]<2&&(t[4]+=.3)}}},canvas_icecream_drop:function(){if(!dt||!Aa.is_animation_clouds&&!Aa.is_animation_cones)return!1;if(Aa.is_animation_clouds)for(var e=0;gt>e;e++){var a=ft[e];ga.clearRect(a.x,a.y,a.width,a.height)}if(Aa.is_animation_cones)for(var e=0;ht>e;e++){var a=mt[e];a[2]>-80&&(ga.clearRect(a[1],a[2]-Gt-8,55*a[3],40*a[3]),ya&&ya.complete&&ga.drawImage(ya,a[1]+5*a[3],a[2]+35,40*a[3],50*a[3]),kt[a[0]].complete&&"undefined"!=typeof kt[a[0]].naturalWidth&&ga.drawImage(kt[a[0]],a[1],a[2],50*a[3],40*a[3]),Ct[a[0]].complete&&"undefined"!=typeof Ct[a[0]].naturalWidth&&ga.drawImage(Ct[a[0]],a[1],a[2]-15,50*a[3],40*a[3])),a[2]+=Gt,a[2]>=_t&&(ga.clearRect(a[1],a[2]-Gt-8,50*a[3],90*a[3]),mt.splice(e,1),e--,ht--)}if(Aa.is_animation_clouds)for(var e=0;gt>e;e++){var a=ft[e];a.x+=a.speed,ga.globalAlpha=.75,a.variation&&$t[a.variation]&&$t[a.variation].complete&&"undefined"!=typeof $t[a.variation].naturalWidth&&ga.drawImage($t[a.variation],a.x,a.y,a.width,a.height),ga.globalAlpha=1,(a.x>vt&&a.speed>0||a.x<0-a.width&&a.speed<0)&&(ga.clearRect(a.x,a.y,a.width,a.height),ft.splice(e,1),e--,gt--)}},update_gold:function(){!Aa.is_animation_money||0===ot||La>=Aa.gold?La=Aa.gold:La+=ha/(50-3*Aa.upgrade_machinery)+(Aa.gold-La)/10;var e=t(La.toFixed(La>1e3?0:2));$(".gold")[0].textContent=e,0!==Ft||Rt||(Lt?$("title")[0].textContent="Unread Message Ice Cream Stand":La!=Aa.gold&&($("title")[0].textContent="$"+e+" Ice Cream Stand"))},process_clicks:function(){return Kt?!1:(Nt&&Aa.upgrade_autopilot>0&&(X(Aa.upgrade_autopilot),ca(Aa.upgrade_autopilot),z(Aa.upgrade_autopilot)),void(dt||(st>2&&(Qt||Icecream.deep_sleep(),st=0),st++)))},update_event:function(){jt&&$.ajax({url:"/event",data:"cache="+Math.random(),dataType:"JSON",type:"GET",success:function(e){var a=(new Date).getSeconds(),t=Aa.trend_bonus.toFixed(2);if(e._id){va=e._id;var s=e.event?e.event:e.name+" is HOT!";0==$('#event_name[x-id="'+va+'"]').length&&($(".event #event_name").attr("x-id",va)[0].textContent=na(s),$(".event #trend_time").html('<span id="trend_bonus" class="money_icon">'+t+'</span><i class="fa fa-clock-o"></i> <span class="event_time">'+a+"</span>")),ss=60-a+60*parseInt(e.mins)}else ss=60,$(".event #event_name").html('<span id="noevent">There is currently no add-on event</span>'),$(".event #trend_time")[0].textContent="",va="";clearInterval(Ca),Ca=setInterval(function(){Icecream.update_clock(".event_time",ss),ss--,0==ss&&Icecream.update_event()},1e3),T("update event")}})},update_flavors:function(){jt&&$.ajax({url:"/flavors",data:{sort:"-votes last_trend_at",limit:5,show_mine:!0},type:"GET",dataType:"JSON",success:function(e){for(var a=e.length,t=0;a>t;t++){var s=e[t];5>t&&(s.votes||(s.votes=0),$('.vote_box[x-id="'+s._id+'"][x-num="'+t+'"]').length>0?$('.vote_box[x-id="'+s._id+'"][x-num="'+t+'"] b')[0].textContent=s.votes:($('.vote_box[x-num="'+t+'"]').remove(),$(".vote_container").append('<div class="vote_box tooltip" x-id="'+s._id+'" x-num="'+t+'" x-name="'+s.name+'"><img src="'+Ot+"/flavours/thumb/"+s.name.replace(/\s+/g,"")+'.png.gz" title="'+s.name+'" /><b>'+s.votes+"</b></div>"))),.1==s.value?$('#main_base .option[x-id="'+s._id+'"]').parent(".option_wrapper:not(.outofstock)").addClass("outofstock"):$('#main_base .option[x-id="'+s._id+'"]').parent(".option_wrapper.outofstock").removeClass("outofstock")}}})},first_time_dunce:function(){if($(".dunce").remove(),console.log("dunce: "+Aa.dunce_until+" - "+new Date),$('#new_message input[type="text"]').attr("placeholder","What would you like to say"),new Date(Aa.dunce_until)>new Date){var e=(new Date(Aa.dunce_until)-new Date)/1e3/60;$(".footer").prepend('<div class="dunce">'+Aa.dunce_message+"<br>Time left: "+e.toFixed(1)+" minutes.</div>"),$('#new_message input[type="text"]').attr("placeholder","Think before you type"),setTimeout(function(){Icecream.first_time_dunce()},6e3)}},first_time_party:function(){if($(".dunce").remove(),console.log("dunce: "+Aa.party_until+" - "+new Date),$('#new_message input[type="text"]').attr("placeholder","What would you like to say"),Aa.party_until&&new Date(Aa.party_until)>new Date){var e=(new Date(Aa.party_until)-new Date)/1e3/60;$(".footer").prepend('<div class="dunce" x-type="party"><img src="'+Ot+'/party.png" class="party_icon" />While you are partying you can invite others to party. Invite people to party by typing /party player_name.<br>Time left: '+e.toFixed(1)+" minutes.</div>"),$('#new_message input[type="text"]').attr("placeholder","Party Party Party"),setTimeout(function(){Icecream.first_time_party()},6e3)}},sync_cow:function(e,a){if(Nt)if(console.log("syncing cow..."),pa&&pa.name){var t={h:pa.happiness,experience:pa.experience,silo:Aa.silo_hay};if(a){t.skin=pa.skin,t.items=pa.items;for(var s=!0,o=0;o<pa.items.length;o++){var n=pa.items[o];if(3>o&&n){var r=pa.items[o].split("/")[4];if(!r||"rare"!=r){s=!1;break}}}t.items_check=btoa(JSON.stringify(t.items)),s&&J("545dad806c43abdf66d01473")}qa.emit("cow/update",t),e&&"function"==typeof e&&e()}else $.ajax({url:"/me/cows",dataType:"json",type:"get",success:function(e){for(var a=0;a<e.length;a++){var t=e[a];if(t.is_active)pa=t,sa(),oa(),("Moose"==pa.skin||"Polar Bear"==pa.skin)&&$("body:not(.winter)").addClass("winter");else if(!Aa.is_display_friendcows){var s="";if($(".cow").show(),t.level<5)t.skin="baby";else for(var o=0;o<t.items.length;o++){var n=t.items[o];if(s=s+'<div x-type="'+n.split("/")[0]+'" class="cow_attachment type_item"></div>',3===o)break}var r=$("<div />",{"class":"cow_background","x-id":t._id,title:t.name,"x-num":a,html:'<div x-skin="'+t.skin+'" class="cow_body"></div>'+s});$(r).appendTo(".footer_cows"),t.memories.length>0&&Math.random()<.25&&H(r,t.memories[Math.floor(Math.random()*t.memories.length)])}}}}),Aa.friends.length>0&&Aa.is_display_friendcows&&$.ajax({url:"/me/cows/friends",dataType:"json",type:"get",success:function(e){for(var a=0;a<e.length;a++){var t="",s=e[a];if(s.level<5)s.skin="baby";else for(var o=0;o<s.items.length;o++){var n=s.items[o];if(n&&(t=t+'<div x-type="'+n.split("/")[0]+'" class="cow_attachment type_item"></div>'),3===o)break}var r=$("<div />",{"class":"cow_background","x-id":s._id,title:s.name,"x-num":a,html:'<div x-skin="'+s.skin+'" class="cow_body"></div>'+t});$(r).appendTo(".footer_cows")}}})},sync_chat:function(){if(!Nt||Aa.chat_off||Aa.quests.length<1)return void $(".chat.main_container").hide();$(".chat.main_container").show();var e=$(".chat.main_container .expand").hasClass("active")?75:15;$.ajax({url:"chat",data:{expanded:e,cache:Math.random()},dataType:"JSON",type:"GET",success:function(e){for(var a=e.length-1,t=a;t>=0;t--)ia(e[t]);K()}})},reconnect:function(e){return console.log("reconnect attempt "+e),e>0?void L("Trying again in "+e+" seconds","Connectivity Issues"):(L("Trying again in "+e+" seconds","Reconnecting..."),Nt=!0,void E("reconnect",function(){$(".inline-message").remove()}))},deep_sleep:function(){Qt?(Icecream.update_flavors(),Icecream.update_trending(),Icecream.update_event(),A("deep sleep")):D("deep sleep","The game will update more slowly to conserve memory"),Qt=!Qt,console.log("deep sleep: "+Qt),qa.emit("sleep",{sleep:Qt}),Icecream.employees_working()},sync_messages:function(e){return $("#message_list").length>0?!1:(e||(e=0),void $.ajax({url:"messages",data:{skip:e},success:function(e){if($(".new_message").remove(),e&&e.length>0){Lt=!1;for(var a=0;a<e.length;a++){var t=e[a];if(!t.is_read){o(t);break}}}}}))},sync_friends:function(){$.ajax({url:"online",data:"cache="+Math.random(),success:function(e){Ut=e.friends;for(var a=new Date,t=new Date(a.getTime()-18e5),s=0,o=Ut.length,n=0;o>n;n++){var r=Ut[n],i=new Date(r.updated_at).getTime()>t,l=0;i&&(l=r.is_away?1:2,s++),la(r.name,l)}$(".friends_counter span#count").attr("x-length",o),$(".friends_counter span#count").text(s+"/"+o)}})},sync_online:function(){$.ajax({url:"online/all",success:function(e){Tt!==e.c&&(Tt=e.c,e.c>It&&(It=e.c),$("#online_count").text(t(e.c)+" "+na("Players")).attr("x-peak",It))}})},get_quest:function(e){e&&console.log("get_quest, -> "+e),$.ajax({url:"new_quest",data:{o:e},dataType:"JSON",success:function(e){if(e.error)return void R(e.error,"error");if(e.warn)return void L(e.warn,"warning");if(e.time)return Aa.next_quest_at=e.time,clearInterval(Oa),void(Oa=setInterval(function(){Icecream.quests_timer()},1e3));if(e&&e.name&&$(".quests.main_container:visible").length>0){Aa.next_quest_at=null,$(".quests.main_container h4 > .lang")[0].textContent="Quests";var a="Extra $1 add-on event bonus";"Bargaining Time"==e.name&&(a="Unlock Workers, chat, and a cow"),"Delusions of Grandeur"==e.name&&(a="Unlock Trends and Events"),e.dynamic_quest&&(a='Extra <span class="money_icon">0.25</span> add-on event bonus',e.description=B(e.dynamic_quest)),R('<img class="quest_princess" src="'+Ot+'/princess_quest.png">'+e.description.replace(/\n/g,"<br>")+"<br /><br /><b>"+na("Reward")+"</b> "+a+'<div class="button button_quest button_green">Start Quest</div>',na("New Quest")+": "+e.name),E("quest")}}})},quests_timer:function(){if(Aa.next_quest_at){var e,a=(new Date(Aa.next_quest_at)-new Date)/1e3;
if(0>a)return Aa.next_quest_at=null,clearInterval(Oa),$(".quests.main_container h4 > .lang")[0].textContent="Quests - Unlocking... ",setTimeout(function(){Icecream.get_quest()},1e3),!1;if(a>60){var t=(a/60).toFixed(1);e=t+" "+(1==t?"minute":"minutes")}else{var s=Math.floor(a);e=s+" "+(1==s?"second":"seconds")}$(".quests.main_container h4 > .lang")[0].textContent="Quests - Next quest unlocks in "+e}},get_quests:function(){if(console.log("getting quests"),0==Aa.quests.length)return $(".quest_default").remove(),$(".quest_list").append('<p class="quest_default">You aren\'t currently on any quests...</p>'),void(Aa.gold>10&&Icecream.get_quest("get_quests"));if(Aa.next_quest_at&&new Date(Aa.next_quest_at)>new Date)clearInterval(Oa),Oa=setInterval(function(){Icecream.quests_timer()},1e3);else{var e=Aa.quests[Aa.quests.length-1],a=e.split("&");"0"==a[1]&&Icecream.get_quest()}$.ajax({url:"quests",dataType:"JSON",success:function(e){if(!e)return!1;it=e;var a=Aa.quests.length-1,t=Aa.quests[a].split("&");$(".quest_default").remove();for(var s=0;a>=s;s++){var o=Aa.quests[s];if("!d"==o.substring(0,2)){var n=o.split("&"),r="0"==n[1]?'<center><img src="'+Ot+'/star.png" class="quest_star" /><b>'+na("Completed")+"</b></center>":'<div class="button complete_quest"><div id="complete_quest_progress"></div><b>'+na("Complete Quest")+"</b></div>";$('.quest[x-dynamic="'+o+'"]').remove(),$(".quest_list").prepend('<div class="quest" x-dynamic="'+o+'" x-num="'+s+'"><div class="quest_body">'+B(o)+'<div class="quest_goal"><b>'+na("Reward")+'</b> <span class="money_icon">0.25</span> Event Bonus</div></div>'+r+"</div>")}else{var i=e[s];if("undefined"==typeof i)break;$('.quest[x-id="'+i._id+'"]').remove();var n=Aa.quests[s].split("&");if(n[2]){var l=n[2];i.description=i.description.replace("[cost]",l)}$(".quest_list").prepend('<div class="quest" x-num="'+s+'" x-id="'+i._id+'"><div class="quest_body">'+i.description+"</div></div>"),"0"!=n[1]?(0==i.level&&$(".quest:first .quest_body").append('<div class="quest_goal"><b>Goal</b>: Become an expert '+(l?l:5)+" with her favourite flavor<br /><b>Reward</b> Unlock Workers, chat, and a cow</div>"),1==i.level&&$(".quest:first .quest_body").append('<div class="quest_goal"><b>Goal</b>: Buy '+l+" carts<br /><b>Reward</b> Unlock Trends</div>"),2==i.level&&$(".quest:first .quest_body").append('<div class="quest_goal"><b>Goal</b>: Discover '+l+' combos<br /><b>Reward</b> + <span class="money_icon">1.00</span> event bonus</div>'),3==i.level&&$(".quest:first .quest_body").append('<div class="quest_goal"><b>Goal</b>: Buy '+(l?l:2)+" truck"+(1!=l?"s":"")+"<br /><b>Reward</b> Unlock Frankenflavours</div>"),4==i.level&&$(".quest:first .quest_body").append('<div class="quest_goal"><b>Goal</b>: Sell 100 of '+(l?l:5)+" flavors<br /><b>Reward</b>: Unlocks prestige, + $1 event bonus</div>"),$('.quest[x-id="'+i._id+'"]').append('<div class="button complete_quest"><div id="complete_quest_progress"></div><b>'+na("Complete")+" "+i.name+"</b></div>")):$('.quest[x-id="'+i._id+'"]').append('<center><img src="'+Ot+'/star.png" class="quest_star" /><b>'+na("Completed")+" "+i.name+"</b></center>")}}20==Aa.quests.length&&"0"==t[1]&&$(".quest_list").prepend('<div class="quest"><div class="quest_title">'+na("Prestige")+'</div><p>When you are ready, go to upgrades and unlock Prestige. You will get a bonus based on cash balance, and the number of flavours and add-ons unlocked. This restarts the game with a percentage bonus on all income.</p><img src="'+Ot+'/prestige_thumb.png" id="quest_prestige"></div>'),$(".quest").hide(),$(".quest:first").show(),Icecream.update_quest_bar()}})},update_trending:function(){jt&&(console.log("socket:trending ->"),qa.emit("trending"))},update_clock:function(e,a){var t=Math.floor(a/60),s=a%60;a>0&&($(e)[0].textContent=t+":"+(10>s?"0"+s:s))},update_worker_fx:function(e){e&&console.log("update_worker_fx <- "+e),$(".wrapper_addon_thumb").remove();for(var t=0;5>t;t++){var s=Aa.toppings[t];if(s){for(var o=za.length,n=0;o>n;n++)if(za[n]._id===s){s=za[n].name;break}var r=ns.indexOf(s)>-1,i=r?Ot+"/addons/thumb/"+s.replace(/\s+/g,"")+".png.gz":Ot+"/toppings/"+s.replace(/\s+/g,"")+"_thumb.png";$("#main_base .option_wrapper").eq(t).append('<img src="'+i+'" x-is-new="'+r+'" class="wrapper_addon_thumb" />')}}$("#main_base .option_wrapper .icecream_float").remove();for(var l=0;5>l;l++){{$("#main_base .option").eq(l),$("#main_addon .option").eq(l)}if(Aa.flavors.length>l){var c=Icecream.get_flavor(Aa.flavors[l]);Aa.is_animation_workers&&Aa.carts>l&&$('#main_base .option[x-id="'+c._id+'"]').parent().prepend('<div class="icecream_float">'+a(Xa[l],2).toFixed(2)+"</div>"),kt[l]=new Image,kt[l].src=Ot+"/flavours/thumb/"+c.name.replace(/\s+/g,"")+".png.gz",console.log("loading img: "+c.name.replace(/\s+/g,""))}if(Aa.toppings.length>l){var d=Icecream.get_addon(Aa.toppings[l]);Ct[l]=new Image,Ct[l].src=Ot+"/toppings/"+d.name.replace(/\s+/g,"")+"_thumb.png",console.log("loading img: "+d.name.replace(/\s+/g,""))}}},get_tutorial:function(){if($(".tutorial, .tutorial_shadow").remove(),Kt)return setTimeout(function(){Icecream.get_tutorial()},2e3),!1;if(0==Aa.tutorial){$(".section-main, .section-side#upgrades, .expertise_bar_outer").css("opacity",.25),$("body").append('<div class="tutorial tutorial_0"><h2>'+na("Click Me!")+'</h2><p class="tutorial_text">'+na("Click here and click the scooplings as they appear.")+". <b>"+na("Click Click!")+'</b></p><div class="tut_ice_cube" x-id="1"></div><div class="triangle-left"></div></div>');for(var e=0;30>e;e++)setTimeout(function(){$('.tut_ice_cube[x-id="1"]').toggleClass("active")},500*e)}if(1==Aa.tutorial&&($(".expertise_bar_outer").css("opacity",1),$("body").append('<div class="tutorial tutorial_2"><h2>'+na("Get better with expertise")+'</h2><p class="tutorial_text">'+na("The more Ice Cream you sell, <b>the better you will get</b> at making it (and the more you can sell it for). This is called ")+"<b>"+na("Expertise")+'</b></p><div class="button next_tutorial button_green">Got it</div><div class="triangle-left"></div></div><div class="tutorial_shadow"></div>')),2==Aa.tutorial){$(".section-main, .section-side#upgrades").css("opacity",1);var a=$(".flavor.main_container").offset().top;$("body").append('<div class="tutorial tutorial_3" style="top: '+a+'px;"><h2>'+na("Almost done! Customize here")+'</h2><p class="tutorial_text">'+na("Choose your <b>favourite flavours and add-ons</b> as you unlock them. If you want to see more than your top 5 click Expand.")+'</p><div class="button next_tutorial button_green">Ok cool</div><div class="triangle-left"></div></div><div class="tutorial_shadow"></div>')}Aa.total_gold>50&&3==Aa.tutorial&&$("body").append('<div class="tutorial tutorial_4"><h2>'+na("Buy All The Things!")+'</h2>Research <b>powerful upgrades</b> for your Ice Cream here. Hire workers, or get upgrades.<div class="button next_tutorial button_green">'+na("Let's Start")+'</div><div class="triangle-right"></div></div><div class="tutorial_shadow"></div>'),Aa.total_gold>500&&4==Aa.tutorial&&$("body").append('<div class="tutorial tutorial_6"><h2>'+na("Connect your Facebook")+"</h2>"+na("Secure your account and find friends that play Ice Cream Stand!<br>")+'<div class="clearfix"></div><br><div class="button next_tutorial">'+na("No thanks")+'</div><a class="button next_tutorial button_facebook" href="/auth/facebook"><i class="fa fa-facebook"></i> Connect</a></div><div class="tutorial_shadow"></div>'),Aa.total_gold>5e5&&5==Aa.tutorial&&$("body").append('<div class="tutorial tutorial_6"><h2>'+na("Support Ice Cream Stand")+"</h2>"+na("Please help keep Ice Cream Stand free and awesome, <b>support us by donating</b> and earn cosmetic rewards.")+'<div class="clearfix"></div><div class="button next_tutorial">'+na("No thanks")+'</div><div x-link="donate" class="button next_tutorial">'+na("Support the game")+'</div></div><div class="tutorial_shadow"></div>'),Aa.total_gold>5e6&&6==Aa.tutorial&&$("body").append('<div class="tutorial tutorial_5"><h2>'+na("Sharing is caring")+"</h2>"+na("If you enjoy Ice Cream Stand <b>please tell your friends</b>. Any time someone you invite completes a quest, you earn money!")+'<div class="clearfix"></div><div class="button next_tutorial button_red">'+na("No thanks")+'</div><div id="invite" x-link="invite" class="button next_tutorial button_green">'+na("Sure")+'</div></div><div class="tutorial_shadow"></div>')},get_flavor:function(e){for(var a=Pa.length,t=0;a>t;t++)if(Pa[t]._id===e)return Pa[t];return{name:"vanilla",value:"?",total_value:"?"}},get_friend:function(e){for(var a=Ut.length,t=0;a>t;t++)if(Ut[t]._id===e)return Ut[t]},get_combo:function(e){console.log("getting combo with id "+e);for(var a=Ya.length,t=0;a>t;t++)if(Ya[t]._id===e)return Ya[t];return{name:"mystery"}},get_addon:function(e){for(var a=za.length,t=0;a>t;t++)if(za[t]._id===e)return za[t];return{name:"cherries"}}}}();