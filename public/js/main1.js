Icecream=function(){"use strict";function e(e,a){return Math.round(e*Math.pow(10,a))/Math.pow(10,a)}function a(e){return e&&"undefined"!=typeof e?e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"}function t(){ya.cones||(ya.cones=[]),ya.cones.push("default");for(var e=0;e<ya.cones.length;e++)0===$("#main_cone img#"+ya.cones[e]).length&&$("#main_cone").prepend('<div class="option_wrapper tooltip" x-type="cone" draggable="true"><img x-src="'+ht+"/cones/thumb/"+ya.cones[e]+'.png.gz" x-type="cone" id="'+ya.cones[e]+'" class="option" x-id="'+ya.cones[e]+'" /></div>'),$(".cones_inner #unlock_cone_"+ya.cones[e]).remove();$("#main_cone .option_wrapper:first").click(),$('.flavor_tab[x-id="main_cone"]').hasClass("active")&&$('.flavor_tab[x-id="main_cone"]').click(),0===$(".cones_inner .unlockable, .cones_inner h3").length&&$(".cones_inner").append("<h3>Every cone is unlocked!</h3>")}function s(){ma.on("chat message",function(e){return e.add_badge&&e.add_badge_id==ya._id&&(ya.badges.push(e.add_badge),I()),e.dunce&&e.dunce==ya.name&&I("dunce",function(){Icecream.first_time_dunce()}),e.party&&e.party==ya.name&&I("party",function(){Icecream.first_time_party()}),e.room&&(console.log("message for room: "+e.room),e.room&&e.room!=ya.room)?!1:void B(e)}),ma.on("alert",function(e){M(e.message,e.title)}),ma.on("join",function(e){var a=Icecream.get_friend(e._id);if(a){a.is_away=!1;var t=new Date,s=new Date(a.updated_at);console.log("online -"+a.name+" ("+(t-s)+")"),ya.is_friend_notify&&t-s>1e3&&B({_id:999999*Math.random(),user:":",badge:"1",text:a.name+" has come online",is_system:!0}),W(a.name,!0,a.is_away),$(".friends_counter span#count").text($(".friends_list_online > user").length+"/"+$(".friends_counter span#count").attr("x-length"))}}),ma.on("sleep",function(e){var a=Icecream.get_friend(e._id);a&&(a.is_away=e.sleep,a.updated_at=new Date,W(a.name,!0,a.is_away))}),ma.on("leave",function(e){var a=Icecream.get_friend(e._id);a&&(console.log("offline -"+a.name),a.updated_at=new Date,W(a.name,!1),$(".friends_counter span#count").text($(".friends_list_online > user").length+"/"+$(".friends_counter span#count").attr("x-length")))}),ma.on("typing",function(e){Dt[e._id]=new Date,setTimeout(function(){Dt[e._id]<new Date-900&&$('.is_typing[x-id="'+e._id+'"]').remove()},1e3),0===$('.is_typing[x-id="'+e._id+'"]').length&&$("#typing").append('<span class="is_typing" x-id="'+e._id+'">'+e.name+" is typing.</span>")});var e={sleep:!1,room:"default"};ya.shadow_ban?(ya.room="swamp",e.room=ya.room):ya.room="default",console.log("sleep: "+e),ma.emit("sleep",e),$(".chat.main_container > h4 > span")[0].textContent="Chat - "+ya.room}function n(e){if(!(!e&&st.length>5||!V)){var a=Math.floor(4*Math.random()),t=Math.random()*(.25*Ft-225)+25+.75*Ft,s=Math.random()<.1?"rock":"hay";"rock"===s&&(a=Math.random()<.1?2:1);var n=Math.random()+V.magic_find;if(e&&(n+=.9),n>.8&&V.level>5&&(V.items.length<12||Math.random()<.5)){var o=[],r=["hat_basic","coat_basic","accessory_pipe/1/0/0","shoes_basic","hat_deerstalker","shoes_basic","shoes_cowboy"],i=["accessory_monocle/2/0/0/uncommon","wings_rainbow/1/0/0/uncommon","hat_fedora/-1/0/0/uncommon","hat_beerhat/0/0/2/uncommon","accessory_lei/0/0/1/uncommon"],l=["hat_afro/0/2/0/rare","hat_crown/2/0/1/rare","tutu_pink/1/0/1/rare"];"523a1948750f2c0000000002"==ya.last_flavor&&"525baaf765c3460000000007"==ya.last_addon&&i.push("hat_rainbow afro/1/2/1/uncommon"),"524dd6ce8c8b720000000002"==ya.last_flavor&&"52390634971a180000000003"==ya.last_frankenflavour&&i.push("wings_bat/1/0/1/uncommon"),"523901fba4cc590000000007"===ya.last_flavor&&"525bab2165c3460000000009"==ya.last_addon&&(l.push("hat_astronaut/2/0/2/rare"),l.push("suit_astronaut/2/0/2/rare")),ya.is_night&&"524dd72e8c8b720000000005"==ya.last_flavor&&"525bab2165c3460000000009"==ya.last_addon&&"5238fd44523fdc0000000004"==ya.last_frankenflavour&&l.push("suit_batcow/2/1/1/rare"),"523d5c51fbdef6f047000025"==ya.last_addon&&l.push("hat_golden afro/3/0/0/rare/Fnm04"),"524d0e141320310000000005"==ya.last_flavor&&"523d5e603095960000000001"==ya.last_frankenflavour&&"523d5727fbdef6f04700000c"==ya.last_addon&&Math.random()<.2&&l.push("pet_blair/2/2/2/rare/Creeperkitty"),"525baa7865c3460000000006"==ya.last_flavor&&"523903de9e47060000000002"==ya.last_frankenflavour&&"523d5dbf171d3e0000000005"==ya.last_addon&&l.push("mask_cthulhu/2/2/1/rare/Grakmarr"),e&&"523d5abafbdef6f047000020"==ya.last_addon&&"524d0d1e1320310000000004"==ya.last_flavor&&(l.push("hat_mercow/2/2/-1/rare"),l.push("accessory_mercow/2/-1/2/rare"),l.push("tail_mercow/-1/2/2/rare")),"sprinkle"==ta&&i.push("hat_cone/1/1/1/uncommon"),n>.8&&!e&&o.push.apply(o,r),n>.925&&!e&&o.push.apply(o,i),n>.975&&o.push.apply(o,l),s=o[Math.floor(Math.random()*o.length)],console.log("spawning item: "+s)}var c=$("<div />",{"class":"item tooltip_click "+s,"x-num":st.length,"x-name":s,"x-type":"item","x-from-cube":e,style:"left: "+Math.floor(t)+"px",draggable:!0,html:'<div class="type_item" x-variance="'+a+'" x-type="'+s.split("/")[0]+'"></div>'});c.appendTo(".background_hill"),st.push(s);var d=document.querySelectorAll(".item");[].forEach.call(d,function(e){e.addEventListener("dragstart",u,!1),e.addEventListener("dragend",v,!1),e.addEventListener("drop",_,!1),e.addEventListener("dragover",f,!1)})}}function o(e,a){if(!e)return M("Could not find a cow","Error");e.items||(e.items=[]);var t=(new Date-new Date(e.created_at))/864e5,s="Baby",n="false";e.level>5&&t>12&&(s="Adult"),e.level>5&&t>32&&(s="Old",n="true");var o=e._id===V._id?'<div class="button button_cow" x-action="rename">Rename</div><div class="button button_cow" x-action="skin">Skin</div><div class="button button_cow" x-action="adopt" x-enabled="'+n+'">'+Y("Re-adopt")+"</div>":"";a&&(o='<user x-user="'+a.name+'">View '+a.name+"'s profile</user>");var u="",v="",_=0,m=0,f=0;if(e.level<5)e.skin="baby";else for(var h=0;h<e.items.length;h++){var g=e.items[h].split("/"),b=g[0].replace(/"/g,"").replace(/ /g,"");3>h&&(g[1]&&(_+=parseInt(g[1])),g[2]&&(m+=parseInt(g[2])),g[3]&&(f+=parseInt(g[3]))),4>h&&(v=v+'<div class="cow_attachment type_item" x-type="'+g[0]+'"></div>'),u=u+'<div class="inventory_slot"><img src="https://s3.amazonaws.com/icecreamstand.com/items/'+b+'.png" x-pos="'+h+'" x-name="'+e.items[h]+'" class="inventory_thumb tooltip" x-type="item" />'+(e._id==V._id?'<div class="inventory_clear" x-num="'+h+'">+</div>':"")+"</div>"}var y=e.name.replace(/[\u00A0-\u9999<>\&]/gim,function(e){return"&#"+e.charCodeAt(0)+";"}),x=parseInt(e.intelligence)+parseInt(_),w=parseInt(e.strength)+parseInt(m);e.total_happiness=100+Math.floor(x/2);var k=Math.ceil(e.level),C=100+(e.level-k)/.01;if(M('<div class="cow_inventory">'+u+'</div><div class="cow_stats"><b class="tooltip" x-type="strength">Strength</b> '+w+'<br><b class="tooltip" x-type="constitution">Constitution</b> '+(parseInt(e.constitution)+parseInt(f))+'<br><b class="tooltip" x-type="intelligence">Intelligence</b> '+x+'<br><br><b>Experience</b><div class="cow_card_experience" title="'+e.experience+'"><span style="width: '+C+'%"></span></div><br><b>Happiness</b><div class="cow_card_hapiness" title="'+e.happiness.toFixed(1)+"/"+e.total_happiness+'"><span style="width: '+e.happiness/e.total_happiness/.01+'%"></span></div><br><b>Bonus when happy</b> '+(w+10+e.level/2).toFixed(1)+"%<br><b>Age</b> "+t.toFixed(1)+" days ("+s+')<div class="cow_card_cow"><div class="cow_body" x-skin="'+e.skin+'"></div>'+v+'</div><div class="cow_buttons">'+o+"</div></div>",y+", lvl "+Math.floor(e.level)),e._id===V._id){$(".inventory_slot").attr("draggable",!0);var I=document.querySelectorAll(".inventory_slot");[].forEach.call(I,function(e){e.addEventListener("dragstart",r,!1),e.addEventListener("dragend",i,!1),e.addEventListener("dragenter",l,!1),e.addEventListener("dragleave",c,!1),e.addEventListener("drop",p,!1),e.addEventListener("dragover",d,!1)})}}function r(e){this.style.opacity="1",La=this,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("pos",$(this).find("img").attr("x-pos")),e.dataTransfer.setData("type","move_item"),$(".hovercard").remove()}function i(){$(".over").removeClass("over")}function l(){$(".over").removeClass("over"),this.classList.add("over")}function c(){$(".over").removeClass("over")}function d(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1}function p(e){if(console.log("dropping on item -> "+e.dataTransfer.getData("type")),e.preventDefault(),e.stopPropagation&&e.stopPropagation(),La!=this&&"move_item"==String(e.dataTransfer.getData("type"))){var a=$(this).find("img").attr("x-pos"),t=e.dataTransfer.getData("pos"),s=V.items[a];V.items[a]=V.items[t],V.items[t]=s,Icecream.sync_cow(function(){b("inventory drop")},!0),J(),o(V)}return!1}function u(e){var a=parseInt($(this).attr("x-num"));st[a]!=$(this).attr("x-name")&&console.log("pickup ERROR - found "+st[a]+" but picked up "+$(this).attr("x-name")),"rock"==$(this).attr("x-name")&&2==$(this).find(".type_item").attr("x-variance")&&S(this,"Coooooooo"),this.style.opacity="1",La=this,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("num",a),e.dataTransfer.setData("type","item"),$("body").css("cursor",$(this).css("background-image")+", move !important"),$(".hovercard").remove(),jt=!0}function v(){if(console.log("item drag complete, cleaning up"),$(".over").removeClass("over"),jt){var e=parseInt($(this).attr("x-num"));if(console.log("removing item "+e),$(this).remove(),0===$(".background_hill > .item").length)st=[];else{st.splice(e,1),console.log(st);for(var a=e;a<=st.length;a++)$('.background_hill > .item[x-num="'+a+'"]').attr("x-num",a-1)}}$("body").css("cursor","")}function _(e){return console.log("dropping on item"),$("body").css("cursor",""),e.stopPropagation&&e.stopPropagation(),jt=!1,!1}function m(e){if($("body").css("cursor",""),e.stopPropagation&&e.stopPropagation(),La!=this&&"item"==String(e.dataTransfer.getData("type"))){var a=parseInt(e.dataTransfer.getData("num")),t=st[a];if(console.log("dropping "+t+" ("+a+") on cow"),"rock"==t)$(this).append('<div class="icecream_float cow_float float_failure">:(</div>'),$(".cow_float").animate({top:-50},1e3,function(){$(this).remove()}),V.happiness-=30,V.happiness<0&&(V.happiness=0),b("cow drop: rock");else if("hay"==t)V.happiness>=V.total_happiness?(V.happiness=V.total_happiness,$(this).append('<div class="icecream_float cow_float">:|</div>'),$(".cow_float").animate({top:-50},1e3,function(){$(this).remove()})):(V.happiness>90&&b("cow drop: hay"),V.happiness+=10,V.happiness>V.total_happiness&&(V.happiness=V.total_happiness),ya.cow_clicks++,$(this).trigger("mouseout").trigger("mouseover"),$(this).append('<div class="icecream_float cow_float float_success">:)</div>'),$(".cow_float").animate({top:-50},1e3,function(){$(this).remove()}));else if("snowflake"==t)$(this).append('<div class="icecream_float cow_float"><img src="https://s3.amazonaws.com/icecreamstand.com/event/collectable_snowflake.png" /></div>'),$(".cow_float").animate({top:-50},1e3,function(){$(this).remove()}),ma.emit("epic"),ya.epic_collected+=10,$(".user_epic_collected").text(ya.epic_collected);else{if("candycane"!=t)return V.items||(V.items=[]),V.items.length>=12?(jt=!1,M("<p>Your cow can't carry any more.</p>","Inventory Full")):(V.items.push(t),O("545dad616c43abdf66d01472"),Icecream.sync_cow(function(){J()},!0),!1);$(this).append('<div class="icecream_float cow_float"><img src="https://s3.amazonaws.com/icecreamstand.com/event/collectable_candycane.png" /></div>'),$(".cow_float").animate({top:-50},1e3,function(){$(this).remove()}),ma.emit("epic"),ya.epic_collected+=10,$(".user_epic_collected").text(ya.epic_collected)}V.experience+=1,V.happiness<0&&(V.happiness=0);var s=Math.ceil(V.level),n=100+(V.level-s)/.01;$(".cow_level_bar > #experience").attr("value",n),$(".cow_level_bar > #happiness").attr("x-full",V.happiness==V.total_happiness).attr("value",V.happiness),Icecream.sync_cow()}return!1}function f(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1}function h(){$(".over").removeClass("over"),this.classList.add("over")}function g(){$(".over").removeClass("over")}function b(e){e&&console.log("update_sell_value <- "+e);var t,s=0,n=xa.length,o=0,r=wa.length,i=!1;Z=null;for(var l=0;r>l;l++){var c=wa[l];c._id==ya.last_addon&&(s+=c.value,Ea=c.value);for(var d=0;5>d;d++)if("string"==typeof ya.toppings[d]&&ya.toppings[d]==c._id){var p=c.value;Aa[d]=p;break}}$(".banner#trending, .banner#event, .banner#combo").remove(),t=Icecream.get_flavor(ya.last_flavor),ja=t.value;var u=parseFloat(ja);if(isNaN(u))return console.log("update sell: base is NaN");if(ya.last_frankenflavour){var v=Icecream.get_flavor(ya.last_frankenflavour);u=.75*(ja+v.value)}u+=Pa,ya.last_flavor===X&&Ia&&(u+=parseFloat(Ia)),ya.last_addon===K&&K&&(u+=parseFloat(ya.trend_bonus));for(var _=0;_<qa.length;_++){var m=qa[_];m.franken_id||(m.franken_id=null),m.topping_id===ya.last_addon&&(m.flavor_id===ya.last_flavor&&m.franken_id==ya.last_frankenflavour||m.franken_id===ya.last_flavor&&m.flavor_id==ya.last_frankenflavour)&&(u+=parseFloat(m.value),$(".current_flavor").text(Y(m.name)),i=!0,$(".sell_value").append('<img src="'+ht+'/banner_combo.png" class="banner" id="combo" />'),Z=m)}var f=.1*u*Qa,h=u*(ya.prestige_bonus/100),g=u+h+f;s+=g;for(var l=0;n>l;l++)for(var b=xa[l],d=0;5>d;d++)if("string"==typeof ya.flavors[d]&&ya.flavors[d]==b._id){var u=b.value;b._id===X&&""!=Ia&&(u+=parseFloat(Ia),$("#main_base .option_wrapper").eq(d).append('<img src="'+ht+'/banner_trending_small.png" class="banner small" id="trending" />')),ya.toppings[d]===K&&K&&(u+=parseFloat(ya.trend_bonus),$("#main_base .option_wrapper").eq(d).append('<img src="'+ht+'/banner_event_small.png" class="banner small" id="trending" />'));for(var _=0;_<qa.length;_++){var m=qa[_];if(m.flavor_id===ya.flavors[d]&&m.topping_id===ya.toppings[d]){u+=parseFloat(m.value),$("#main_base .option_wrapper").eq(d).append('<img src="'+ht+'/banner_combo_small.png" class="banner small" id="combo" />');break}}var f=.1*u*parseInt($("#main_base .option_wrapper").eq(d).find(".expertise_level").text());isNaN(f)&&(console.log("NaN expertise"),f=0);var h=u*(ya.prestige_bonus/100),g=Aa[d]+u+f+h;Da[d]=g,Na[d]=b.value,o+=g;break}if(!i)if(ya.last_frankenflavour)console.log("updating current flavour name (franken)"),$(".current_flavor").html(H(ya.last_flavor,ya.last_frankenflavour).name);else if(t){var y=$("#main_addon .selected > .option").attr("id")?Y("with")+" "+$("#main_addon .selected > .option").attr("id"):"";console.log("updating current flavour name to "+t.name+" / "+y),$(".current_flavor").html(t.name+" <br/>"+y)}ya.last_flavor===X&&""!=X&&$(".sell_value").append('<img src="'+ht+'/banner_trending.png" class="banner" id="trending" />'),ya.last_addon===K&&""!=K&&$(".sell_value").append('<img src="'+ht+'/banner_event.png" class="banner" id="event" />'),Ma=parseFloat(s).toFixed(2),$(".current_value").text(Ma);var x=ya.flavors.length>=5?5:ya.flavors.length;Fa=o/x;var w=V&&V.total_bonus&&V.happiness>=90?.01*Fa*V.total_bonus:0;Sa=w,aa=Fa+w;var k=5-.25*ya.upgrade_machinery,C=Ha/k*aa*60+6*ya.upgrade_autopilot*Ma;isNaN(C)?console.log("income is nan: "+Ha+" - "+k+" -> "+Ma):$(".gold_sales span").text(a(C.toFixed(0))),Icecream.update_quest_bar()}function y(){M('<p><h2>Winter is Upon Ice Creamtopia!</h1>Help settle the score between two rival factions. Unlock limited time items, skins, and a badge as you pilot your team to victory.</p><p><img src="http://static.icecreamstand.ca/event/snowflakes.png" /><img src="http://static.icecreamstand.ca/event/candycanes.png" /><img src="'+ht+'/event/collectable_snowflakes_all.png" /><img src="'+ht+'/event/collectable_candycanes_all.png" /></p><p>The winter event lasts from December 13th to January 1st, with the winning team decided at midnight on January 1st. Candy canes and snowflakes can be found from breaking item chests or normal drops (with a 25% chance of spawning instead of hay).</p><p><a href="http://blog.samgb.com/ice-cream-stand-patch-1-44/" target="_blank">View the full patchnotes here</a></p>',"Winter Patch and Event"),$(".message").addClass("winter_alert")}function x(){Ha=ya.carts+2*ya.employees+3*ya.trucks+5*ya.robots+10*ya.rockets+15*ya.aliens,$("#unlock_machine .cost").text(a(15e3+15e4*ya.upgrade_machinery)),$("#unlock_machine .sale_level").text(ya.upgrade_machinery),$("#unlock_research .cost").text(a(50+ya.upgrade_flavor*ya.upgrade_flavor*100)),$("#unlock_addon .cost").text(a(75+ya.upgrade_addon*ya.upgrade_addon*100)),$("#unlock_heroic .cost").text(a(1e6+3e6*ya.upgrade_heroic)),$("#unlock_legendary .cost").text(a(5e7+1e8*ya.upgrade_legendary)),$("#unlock_autopilot .unlock_text .cost").text(a(250*(ya.upgrade_autopilot+1)*(ya.upgrade_autopilot+1)+parseInt(Math.pow(1.05,2*ya.upgrade_autopilot)))),$("#unlock_autopilot .sale_level").text(ya.upgrade_autopilot),$("#unlock_coldhands .unlock_text .cost").text(a(250*(ya.upgrade_coldhands+1)*(ya.upgrade_coldhands+1)+parseInt(Math.pow(1.05,2*ya.upgrade_coldhands)))),$("#unlock_coldhands .sale_level").text(ya.upgrade_coldhands),$("#unlock_cart .unlock_text .cost").text(a(25+Math.pow(ya.carts,2)/4)),$("#unlock_cart .sale_level").text(ya.carts),$("#unlock_employee .unlock_text .cost").text(a(150+100*ya.employees)),$("#unlock_employee .sale_level").text(ya.employees),$("#unlock_truck .unlock_text .cost").text(a(1e3+ya.trucks*ya.trucks*50)),$("#unlock_truck .sale_level").text(ya.trucks),$("#unlock_robot .unlock_text .cost").text(a(5e3+ya.robots*ya.robots*100)),$("#unlock_robot .sale_level").text(ya.robots),$("#unlock_rocket .unlock_text .cost").text(a((5e4+ya.rockets*ya.rockets*500).toFixed(2))),$("#unlock_rocket .sale_level").text(ya.rockets),$("#unlock_alien .unlock_text .cost").text(a((5e5+30*Math.pow(ya.aliens,2.5)).toFixed(2))),$("#unlock_alien .sale_level").text(ya.aliens),$("#unlock_prestige .sale_level").text(ya.prestige_level),$("#unlock_frankenflavour .sale_level").text(ya.upgrade_frankenflavour),ya.upgrade_machinery>0&&$('.option[x-type="machine"]').show(),10===ya.upgrade_machinery&&$("#unlock_machine").hide(),100===ya.upgrade_coldhands&&$("#unlock_coldhands").hide(),3===ya.upgrade_frankenflavour&&$("#unlock_frankenflavour").hide(),ya.upgrade_heroic>0&&$("#unlock_heroic .sale_level").text(ya.upgrade_heroic),ya.upgrade_legendary>0&&$("#unlock_legendary .sale_level").text(ya.upgrade_legendary),ya.carts<10?$("#unlock_employee").addClass("locked"):$("#unlock_employee").removeClass("locked"),ya.employees<25?$("#unlock_truck").addClass("locked"):$("#unlock_truck").removeClass("locked"),ya.trucks<50?$("#unlock_robot").addClass("locked"):$("#unlock_robot").removeClass("locked"),ya.robots<100?$("#unlock_rocket").addClass("locked"):$("#unlock_rocket").removeClass("locked"),ya.rockets<250?$("#unlock_alien").addClass("locked"):$("#unlock_alien").removeClass("locked"),ya.upgrade_frankenflavour>0&&$("#frankenflavour_tab").show(),2==ya.upgrade_legendary&&$("#unlock_legendary .cost,#unlock_legendary button").hide(),ya.carts>50&&O("52b535fd174e8f0000000001"),ya.carts>=250&&O("52b53613174e8f0000000002"),1e3==ya.carts&&1e3==ya.employees&&1e3==ya.trucks&&1e3==ya.robots&&1e3==ya.rockets&&1e3==ya.aliens&&O("537bebae2b2b13b56a283b44")}function w(){if(Ta=!1,"#!donate"==location.hash&&(z(),$("#donate").click()),"#!event/winter"==location.hash&&(z(),y()),"en"!==ua)for(var e=$(".lang").length,a=0;e>a;a++){var t=$(".lang").eq(a)[0];t.textContent=Y(t.textContent)}if(!ya.chat_off){var n={query:"id="+ya._id+"&name="+ya.name};ma=io("http://icecreamstand.ca",n),s()}if(ya.dunce_until&&Icecream.first_time_dunce(),ya.party_until&&Icecream.first_time_party(),ya.friends.length<2&&Math.random()<.1&&ya.total_gold>200&&!ya.is_guest&&setTimeout(function(){$.ajax({url:"/suggestion/user",dataType:"json",success:function(e){M('<p>Add some friends and help them out!</p><p>Would you like to add <b class="user_card" x-user="'+e.user+'">'+e.user+'</b> as a friend?<div class="button_container button_friendship_container"><div class="button decline_friendship">No thanks</div><div class="button accept_friendship" x-add="'+e.user+'">Sure!</div></div>',"Ice Cream Stand is better with friends!")}})},5e3),ya.badges){for(var a=0;a<ya.badges.length;a++){var o=ya.badges[a];$(".badge_inner").append('<img src="'+ht+"/badges/"+o+'.png" class="individual_badge" x-badge="'+o+'" />')}ya.badges[0]&&$(".badge_selector").css("background-image",'url("'+ht+"/badges/"+ya.badges[0]+'.png")')}$("form#new_message").attr("x-badge",ya.badges[0]);var r=document.querySelectorAll(".cow");[].forEach.call(r,function(e){e.addEventListener("dragover",f,!1),e.addEventListener("drop",m,!1),e.addEventListener("dragenter",h,!1),e.addEventListener("dragleave",g,!1)}),Ya=!0,Icecream.get_tutorial();var i=document.getElementById("canvas_main");na=i.getContext("2d");var i=document.getElementById("canvas_sales");oa=i.getContext("2d"),setInterval(function(){Icecream.canvas_icecream_sales()},100),setInterval(function(){Icecream.canvas_icecream_drop()},50),ca=setInterval(function(){Icecream.update_gold()},500),setInterval(function(){Ot||(Icecream.sync_messages(),Icecream.update_trending(),Icecream.update_flavors(),Icecream.cloud(3*Math.random()),setTimeout(function(){Icecream.cloud(3*Math.random())},1e4),Icecream.sync_cow())},6e4),Icecream.sync_online(),Icecream.sync_friends(),setTimeout(function(){Icecream.update_trending(),Icecream.update_flavors(),Icecream.sync_chat(),Icecream.sync_cow(),Icecream.cloud(2*Math.random())},100),da=setInterval(function(){Icecream.process_clicks()},2e3),$("body").addClass($a[ya.release_channel]),$("#version_info").html('<a href="/stats" id="online_count" target="_blank">-</a> <a href="http://blog.samgb.com/tag/ice-cream-stand/" target="_blank" id="version_num">'+ba+" "+$a[ya.release_channel]+"</a>")}function k(e,t){$.ajax({url:"/flavors",data:{sort:"cost",limit:3*(ya.upgrade_flavor+1)},type:"GET",dataType:"JSON",success:function(s){$("#upgrades .flavors_inner").text(""),$("#main_base .option_wrapper").remove(),xa=s;for(var n=ya.flavors.length,o=xa.length,r=n-1;r>=0;r--){for(var i=ya.flavors[r],s=0;o>s;s++)if(xa[s]._id===i){i=xa[s];break}var l=i.name.replace(/\W+/g,"");if(0===$("#main_base .option#"+l).length){var c=5>r?"src":"x-src";$("#main_base").prepend('<div class="option_wrapper'+(.1===i.value?" outofstock":"")+'" style="display: none;" x-new="true"><img '+c+'="'+ht+"/flavours/thumb/"+l+'.png.gz" draggable="true" id="'+l+'"  x-id="'+i._id+'" class="option tooltip" x-base-value="'+i.base_value+'" x-value="'+i.value+'" x-type="base" /></div>')}}for(var s=0;o>s;s++){var i=xa[s];if(-1===ya.flavors.indexOf(i._id)){var l=i.name.replace(/\W+/g,"");$("#upgrades .flavors_inner").append('<div class="unlockable" id="'+i.name+'" x-id="'+i._id+'" x-new="true" x-type="base"><img src="https://s3.amazonaws.com/icecreamstand.com/flavours/thumb/'+l+'.png.gz" class="tooltip" /><div class="unlock_text">'+Y(i.name)+' <span class="cost">'+a(i.cost)+"</span></div><button>Unlock</button></div>")}}$("#main_base.inner_flavor_container .option_wrapper").each(function(){$(this).parent().is(".page_wrap")&&$(this).unwrap()});for(var d=$("#main_base.inner_flavor_container .option_wrapper:gt(4)"),r=0;r<d.length;r+=15)d.slice(r,r+15).wrapAll("<div class='page_wrap' x-page='"+Math.floor(r/15)+"' style='display:none;'></div>");if(0===$("#main_base > .base_active").length&&$("#main_base").prepend('<div class="base_active"></div>'),A(),0==$("#upgrades .flavors_inner").text().length)if(ya.upgrade_flavor<23){var p=$("#unlock_research img").attr("x-src");p&&($("#unlock_research img").attr("src",p),$("#unlock_research img").removeAttr("x-src")),$("#upgrades .flavors_inner").html($("#unlock_research")[0].outerHTML)}else if(ya.upgrade_heroic<3){var p=$("#unlock_heroic img").attr("x-src");p&&($("#unlock_heroic img").attr("src",p),$("#unlock_heroic img").removeAttr("x-src")),$("#upgrades .flavors_inner").html($("#unlock_heroic")[0].outerHTML)}else if(ya.upgrade_legendary<2){var p=$("#unlock_legendary img").attr("x-src");p&&($("#unlock_legendary img").attr("src",p),$("#unlock_legendary img").removeAttr("x-src")),$("#upgrades .flavors_inner").html($("#unlock_legendary")[0].outerHTML)}else $("#upgrades .flavors_inner").html("<h3>"+Y("Every flavour is unlocked!")+"</h3>");return Icecream.paginate(tt),e&&"sort_flavour"===e&&t&&"function"==typeof t&&t(),e&&"base"===e?(t&&"function"==typeof t&&t(),$('.flavor .option[x-id="'+ya.last_flavor+'"]').eq(0).click(),b("base"),void Icecream.update_worker_fx("main flavours")):void C(e,t)}})}function C(e,t){$.ajax({url:"/toppings",data:"cache="+Math.random(),type:"GET",dataType:"JSON",success:function(e){wa=e,$("#upgrades .toppings_inner").text(""),$("#main_addon .option_wrapper").remove();for(var s=ya.toppings.length,n=s-1;n>=0;n--){var o=Icecream.get_addon(ya.toppings[n]),r=zt.indexOf(o.name)>-1;if(0==$('.option[x-id="'+o._id+'"]').length){var i=o.name.replace(/\s+/g,""),l=r?ht+"/addons/thumb/"+i+".png.gz":ht+"/toppings/"+i+"_thumb.png";$(".flavor div#main_addon").prepend('<div class="option_wrapper" x-new-art="'+r+'"><img src="'+l+'" id="'+o.name+'" x-id="'+o._id+'" class="option tooltip" x-value="'+o.value+'" x-type="addon" /></div>')}}for(var n=0;n<wa.length;n++){var o=wa[n];if(-1===ya.toppings.indexOf(o._id)){var r=zt.indexOf(o.name)>-1,i=o.name.replace(/\s+/g,""),l=r?ht+"/addons/thumb/"+i+".png.gz":ht+"/toppings/"+i+"_thumb.png";$("#upgrades .toppings_inner").append('<div class="unlockable" id="'+o.name+'" x-id="'+o._id+'" x-type="addon" x-new-art="'+r+'"><div class="unlock_art_wrapper tooltip"><img src="'+l+'" /></div><div class="unlock_text">'+Y(o.name)+' <span class="cost">'+a(o.cost)+"</span></div><button>"+Y("Unlock")+"</button></div>")}}$("#main_addon.inner_flavor_container .option_wrapper").each(function(){$(this).parent().is(".page_wrap")&&$(this).unwrap()});for(var c=$("#main_addon.inner_flavor_container .option_wrapper:gt(4)"),n=0;n<c.length;n+=15)c.slice(n,n+15).wrapAll("<div class='page_wrap' x-page='"+Math.floor(n/15)+"' style='display:none;'></div>");if(0===$("#main_addon .base_active").length&&$("#main_addon").prepend('<div class="base_active"></div>'),Ta&&w(),Ot||sa===ya.upgrade_machinery||(clearInterval(la),la=setInterval(function(){Icecream.employees_working()},5e3),sa=ya.upgrade_machinery,Icecream.get_quests(),$('.flavor .option[x-id="'+ya.last_flavor+'"]').eq(0).click(),$('.flavor .option[x-id="'+ya.last_addon+'"]').eq(0).click(),"undefined"==ya.last_addon&&$("#main_addon .option").eq(0).click()),0==$("#upgrades .toppings_inner").text().length)if(ya.upgrade_addon<23){var d=$("#unlock_addon img").attr("x-src");d&&($("#unlock_addon img").attr("src",d),$("#unlock_addon img").removeAttr("x-src")),$("#upgrades .toppings_inner").html($("#unlock_addon")[0].outerHTML)}else if(ya.upgrade_heroic<3){var d=$("#unlock_heroic img").attr("x-src");d&&($("#unlock_heroic img").attr("src",d),$("#unlock_heroic img").removeAttr("x-src")),$("#upgrades .toppings_inner").html($("#unlock_heroic")[0].outerHTML)}else if(ya.upgrade_legendary<2){var d=$("#unlock_legendary img").attr("x-src");d&&($("#unlock_legendary img").attr("src",d),$("#unlock_legendary img").removeAttr("x-src")),$("#upgrades .toppings_inner").html($("#unlock_legendary")[0].outerHTML)}else $("#upgrades .toppings_inner").html("<h3>"+Y("Every add-on is unlocked!")+"</h3>");t&&"function"==typeof t&&t()}})}function I(e,s){return console.log("main <- "+e),e&&"base"===e?void k(e,s):e&&"addon"===e?void C(e,s):void $.ajax({url:"/me",type:"GET",dataType:"JSON",timeout:1e4,success:function(n){if(n.badges||(n.badges=[]),n.cones||(n.cones=[]),n.ignore?n.ignore_list=n.ignore.split(","):n.ignore="",n.upgrade_coldhands||(n.upgrade_coldhands=0),n.upgrade_coldhands>100&&(n.upgrade_coldhands=100),n.badge_off||(n.badge_off=!1),n.is_night&&$("body:not(.night)").addClass("night"),$('.buff[x-id="firstwin"]').remove(),Pt=!1,(!n.last_icecube_at||new Date-new Date(n.last_icecube_at)>864e5)&&(Pt=!0,$("body").append('<div class="buff" x-id="firstwin">Daily Ice Cube Bonus available</div>')),$(".friend_gold").remove(),n.friend_gold&&$(".floating_footer").append('<div class="friend_gold"><span class="money_icon is_white">'+a(n.friend_gold.toFixed(0))+'</span><img src="'+ht+'/moneybag.png" id="moneybag" /></div>'),ya=n,ka||(ka=ya.gold),e&&"badges"===e&&($(".badge_inner .individual_badge").remove(),ya.badges)){for(var o=0;o<ya.badges.length;o++){var r=ya.badges[o];$(".badge_inner").append('<img src="'+ht+"/badges/"+r+'.png" class="individual_badge" x-badge="'+r+'" />')}ya.badges[0]&&$(".badge_selector").css("background-image",'url("'+ht+"/badges/"+ya.badges[0]+'.png")')}ya.release_channel>0&&(Ba=!0),ya.is_guest&&ya.total_gold>100&&$("body").append('<h4 class="inline-message view_settings" id="guest" style="cursor:pointer;">'+Y("Set a name and password!")+"<br /><small>"+Y("Click here to secure your account and set a username and password.")+"</small></h4>"),!ya.email&&ya.total_gold>2e4&&$("body").append('<h4 class="inline-message view_settings" id="guest" style="cursor:pointer;">'+Y("Set an Email")+"<br /><small>"+Y("Secure your account and set your email address by clicking here.")+"</small></h4>"),!ya.email_verified&&ya.email&&ya.total_gold>2e4&&$("body").append('<h4 class="inline-message view_settings" id="guest" style="cursor:pointer;">'+Y("Verify your email address")+"<br /><small>"+Y("If you did not get a verification email go to settings to re-send.")+"</small></h4>"),$(".login #name").text(n.name).attr("x-user",n.name).prepend('<span class="name_tri_up"></span>').css("display","inline-block"),$(".inventory_item").remove();for(var i=ya.items,o=0;i>o;o++){var l=ya.items[o];$(".floating_footer").append('<div class="inventory_item tooltip" x-type="inventory" x-name="'+l+'"><img src="'+ht+"/items/"+l.replace(/\s+/g,"")+'.png" /></div>')}return x(),1e3==ya.carts&&O("52b5361e174e8f0000000003"),ya.display_settings||(ya.display_settings=[1,1,1,1]),ya.quests[1]&&"0"===ya.quests[1].split("&")[1]||(console.log("hiding trends"),ya.display_settings=[1,1,0,1]),(ya.quests.length>1||ya.quests[0]&&"0"==ya.quests[0].split("&")[1])&&$(".tab#employees").removeClass("locked"),(ya.quests.length>2||ya.quests[1]&&"0"==ya.quests[1].split("&")[1])&&(bt||(bt=!0,Icecream.update_event(),$(".trending_and_events.main_container").removeClass("hidden"))),0==ya.display_settings[0]?$(".flavor.main_container").addClass("hidden"):$(".flavor.main_container").removeClass("hidden"),0==ya.display_settings[1]?$(".quests.main_container").addClass("hidden"):$(".quests.main_container").removeClass("hidden"),0==ya.display_settings[2]?$(".trending_and_events.main_container").addClass("hidden"):$(".trending_and_events.main_container").removeClass("hidden"),0==ya.display_settings[3]?$(".chat.main_container").addClass("hidden"):$(".chat.main_container").removeClass("hidden"),1==ya.display_settings[1]&&0==ya.display_settings[2]&&$(".quests.main_container").removeClass("half_size"),0==ya.display_settings[1]&&1==ya.display_settings[2]&&$(".trending_and_events.main_container").removeClass("half_size"),0!=ya.display_settings[2]&&0!=ya.display_settings[1]&&($(".quests.main_container:not(.half_size)").addClass("half_size"),$(".trending_and_events.main_container:not(.half_size)").addClass("half_size")),Oa=ya.flavors.length,T(ya),!e||"carts"!==e&&"employees"!==e&&"trucks"!==e&&"robots"!==e&&"rockets"!==e&&"aliens"!==e&&"repaint"!==e?e&&"quest"===e?(console.log("getting quests..."),Icecream.get_quests(),void Icecream.get_quest()):(t(),void k(e,s)):(Icecream.update_worker_fx("main workers"),b("bought worker"),void(s&&"function"==typeof s&&s()))},error:function(){if(ft){ft=!1,Ua++,Ua>20&&(Ua=20);var e=10*Ua;$(".inline-message").remove(),$("body").append('<h4 class="inline-message" id="updated">Connectivity issue<br /><small>'+Y("Trying again in")+" "+e+" "+Y("seconds")+"</small></h4>");for(var a=0;e>=a;a++)setTimeout("Icecream.reconnect("+(e-a)+")",1e3*a)}}})}function T(e){var a=e.gold,t=25*(a/(a+1e6));t>25&&(t=25);var s=e.flavors.length+e.toppings.length,n=s/174*25,o=parseFloat(t+n).toFixed(5);
return $("#prestige_amount").text(o),o}function q(e,t){if(t){var s=-1,o=Math.floor(5*Math.random());if(Na[o]>.1&&Wa&&30>Za&&o<ya.flavors.length){var r=Math.random()*Ft*.25;Ka.push([o,Math.random()>.5?r:Ft-r,-90+-100*o,1]),Za=Ka.length}if(s>-1&&ya.flavors.length>5){console.time("sell_icecream oos");for(var i=$("#main_base .option_wrapper").eq(s),l=$(i)[0].outerHTML,c=(parseFloat($(i).find(".option").attr("x-base-value")),5),d="",o=5;o<ya.flavors.length;o++)if(!$("#main_base .option_wrapper").eq(o).hasClass("outofstock")){c=o,d=$("#main_base .option_wrapper").eq(o).find(".option").attr("x-id");break}console.log(".. new place: "+c),$.ajax({url:"/switch",data:{1:$(i).find(".option").attr("x-id"),2:d},dataType:"JSON",type:"POST"});var p=ya.flavors[s],u=ya.flavors_sold[s];if(ya.flavors[s]=ya.flavors[c],ya.flavors[c]=p,ya.flavors_sold[s]=ya.flavors_sold[c],ya.flavors_sold[c]=u,!$("#main_base .option_wrapper")[c])return;$(i)[0].outerHTML=$("#main_base .option_wrapper")[c].outerHTML,$("#main_base .option_wrapper")[c].outerHTML=l,A(),b("sell icecream"),Icecream.update_worker_fx("sell icecream")}{parseFloat(Ha*aa)}if(ya.gold+=parseFloat(Ha*aa),V&&(Math.random()<.8&&n(),Math.random()<.25&&V.happiness>0)){var v=V.constitution/30;v>.9&&(v=.9);var _=Ot?30:1;V.happiness-=_*(1-v),$(".cow_level_bar > #happiness").attr("x-full",!1).attr("value",V.happiness)}}$.ajax({url:"/me",data:{g:ya.gold,d:aa,a:e,addon:Ea,ta:K==ya.last_addon,c:Z?Z.value:"false",e:Qa,w:t,t:Ia,cbv:ja,cone:Pa,fp:ut,cc:ya.cow_clicks,ds:Ot?Ot:null,v:ba},dataType:"JSON",type:"POST",timeout:5e3,success:function(e){if(Ua=0,$(".inline-message#animations, .inline-message#updated").length>0&&setTimeout("$('.inline-message').remove();",1e4),e.reload)return location.reload(),!0;if(e.error)return $(".inline-message").remove(),void $("body").append('<h4 class="inline-message" id="animations">Ack Ack!<br /><small>'+e.error+"</small></h4>");if(e.notice&&Ba)return $(".inline-message").remove(),void $("body").append('<h4 class="inline-message" id="animations">Notice<br /><small>'+e.notice+"</small></h4>");if(e.gold&&(ya.gold=parseFloat(e.gold)),e.quest&&Icecream.get_quest(),e.trend){var t=75e3-parseInt(e.trend);t>0&&($("#trend_left").text(a(75e3-e.trend)+" left"),$("#trend_sold_inner").css("width",e.trend/75e3*100+"%"))}if(e.ifr&&I("flavor"),e._id&&e.value)for(var s=xa.length,n=0;s>n;n++){var o=xa[n];if(o._id==e._id&&o.value!=e.value)return o.value=e.value,void b("icecream sold")}},error:function(){Ua++,Ua>2&&ft&&I("reconnect_test")}})}function M(e,a){if(Nt)return Mt.unshift({msg:e,title:a}),!1;if(St&&_a){if(_a.title===a){$(".message #description").html(e),_a.msg=e;var t=It-$(".message").height();return _a.top=0>t?0:t/2,void $(".message").css("top",_a.top)}$("body").append('<div class="alert_shadow" style="top: '+_a.top+'px;"><h4>'+_a.title+'</h4><span id="description">'+_a.msg+"</span></div>"),$(".alert_shadow").each(function(){var e=$(this).offset().top-window.scrollY,a=parseInt($(this).css("margin-left")),t=$(this).css("opacity");$(this).css("top",e-20).css("margin-left",a-20+"px").css("opacity",t-.2)}),Mt.unshift(Object.create(_a)),console.log(Mt)}_a={msg:e,title:a},St=!0,$(".hovercard").remove(),"undefined"==typeof a&&(a=Y("New Message")),$(".message, .darkness").remove(),$("body").append('<div class="message"><div class="message_close">x</div><h4 id="title">'+a+'</h4><span id="description">'+e+'</span></div></div><div class="darkness"></div>');var t=It-$(".message").height();_a.top=0>t?0:t/2,$(".message").css("top",_a.top)}function S(e,a){$(".alert_inline").remove(),$(e).prepend('<div class="alert_inline">'+a+'<div class="triangle-down"></div></div>'),setTimeout(function(){$(".alert_inline").remove()},2500)}function F(e,a){$(".achievement_bubble").remove(),"undefined"==typeof e&&(e="unlocked"),$("body").append('<div class="achievement_bubble"><img src="'+ht+'/achievement_thumb.png" /><span id="title">'+Y("Achievement")+": "+e+'</span><span id="description">'+a+"</span></div>"),setTimeout("$('.achievement_bubble').fadeOut(1000);",1e4)}function E(e){e=e.substring(2).split("&")[0].split(",");var t=["[disaster]! Help [name] the [title] by selling [amount] [type] flavour ice cream cones.","[disaster]! Help [name] the [title] by feeding your cow [amount] bushels of hay.","[name] the [title] wants the perfect cone. Reach expertise 10 with [type] flavour",'[title] [name] needs you to sell [amount] [type] flavour ice cream cones. He says: "[disaster]."'],s=["There's a huge flood and the ice cream supply factories are closing down","Global warming is leading to a shortage of ice cream","The ice cream republic is passing a bill that will outlaw ice cream","Ice cream has been banned from schools, causing a black market ice cream trade to spring up","Gandhi threatens your ice cream stand with nuclear war if his appetite isn't quenched","Sic Semper Tyrannis! An evil tryant has just been revealed to be allergic to ice cream","He who controls the ice cream controls the universe","Sell! Sell! Sell!","Ice cream is HOT right now. Quickly before it melts","Plutonians love Ice Cream (and being told pluto is a planet), they are also very rich","Gotham is in trouble. A clown is holding hostages ransom and demands ice cream","An icey king has taken the Princess hostage. You must rescue her","A giant is rampaging across the countryside. Calm her down with some ice cream","The cold has become a real bother for me. Please sort that out"],n=["Sam","Jordi","Shai","Nubbins","Skulk","Doran","Cassia","Maaaaarrrrr","Ben","Tim","Kip","Mon Mon","Soup","Jenkins","Hatty","Davos","Joffery","Tyrion","Jessica","Scroopy Noopers","Morty","PJ"],o=["Glutinous","Malcontent","Stupendous","Enchanter","Visionary","Golden","Grumpy","Aged","Unfortunate","Sweet-tooth","Artist","Magician","Cold","Stone Cold"],r=Icecream.get_flavor(e[4]).name;return t[e[0]].replace("[disaster]",s[e[1]]).replace("[name]",n[e[2]]).replace("[title]",o[e[3]]).replace("[type]",r).replace("[amount]",a(e[5]))}function O(e){for(var a=ya.achievements.length,t=0;a>t;t++)if(ya.achievements[t]===e)return;ya.achievements.push(e),$.ajax({url:"register_achievement",data:"id="+e,dataType:"JSON",type:"POST",success:function(e){e.name&&e.description?F(e.name,e.description):console.log(e)}})}function j(){M(". . .","Achievements"),$.ajax({url:"achievements",dataType:"JSON",type:"GET",success:function(e){for(var a="",t="",s=e.length,n=ya.achievements.length,o=0;s>o;o++){for(var r=e[o],i=!1,l=0;n>l;l++)if(ya.achievements[l]===r._id){i=!0;break}i?a+=D(r):t+=D(r)}M("<h5>Achievement points: "+10*ya.achievements.length+'</h5><div class="achievements_unlocked">'+a+'</div><h5>Remaining Achievements...</h5><div class="achievements_locked">'+t+"</div>","Achievements")}})}function D(e){return'<div class="achievements_container" x-id="'+e._id+'"><div class="achievement_badge">'+(e.badge_id?'<img src="'+ht+"/badges/"+e.badge_id+'.png" />':"")+'</div><div class="achievement_descript"><b>'+e.name+"</b>"+e.description+"</div></div>"}function N(e){if(0==ja||-1===ut)return void console.log("expertise bp1");for(var t=ya.flavors_sold[ut],s=0,n=0,o=0,r=0;15>=r;r++){var i=Ga[r]+o;if(15==r||i>t){s=r,15>r?n=i:(n=0,t=0,o=0);break}o=i}Qa!=s&&(1==s&&O("52857dd1def8030000000001"),5==s&&O("5287a8051834ee0000000003"),10==s&&O("5287a7dd1834ee0000000002"),15==s&&O("53eac41538574559408a53e1"),Icecream.update_worker_fx("expertise"),Qa=s,$('#main_base .option[x-id="'+ya.last_flavor+'"]').parent().find(".expertise_level").text(s),b("expertise"));var l,c=100*((t-o)/(n-o));15==s?(c=100,l="MAX"):l=a(t-o)+" / "+a(n-o),0==$(".expertise_bar_outer").length?$(".sell_value").after('<div class="expertise_bar_outer tooltip" x-type="expertise"><div class="expertise_bar_inner" style="height: '+(100-c)+'%;"></div><div class="expertise_hover">'+l+'</div><div class="expertise_number">'+s+'</div><div class="expertise_ball"></div></div>'):($(".expertise_bar_inner").css("height",100-c+"%"),$(".expertise_number").text(s),$(".expertise_hover").text(l)),e&&"function"==typeof e&&e()}function A(){for(var e=ya.flavors.length,a=0;e>a;a++)for(var t=$("#main_base .option").eq(a),s=0,n=0;15>=n;n++){var o=Ga[n]+s;if(ya.flavors_sold[a]<o||15==n){0==t.parent().find(".expertise_level").length?t.after('<div class="expertise_level">'+n+"</div>"):t.parent().find(".expertise_level").text(n);break}s=o}}function P(e){za+=e,ya.gold+=parseFloat(Ma),ut>-1&&(ya.flavors_sold[ut]=parseInt(ya.flavors_sold[ut])+e,N(function(){Icecream.update_quest_bar()}))}function z(){if(console.log("init canvas"),Tt!=$(document).height()){It=window.innerHeight,Tt=$(document).height(),Ft=$("#canvas_main").width(),$("canvas").each(function(){$(this).attr("width",$(this).width()),$(this).attr("height",$(this).height())});var e=$(".chat.main_container").height();$(".chat.main_container").is(":visible")||(e=0),Va=parseInt($("canvas#canvas_main").attr("width")),ta&&!ra&&(ra=new Image,ra.src=ht+"/cones/thumb/"+ta+".png.gz")}for(var a=0;4>a;a++)nt[a]||(nt[a]=new Image,nt[a].src=ht+"/clouds/cloud_"+(a+1)+".png");if(ia||(ia=new Image,ia.src="https://s3.amazonaws.com/icecreamstand.com/sell_cold_sprite.png"),!it[6]){var t=Icecream.get_flavor(ya.last_flavor);it[6]=new Image,it[6].src=ht+"/flavours/thumb/"+t.name.replace(/\s+/g,"")+".png.gz",lt[6]=document.getElementById("topping")}}function R(){var e=$(".col_3.franken_left .option").attr("x-id"),a=$(".col_3.franken_right .option").attr("x-id");if(!e||!a)return"Select your flavours";var t=H(e,a);return'<span id="franken_name">'+t.name+"</span><br>$"+t.value+"<br>Duration: 20 minutes"}function H(e,a){for(var t,s,n=0;n<xa.length;n++){var o=xa[n];if(e===o._id&&(t=o),a===o._id&&(s=o),t&&s)break}if(!t||!s)return{name:"Mystery",value:"?"};var r=t.name.substring(0,t.name.length/2),i=s.name.substring(s.name.length/2),l=(.75*(t.value+s.value)).toFixed(2);return{name:r+i,value:l}}function L(){var e=$(".col_3.franken_left .option").attr("src"),a=$(".col_3.franken_right .option").attr("src");return e&&a?'<div class="franken_composite"><div class="franken_img" style="background-image: url('+e+')"></div><div class="franken_img second" style="background-image: url('+a+');"></div></div>':"&lt; - - - - - &gt;"}function U(){V.experience||(V.experience=1),V.happiness||(V.happiness=75);for(var e=0,a=0,t=0,s=0,n=0,o=0;o<V.items.length;o++){var r=V.items[o].split("/");3>o&&(r[1]&&(e+=parseInt(r[1])),r[2]&&(a+=parseInt(r[2])),("hat_jester"==r[0]||"accessory_marotte"==r[0])&&(t+=.05)),r[0].indexOf("afro")>-1&&s++,r[0].indexOf("crown")>-1&&n++}V.magic_find=t,V.total_bonus=10+V.level/2+V.strength+a,V.total_happiness=100+Math.floor((V.intelligence+e)/2);var i=(new Date-new Date(V.created_at))/864e5;i>20&&0==V.memories.length&&M('<p>If your cow could talk, what would it say? </p><textarea id="cow_memory"></textarea><input type="submit" class="button" value="Teach" id="cow_teach">',"Teaching "+V.name+" to talk"),12===s&&O("546b81c020a4efc62a12e68d"),12===n&&O("547c13af8ea9309921367dca")}function J(){if($("#unlock_cow, .cow > .cow_attachment, .cow > .cow_body").remove(),V.items&&V.level>=5)for(var e=0;e<V.items.length;e++){var a=V.items[e].split("/")[0].replace(/"/,"");if($(".cow").append('<div class="cow_attachment type_item" x-type="'+a+'">'),3===e)break}V.level<5&&(V.skin="baby"),$(".cow_level_bar").remove();var t=Math.ceil(V.level),s=100+(V.level-t)/.01;V.skin||(V.skin="default"),$(".cow").prepend('<div class="cow_body" x-skin="'+V.skin+'"></div><div class="cow_level_bar"><progress id="experience" value="'+s+'" max="100"></progress><progress id="happiness" value="'+V.happiness+'" max="'+V.total_happiness+'" x-full="'+(V.happiness==V.total_happiness)+'"></progress></div>')}function Y(e){if("en"===ua)return e;var a=gt[e];return a||(console.log("language cache miss for: "+e),a=gt[e]=e),a}function B(e){if(!e.user)return console.log("No user attached to this message");if($('.chat[x-id="'+e._id+'"]').length>0)return console.log("Message already loaded");if(ya.ignore_list&&ya.ignore_list.indexOf(e.user)>-1)return!1;if(!Wa){_t++;var a=Y(1==_t?"Chat Message":"Chat Messages");document.title=_t+" "+a+" - "+Y("Ice Cream Stand")}if(kt){var a=Y("Unread Message!");document.title=a+" - "+Y("Ice Cream Stand")}var t=$("<div />",{"class":"chat "+(e.is_admin?"admin":"normal")+(e.is_system?" message_system":""),"x-id":e._id,title:e.created_at}),s=$("<span />",{html:e.text.replace(/[\u00A0-\u9999<>\&]/gim,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/(https?:\/\/[^\s]*)/g,'<a href="$1" target="_blank">$1</a>'),"class":"chat_textbody"});s.find("a").each(function(){var e=$(this).attr("href"),a=e.substring(e.length-4);(".png"==a||".jpg"==a||".gif"==a)&&$(this).after('<div class="img_inline" x-href="'+$(this).attr("href")+'">view</div>')}),$(t).prepend(s);var n=$("<span />",{text:e.user,"class":"user_card","x-user":e.user});e.badge&&$(n).prepend('<img src="'+ht+"/badges/"+e.badge+'.png" class="chat_badge" />'),$(t).prepend(n),$("#chat_window").append(t);for(var o=$("#chat_window > .chat").length,r=$(".chat.main_container .expand").hasClass("active")?75:10;o>r;)$("#chat_window > .chat:first").remove(),o--}function W(e,a,t){var s=$('.friends_counter user[x-user="'+e+'"]');if(t||(t=!1),0===s.length){var n=$("<user />",{text:e,"class":a?"online":"offline","x-away":t,"x-user":e});n.append('<span class="friend_options"><span class="friend_delete"></span></span>'),$(a?".friends_list_online":".friends_list_offline").append(n)}else a&&s.parent().hasClass("friends_list_offline")&&s.detach().appendTo(".friends_list_online"),!a&&s.parent().hasClass("friends_list_online")&&s.detach().appendTo(".friends_list_offline"),s.attr("class",a?"online":"offline")}function G(e){At||(At=1);var t=Pt?2:1;$t=e*Ma*At*t,ha+=$t,yt++;a($t.toFixed(2));if(isNaN($t))return console.log("float value is NaN ("+e+" "+Ma+" "+At+")");10===yt?($("#icecream_float_text").remove(),$(".icecream").append('<div id="icecream_float_text">Icey x2</div>'),$("#icecream_float_text").animate({top:"0"},1e3,function(){$(this).remove()}),At=2):30===yt?($("#icecream_float_text").remove(),$(".icecream").append('<div id="icecream_float_text">Stone Cold x3</div>'),$("#icecream_float_text").animate({top:"0"},1e3,function(){$(this).remove()}),At=3):100===yt?($("#icecream_float_text").remove(),$(".icecream").append('<div id="icecream_float_text">Frosty x4</div>'),$("#icecream_float_text").animate({top:"0"},1e3,function(){$(this).remove()}),At=4):150===yt&&($("#icecream_float_text").remove(),$(".icecream").append('<div id="icecream_float_text">Frozen! x5</div>'),$("#icecream_float_text").animate({top:"0"},1e3,function(){$(this).remove()}),At=4),Nt&&($(".infocube_multiplier")[0].textContent=At+"x"+(Pt?" +2x":"")),!xt&&ha>ya.highest_accumulation&&(xt=!0);var s=$("<div />",{"class":"icecream_float",html:'<img src="http://static.icecreamstand.ca/coins2.svg" class="money_float" /><b>'+a($t.toFixed(2))+"</b>"});return $(".icecream").append(s),$(s).css("color","#"+Ca[Math.floor(Math.random()*Ca.length)]).animate({top:"0"},500,"easeInQuint",function(){$(this).remove()}),ya.is_animation_cones&&Wa&&50>Za&&(Ka.push(1==e?[6,50*parseInt(Math.random()*Ft/50),90*Math.floor(-3*Math.random()),1]:[6,50*parseInt(Math.random()*Ft/50),90*Math.floor(-3*Math.random()),1.5]),Za=Ka.length),!1}function Q(e){var a=$(e).attr("x-src");"undefined"!=typeof a&&($(e).attr("src",a),$(e).removeAttr("x-src"))}var V,X,K,Z,ea,aa,ta,sa,na,oa,ra,ia,la,ca,da,pa,ua,va,_a,ma,fa,ha,ga,ba="1.46",$a=["Main","Beta","Alpha"],ya={name:"newbie",gold:0},xa=[],wa=[],ka=null,Ca=["9a2f2f","5f2f9a","2f8f9a","2f9a39","919a2f","52509e","454392","4b4975","9a2f8f"],Ia=0,Ta=!0,qa=[],Ma=0,Sa=0,Fa=0,Ea=0,Oa=0,ja=0,Da=[0,0,0,0,0],Na=[0,0,0,0,0],Aa=[0,0,0,0,0],Pa=0,za=0,Ra=0,Ha=0,La=null,Ua=0,Ja={},Ya=!1,Ba=!1,Wa=!0,Ga=[15,50,150,300,600,900,1600,2400,4e3,1e4,5e4,95e3,225e3,1e6,5e6,1e7],Qa=0,Va=0,Xa=0,Ka=[],Za=0,et=[],at=0,tt=null,st=[],nt=[],ot=[],rt=!0,it=[0,0,0,0,0,0,0],lt=[0,0,0,0,0,0,0],ct=0,dt=0,pt="",ut=-1,vt=!1,_t=0,mt=0,ft=!0,ht="http://static.icecreamstand.ca",gt=[],bt=!1,$t=0,yt=0,xt=!1,wt=0,kt=!1,Ct=[],It=0,Tt=0,qt=[],Mt=[],St=!1,Ft=0,Et=15,Ot=!1,jt=!0,Dt={},Nt=!1,At=1,Pt=!1,zt=["cherries","sprinkles","jelly beans","peanuts","gummy worms","peanut butter","onions","honey","berry jelly","gummy sodas","blackberries","raspberries","chopped strawberries","marshmallow cream","vanilla frosting","chocolate frosting","crumbled candy bars","sugar cookies","crumbled brownies","crumbled fudge","red velvet cake","cookie dough","m&m's","oreo","chocolate chips","white chocolate chips","dark chocolate chips","pecans","acorns","almonds","gumballs","mini marshmallows","candied lemon rinds","rice","chili peppers","gravy","coconut","peas","fudge ripple","chopped peaches","chopped pineapple","croutons","fries","olives","candied bacon","bacon","shrimp","blueberries","raisins","waffles","cheese"];return $(document).ready(function(){function t(){$.ajax({url:"/me",type:"GET",dataType:"JSON",success:function(e){ya=e,$.ajax({url:"/combos",type:"GET",dataType:"JSON",success:function(e){qa=e;for(var a=ya.combos.length,t=0;a>t;t++){var s=ya.combos[t];if(0===$('.combo_option[x-id="'+s+'"]').length){var n=Icecream.get_combo(s);if("mystery"==n.name)console.log("combo load - mystery combo");else{var o=null,r=Icecream.get_flavor(n.flavor_id),i=Icecream.get_addon(n.topping_id);n.franken_id&&(o=Icecream.get_flavor(n.franken_id));var l=zt.indexOf(i.name)>-1,c=l?ht+"/addons/thumb/"+i.name.replace(/\W/g,"")+".png.gz":ht+"/toppings/"+i.name.replace(/\W/g,"")+".png",d=$("<div />",{"class":"combo_option tooltip option","x-type":"combo","x-id":s,"x-addon":i._id,"x-flavor":r._id,"x-franken":n.franken_id,"x-value":n.value,"x-name":n.name,"x-new-art":l,draggable:!0,style:"background-image:url("+c+"), url("+ht+"/flavours/thumb/"+r.name.replace(/\s+/g,"")+".png.gz)",html:n.name+(o?'<div class="combo_split" style="background-image: url('+ht+"/flavours/thumb/"+o.name.replace(/\s+/g,"")+'.png.gz)"></div>':"")});$(".flavor div#main_combo").prepend(d),$(d).wrap('<div class="option_wrapper"></div>')}}}$("#main_combo.inner_flavor_container .option_wrapper").each(function(){$(this).parent().is(".page_wrap")&&$(this).unwrap()});for(var p=$("#main_combo.inner_flavor_container .option_wrapper:gt(4)"),t=0;t<p.length;t+=15)p.slice(t,t+15).wrapAll("<div class='page_wrap' x-page='"+Math.floor(t/15)+"' style='display:none;'></div>");$(".flavor.main_container .expand").hasClass("active")&&Icecream.paginate(0)}})}})}function s(){$(".shop_table tr:gt(5)").hide()}function r(e,t,s){return e+'<tr><td><img src="https://s3.amazonaws.com/icecreamstand.com/items/'+t.replace(/\s/g,"")+'.png" class="tooltip inventory_thumb" x-type="item" x-name="'+t+"/"+s.int+"/"+s.str+"/"+s.con+"/"+s.rarity+'" /> '+t.replace(/_/g," - ")+'</td><td><div class="shop_button button" x-cost="'+s.cost+'" x-item="'+t+'"><span class="money_icon is_white">'+a(s.cost)+"</span></div></td></tr>"}function i(e,t,s){console.log("displaying skin: "+t);var n="";if(s["match-expertise"]){var o=Icecream.get_flavor(s["match-expertise"]);n="Requires level 15 expertise with "+o.name}return s.note&&(n=s.note),e+'<tr><td class="skin_td"  x-background="'+s.background+'"><img src="https://s3.amazonaws.com/icecreamstand.com/skins/'+t.replace(/\s/g,"").toLowerCase()+'.png" class="tooltip inventory_thumb thumb_wide" x-type="skin" x-name="'+t+'" /></td><td>'+t.replace(/_/g," - ")+'<div class="item_req">'+n+'</div></td><td><div class="shop_button button" x-cost="'+s.cost+'" x-item="'+t+'" x-is-skin="true" x-unlocked="'+(V.skins_unlocked&&V.skins_unlocked.indexOf(t)>-1)+'"><span class="money_icon is_white">'+a(s.cost)+"</span></div></td></tr>"}function l(){return"<table><tr><td>Total money</td><td>$"+a(ya.total_gold.toFixed(2))+"</td></tr><tr><td>Total money this prestige</td><td>$"+a(ya.total_prestige_gold.toFixed(2))+"</td></tr><tr><td>Today's money</td><td>$"+a(ya.today_gold.toFixed(2))+"</td></tr><tr><td>This week's money</td><td>$"+a(ya.week_gold.toFixed(2))+"</td></tr><tr><td>Money from friends</td><td>"+a(parseFloat(ya.friend_total_gold).toFixed(2))+"</td></tr><tr><td>Sale Accumulation Record</td><td>"+a(ya.highest_accumulation.toFixed(2))+"</td></tr><tr><td>Ice Cube Time Record</td><td>"+Math.floor(ya.accumulation_time/60)+":"+ya.accumulation_time%60+"</td></tr><tr><td>Flavours</td><td>"+ya.flavors.length+"</td></tr><tr><td>Add-ons</td><td>"+ya.toppings.length+"</td></tr><tr><td>Quests</td><td>"+ya.quests.length+"</td></tr><tr><td>Ice cream sold</td><td>"+a(ya.icecream_sold)+"</td></tr><tr><td>Sales every "+(5-.25*ya.upgrade_machinery)+" seconds</td><td>"+Ha+"</td></tr><tr><td>Hours since first win ice cube bonus:</td><td> "+((new Date-new Date(ya.last_icecube_at))/1e3/60/60).toFixed(2)+" Hours</td></tr><tr><td>Prestige Values: </td><td>"+ya.prestige_array.join("<br>")+"</td></tr></table>"}function c(e){console.log("marking "+e+" read"),kt=!1,$.ajax({url:"message/read/"+e,dataType:"json",type:"post",success:function(){if(Icecream.sync_messages(),$("message-controls").length>0){var e=parseInt($("message-controls").attr("x-start"));h(e)}}})}function d(e){$.ajax({url:"user/"+e,success:function(e){if(e.error)return void M(e.error,"Error");e.prestige_level||(e.prestige_level=0),e.prestige_bonus||(e.prestige_bonus=0);var t="Add Friend</div>",s="true";ya.friends&&ya.friends.indexOf(e._id)>-1?(t=e.friend?"Mutual Friend":"Your Friend",s="false"):e.friend&&(t="Return Friends");var n="<1 minute"===e.updated_at?"online":"offline",o="";if(e.cow){var r=!1;if(e.cow.level<5)e.cow.skin="baby";else if(e.cow.items)for(var i=0;i<e.cow.items.length&&!(i>3);i++){var l=e.cow.items[i].split("/")[0].replace(/"/g,"");"wings_rainbow"==l&&(r=!0),o=o+'<div x-type="'+l+'" class="cow_attachment type_item"></div>'}o='<div class="user_cow_inner"><div class="cow_body" x-skin="'+e.cow.skin+'" />'+o+"</div>"}var c=e.created_at?new Date(e.created_at):new Date,d=new Date-c,p=Math.floor(d/1e3/60/60/24),u=["http://static.icecreamstand.ca/flavours/vanilla.png","http://static.icecreamstand.ca/flavours/strawberry.png","http://static.icecreamstand.ca/flavours/blueberry.png"],v=u[0];e.quests>2&&(v=u[1]),e.prestige_level>1&&(v=u[2]);for(var _=zt.indexOf(e.last_addon)>-1,m=_?ht+"/addons/thumb/"+e.last_addon.replace(/\s+/g,"")+".png.gz":ht+"/toppings/"+e.last_addon.replace(/\s+/g,"")+".png",f="",i=0;i<e.cows.length;i++)f=f+'<div class="user_cow_title" x-num="'+i+'" x-id="'+e.cows[i]._id+'">'+e.cows[i].name+'<span class="cow_card_level">lv'+Math.floor(e.cows[i].level)+"</span></div>";var h="",g="";if(e.badges&&e.badges.length>0){for(var b=e.badges.length,i=0;b>i;i++)h=h+'<img src="'+ht+"/badges/"+e.badges[i]+'.png" class="user_info_badge" />';g='<img src="'+ht+"/badges/"+e.badges[0]+'.png" class="user_badge_avatar" />'}M('<div class="user_info_sash"><div class="badges">'+h+'</div></div><div class="user_info_inner"><div class="user_info_nav"><div class="user_info_tab user_info_tab_active" x-section="1">Player</div><div class="user_info_tab" x-section="2">Store</div><div class="user_info_tab" x-section="3">Stats</div></div><div class="playercard_anchor" x-anchor="1" style="display: block;"><table><tr><td style="text-align:center;"><img src="http://www.gravatar.com/avatar/'+e.gravatar+"?s=200&d="+v+'" class="gravatar" /><div class="button send_message" x-user="'+e.name+'">Message</div><div class="button add_friend" x-enabled="'+s+'" x-user="'+e.name+'">'+t+'</div></td><td><div class="user_icecream_holder"><div class="user_icecream" style="background-image: url('+ht+"/flavours/thumb/"+e.last_flavor.replace(/\s+/g,"")+".png.gz), url("+ht+"/cones/"+e.cone+'.png.gz)"><img src="'+m+'" x-new-art="'+_+'" class="user_addon" /></div></div></td></tr></table></div><div class="playercard_anchor" x-anchor="2"><table><tr><td><b>Carts</b> '+e.carts+"</td><td><b>Employees</b> "+e.employees+"</td></tr><tr><td><b>Trucks</b> "+e.trucks+"</td><td><b>Robots</b> "+e.robots+"</td></tr><tr><td><b>Rockets</b> "+e.rockets+"</td><td><b>Aliens</b> "+e.aliens+"</td></tr><tr><td><b>Coldhands</b> "+e.cold_hands+"</td><td><b>Autopilot</b> "+e.autopilot+'</td></tr></table></div><div class="playercard_anchor" x-anchor="3"><table><tr><td><b>Flavors</b> '+e.flavors+"</td><td><b>Add-ons</b> "+e.toppings+"</td></tr><td><b>Prestige</b> "+e.prestige_bonus+"% </td><td><b>Quests</b> "+e.quests+"</td></tr><td><b>Combos</b> "+e.combos+"</td><td><b>Player for</b> "+p+" days</td></tr><td><b>Channel</b> "+e.release_channel+"</td><td><b>Ice Cube time</b> "+Math.floor(e.accumulation_time/60)+":"+(e.accumulation_time%60).toFixed(1)+"</td></tr><td><b>Sold</b> "+a(e.sold)+(ya.is_mod||ya.is_admin?"<td><b>ID</b> <small>"+e._id+"</small>":"")+'</td></tr></table></div><div class="playercard_anchor" x-anchor="4">Achievements</div><div class="user_bottom_panel"><time class="'+n+'" title="Last seen '+e.updated_at+' ago." x-away="'+e.is_away+'"></time></div><div class="user_cow" x-user="'+e.name+'" x-night="'+e.is_night+'">'+f+o+"</div>",g+" "+e.name.substring(0,1).toUpperCase()+e.name.substring(1)+", "+e.title)},error:function(){M("failed to load user card","Error")}})}function p(){var e=ot.length;if(0!==e){var t=(new Date-fa)/1e3,s=Math.floor(t/60),n=(t%60).toFixed(1);$(".infocube_time")[0].textContent=(10>s?"0":"")+s+":"+(10>n?"0":"")+n,$(".infocube_money")[0].textContent=a(ha.toFixed(0));var o=yt/25;o>10&&(o=10);for(var r=0;e>r;r++){var i=ot[r];!i||!i[0]||Nt&&8==i[4]||(i[0]-=1+o,i[0]<0-o&&(u(),i[0]=200))}}}function u(){if(console.log("... ending ice cubes"),ma.emit("accumulation",{a:ha,t:(new Date-fa)/1e3,is_first_win:Pt}),setTimeout(function(){$(".cube_infobar").remove(),$("#canvas_sales").hide(),ot=[],oa.clearRect(0,0,300,300)},3e3),clearInterval(ga),Nt=!1,At=1,xt&&($(".icecream").append('<div id="icecream_float_text">New Record ('+a(ha.toFixed(0))+")</div>"),$("#icecream_float_text").animate({top:"0"},3e3,function(){$(this).remove()}),ya.highest_accumulation=ha),Pt&&(Pt=!1,$('.buff[x-id="firstwin"]').remove()),Mt.length>0){for(var e=0;e<Mt.length;e++){var t=Mt[e];M(t.msg,t.title)}Mt=[]}}function v(e,a){for(var t=0;t<ot.length;t++){var s=ot[t];if(m(s[1],e,s[2],a,40))return!0}return!1}function _(e){var a,t;do a=25+160*Math.random(),t=25+125*Math.random();while(v(a,t));if(e){var s=Math.random()<.025;return void ot.push([s?100:150,a,t,8,s?9:8])}var n=Math.floor(yt/10);n>7&&(n=7),ot.unshift([100,a,t,8,n]),n>2&&_(!0),n>5&&_(!0),7===n&&_(!0)}function m(e,a,t,s,n){return e>a-n&&a+n>e&&t>s-n&&s+n>t}function f(e,a,t){e||a&&(e=a,a=""),t||(t=""),M((a?"<p>"+a+"</p>":"")+'<textarea id="friend_message_textarea" placeholder="Message">'+t+'</textarea><button x-user="'+e+'" id="friend_message_button">Send</button>',Y("Message")+" "+e.substring(0,1).toUpperCase()+e.substring(1)),$("#friend_message_textarea").select().focus()}function h(e,a){a||(a=5),console.log("displaying messages "+e+" - "+(e+a)),$.ajax({url:"messages",data:{start:e},success:function(t){var s="",n=t.length;if(0==n)s="<tr><td>-</td><td>You have no messages</td></tr>";else for(var o=0;n>o;o++){var r=t[o];if(r){var i=r.is_read?"Unread":"Read",l=(new Date(r.created_at)+"").split(" "),c=r.badge_id?'<img src="'+ht+"/badges/"+r.badge_id+'.png" class="message_badge" />':"";s=s+'<tr><td id="message_status_'+i+'"><user x-user="'+r.from+'">'+c+r.from+"</user><time>"+[l[1],l[2],l[4]].join(" ")+'</time></td><td class="message_body">'+r.text.replace(/(<|>)/gi,"")+'</td><td class="message_options" x-id="'+r._id+'"><span id="message_mark_read">Mark '+i+'</span><span class="friend_reply" x-user="'+r.from+'"></span><span id="message_remove">X</span></td></tr>'}if(o>=a)break}var d="Messages "+e+" to "+(e+a);e>0&&(d="<message-prev>Back</message-prev>"+d),5===n&&(d+="<message-next>Next</message-next>"),M('<table id="message_list">'+s+'</table><message-controls x-start="'+e+'" x-len="'+a+'">'+d+'</message-controls><div id="compose_message"><input id="compose_to" placeholder="Player"><button id="compose_send">Write</button></div>',"Private Messages")}})}function g(e){$.ajax({url:"friend/new",data:{friend:e},type:"POST",dataType:"JSON",success:function(a){var t=e.substring(0,1).toUpperCase()+e.substring(1);return a.err?M(a.err,"Can not add friend"):(ya.friends=a.friends,ct="",Icecream.sync_friends(),void M("Added "+t+" as a friend!","New Friend"))}})}function x(e,a){for(var t=50,s=120,n=0;Za>n;n++){var o=Ka[n],r=o[1],i=o[2];if(e>r&&r+t>e&&a>i&&i+s>a){na.clearRect(o[1],o[2]-25,50*o[3],100*o[3]),et.push({x:o[1],y:o[2]-10,width:68.5*o[3],height:50*o[3],speed:Math.random()<.5?-5:5,variation:Math.floor(4*Math.random())}),at++,Ka.splice(n,1),Za--;for(var n=0;2>n;n++)$(".icecream").trigger("mousedown")}}}ua=$("html").attr("lang"),Xa=$(document).height(),"en"!==ua&&$.ajax({url:ht+"/"+$("html").attr("lang")+".json.gz",type:"GET",dataType:"JSON",success:function(e){gt=e},error:function(e){console.log("error loading languages: "+e)}}),I("start",function(){}),$("body").on("click",".flavor .flavor_tab",function(){var e=$(this).attr("x-id");$(".flavor .inner_flavor_container").hide(),$("#"+e).show().find("img[x-src]").each(function(){var e=$(this).attr("x-src");"undefined"!=typeof e&&$(this).attr("src",e).removeAttr("x-src")}),$(".flavor .flavor_tab.active").removeClass("active"),$(this).addClass("active"),tt>0&&(tt=0),Icecream.paginate(tt),"main_combo"==e?t():"main_franken"==e&&($("#main_franken").remove(),$(".flavor").append('<div class="inner_flavor_container" id="main_franken"><div class="col_3 franken_left"><div class="option_wrapper"></div></div><div class="col_3 franken_center"><b>&lt; - - - - - &gt;</b><p>Select your flavours<br><br></p><button>Combine!</button></div><div class="col_3 franken_right"><div class="option_wrapper"></div></div></div>')),z()}),$("body").on("click",".franken_option",function(){for(var e,a=$(this).text(),t=xa.length,s=0;t>s&&(e=xa[s],e.name!=a);s++);var n=e.name.replace(/\s+/g,"");$(this).closest(".col_3").find(".option_wrapper").html('<img x-type="base" x-value="'+e.value+'" x-base-value="'+e.base_value+'" class="option tooltip" x-id="'+e._id+'" id="'+n+'" src="'+ht+"/flavours/thumb/"+n+'.png.gz">'),$(".franken_selector").remove(),$(".franken_center p").html(R()),$(".franken_center b").html(L())}),$("body").on("click","#main_franken button",function(){var e=$(".col_3.franken_left .option").attr("x-id"),a=$(".col_3.franken_right .option").attr("x-id");return e&&a&&e!=a?void $.ajax({url:"/last/franken",data:{one:e,two:a},dataType:"json",type:"POST",success:function(t){return t.message?M(t.message):(ya.last_flavor=e,ya.last_frankenflavour=a,ya.last_frankenflavour_at=new Date,I("base"),void _gaq.push(["_trackEvent","Flavour","Combined a frankenflavour",$("#franken_name").text()]))}}):M("Please select two different flavours to combine.")}),$("body").on("click","#main_franken .option_wrapper",function(e){$(".franken_selector").remove(),$(this).after('<div class="franken_selector"><div class="selector_nav"><div class="col_3 active" x-show="selector_normal">Normal</div><div class="col_3" x-show="selector_heroic">Heroic</div><div class="col_3" x-show="selector_legendary">Legendary</div></div><p id="selector_normal"></p><p id="selector_heroic" style="display: none;"></p><p id="selector_legendary" style="display: none;"></p><div class="franken_close">Close</div></div>');for(var a=xa.length,t=0;a>t;t++)72>t?$(".franken_selector p#selector_normal").append('<div class="franken_option">'+xa[t].name+"</div>"):81>t&&ya.upgrade_frankenflavour>=2?$(".franken_selector p#selector_heroic").append('<div class="franken_option">'+xa[t].name+"</div>"):3==ya.upgrade_frankenflavour&&$(".franken_selector p#selector_legendary").append('<div class="franken_option">'+xa[t].name+"</div>");return e.stopPropagation(),e.stopImmediatePropagation(),!1}),$("body").on("click",".franken_selector .col_3",function(){$(".franken_selector .col_3").removeClass("active"),$(this).addClass("active");var e=$(this).attr("x-show");$(".franken_selector p").hide(),$(".franken_selector p#"+e).show()}),$("body").on("click",".franken_close",function(){$(".franken_selector").remove()
}),$("body").on("click",".highscores .button_container .flavor_tab, .highscores .flavor_tab#hide",function(){return"hide"==$(this).attr("id")?($(".highscores").hide(),void z()):($(this).parent().find(".active").removeClass("active"),$(this).addClass("active"),void $(".refresh_highscores").click())}),$("body").on("click",".tab",function(){return $(this).hasClass("locked")?!1:($(".tab.active").removeClass("active"),$(this).addClass("active"),$(".flavors_inner, .employees_inner, .upgrades_inner, .toppings_inner, .cones_inner").hide(),$("."+$(this).attr("id")+"_inner").show(),void $("."+$(this).attr("id")+"_inner img[x-src]").each(function(){var e=$(this).attr("x-src");"undefined"!=typeof e&&$(this).attr("src",e).removeAttr("x-src")}))}),$("body").on("click",".controls_forward",function(){return $(".tab#flavors").hasClass("active")&&$(".flavors_inner .unlockable:visible").slice(0,5).hide(),$(".tab#toppings").hasClass("active")&&$(".toppings_inner .unlockable:visible").slice(0,5).hide(),!1}),$("body").on("click",".controls_show",function(){return $(".tab#flavors").hasClass("active")&&($(".flavors_inner .unlockable:hidden").show(),$(".flavors_inner").css("overflow-y","scroll")),$(".tab#toppings").hasClass("active")&&($(".toppings_inner .unlockable:hidden").show(),$(".toppings_inner").css("overflow-y","scroll")),!1}),$("body").on("click",".controls_back",function(){return $(".tab#flavors").hasClass("active")&&$(".flavors_inner .unlockable:hidden").slice(-5).show(),$(".tab#toppings").hasClass("active")&&$(".toppings_inner .unlockable:hidden").slice(-5).show(),!1}),$("body").on("click",".flavor .expand",function(){$(".page_wrap").hide(),$(this).hasClass("active")?($("#main_base, #main_addon, #main_combo, #main_cone").removeClass("expanded").css("overflow","hidden"),$(this).text("Expand").removeClass("active"),$(".filter_box").remove(),tt=null):(tt=0,$("#main_base, #main_addon, #main_combo, #main_cone").addClass("expanded").css("overflow","visible"),Icecream.paginate(tt),$(this).text("Minimize").addClass("active")),z()}),$("body").on("click",".quests .expand",function(){$(this).hasClass("active")?($(".quest").hide(),$(".quest:first").show(),$(this).text("Expand").removeClass("active")):($(".quest").show(),$(this).text("Minimize").addClass("active")),z()}),$("body").on("click",".shop_button",function(){var e=$(this).attr("x-item"),a="true"==$(this).attr("x-is-skin"),t=parseInt($(this).attr("x-cost"));if(!isNaN(t)&&ya.gold<t)return M("<p>You need more money to buy this item!</p>","Can not Afford");if(!V)return M('<p>"Come back when you have a cow."</p><p>Who said that? You only see a cart.</p>',"A talking cart?");if(e&&!a){if(V.items.length>=12)return M("<p>Your inventory is full</p>","Inventory Full");M('<p>Success! You have purchased <b class="tooltip" x-type="item" x-name="'+e+'">'+e.replace(/_/g," - ")+"</b> for "+V.name+".</p>","Purchased")}return a&&V.skins_unlocked&&V.skins_unlocked.indexOf(e)>-1?M("<p>You already own the <b>"+e+"</b> cow skin.</p>","Already own"):void $.ajax({url:"/shop/item",data:{item:e},dataType:"json",type:"post",success:function(e){return e.error?M(e.error):(isNaN(t)||(ya.gold=ya.gold-parseInt(t)),e.gamble?(V={},Icecream.sync_cow(function(){J(),b("shopping")}),M('<p>Success! You have found a <b class="tooltip" x-type="item" x-name="'+e.gamble+'">'+e.gamble.split("/")[0].replace(/_/g," - ")+"</b> for "+e.cow.name+".</p>","Mystery Item")):e.unlocked_skin?(V.skins_unlocked||(V.skins_unlocked=[]),V.skins_unlocked.push(e.skin),M("<p>Success! You have unlocked the <b>"+e.unlocked_skin+"</b> skin for "+V.name+".</p>","Skin Unlocked")):(V=e,J(),void I()))}})}),$("body").on("click",".chat.main_container .expand",function(){$(this).hasClass("active")?($(".chat.main_container").attr("x-expand",!1),$("#chat_window").css("overflow-y","hidden"),$(this).text("Expand").removeClass("active")):($(".chat.main_container").attr("x-expand",!0),$("#chat_window").css("overflow-y","scroll"),$(this).text("Minimize").addClass("active")),pt="",$("#chat_window").text(""),Icecream.sync_chat(),Icecream.sync_online()}),$("body").on("click",".tooltip_click",function(){$(this).addClass("tooltip").trigger("mouseover")}),$("body").on("mouseout",".option, .unlockable, .tooltip, .hovercard",function(){$(".hovercard").remove(),$(this).hasClass(".tooltip_click")&&$(this).removeClass(".tooltip")}),$("body").on("click",".shop",function(){$.ajax({url:"https://s3.amazonaws.com/icecreamstand.com/shop.json.gz",data:{cache:Math.random()},dataType:"json",success:function(e){var a='<tr><td><img src="https://s3.amazonaws.com/icecreamstand.com/gamble.png" class="tooltip inventory_thumb" x-type="gamble" /> Mystery Item</td><td><div class="shop_button button" x-cost="250000"><span class="money_icon is_white">250,000</span></div></td></tr>',t="",n="";for(var o in e){var l=e[o],c=l.cost;(!c||isNaN(c))&&(c=0),"skin"==l.type?t=i(t,o,l):l["match-name"]?l["match-name"]==ya.name&&(a=r(a,o,l)):l["match-badge"]?ya.badges&&ya.badges.indexOf(l["match-badge"])>-1&&(a=r(a,o,l)):l["match-epic"]?(console.log(l["match-epic"]+" - "+ya.epic_id),ya.epic_id&&ya.epic_id==l["match-epic"]&&(!l["match-epic-collected"]||ya.epic_collected>l["match-epic-collected"])&&(a=r(a,o,l))):c&&(a=r(a,o,l))}M('<div class="shop_nab button_container"><div class="settings_tab" x-active="true" x-area="shop_tab_items" x-type="shop">Items</div><div class="settings_tab" x-area="shop_tab_skins" x-type="shop">Skins</div><div class="settings_tab" x-area="shop_tab_badges" x-type="shop">Badges</div></div><table class="shop_table settings_area" x-active="true" x-index="0" x-page="5" x-area="shop_tab_items">'+a+'</table><table class="shop_table settings_area" x-area="shop_tab_skins" x-index="0" x-page="3">'+t+'</table><table class="shop_table settings_area" x-area="shop_tab_badges" x-index="0" x-page="5">'+n+'</table><div class="shop_page_container"><div onclick="Icecream.shop_paginate(-1)" class="filter_prev button"><img src="http://static.icecreamstand.ca/arrow.svg"></div><div onclick="Icecream.shop_paginate(1)" class="filter_next button"><img src="http://static.icecreamstand.ca/arrow_right.svg"></div></div>',"Bovine Boutique"),s()},error:function(e,a){console.log(a),M("The shop is closed.","Come back later!")}})}),$("body").on("click",".inline-message",function(){$(this).hide()}),$("body").on("mouseover",".tooltip",function(){if(!($(".hovercard").length>0)&&ya.is_tooltip){$("body").append('<div class="hovercard"><div></div></div>'),$(".hovercard").css("left",$(this).offset().left);var e,t=document.documentElement,s=(window.pageYOffset||t.scrollTop)-(t.clientTop||0),n=$(this).offset().top-20;150+s>n&&(n+=225,e=!0),$(".hovercard").css("top",n-s);var o=$(this).attr("x-type"),r=$(this).attr("x-id"),i=this;if(!o){o=$(this).parent().attr("x-type");var r=$(this).parent().attr("x-id");i=$(this).parent()}if("sales_cart"==o)$(".hovercard").html('<div class="hover_title">'+Y("Cart")+'<span class="level">'+ya.carts+"</span></div><p>"+Y("Automatically sells 1 ice cream every")+" "+(5-.25*ya.upgrade_machinery)+" "+Y("seconds")+'</p><p class="flavor_text">'+Y("Workers sell your top row. Can be leveled up to 1000.")+"</p>");else if("sales_employee"==o)$(".hovercard").html('<div class="hover_title">'+Y("Employees")+'<span class="level">'+ya.employees+"</span></div><p>"+Y("Automatically sells 2 ice cream every")+" "+(5-.25*ya.upgrade_machinery)+" "+Y("seconds")+'</p><p class="flavor_text">'+Y("Workers sell your top row. Can be leveled up to 1000.")+" "+Y("Unlocks after you have 10 Carts.")+"</p>");else if("sales_truck"==o)$(".hovercard").html('<div class="hover_title">'+Y("Truck")+'<span class="level">'+ya.trucks+"</span></div><p>Each truck automatically sells 3 ice creams every "+(5-.25*ya.upgrade_machinery)+' seconds</p><p class="flavor_text">Workers sell your top row. Can be leveled up to 1000. Unlocks after you have 25 Employees.</p>');else if("sales_robot"==o)$(".hovercard").html('<div class="hover_title">'+Y("Robot")+'<span class="level">'+ya.robots+"</span></div><p>Each robot automatically sells 5 ice creams every "+(5-.25*ya.upgrade_machinery)+' seconds</p><p class="flavor_text">Workers sell your top row. Can be leveled up to 1000. Unlocks after you have 50 Trucks.</p>');else if("sales_rocket"==o)$(".hovercard").html('<div class="hover_title">'+Y("Rocket")+'<span class="level">'+ya.rockets+"</span></div><p>Each rocket automatically sells 10 ice creams every "+(5-.25*ya.upgrade_machinery)+' seconds</p><p class="flavor_text">Workers sell your top row. Can be leveled up to 1000. Unlocks after you have 100 Robots.</p>');else if("sales_alien"==o)$(".hovercard").html('<div class="hover_title">'+Y("Alien")+'<span class="level">'+ya.aliens+"</span></div><p>Each alien automatically sells 15 ice creams every "+(5-.25*ya.upgrade_machinery)+' seconds</p><p class="flavor_text">Workers sell your top row. Can be leveled up to 1000. Unlocks after you have 250 Rockets.</p>');else if("machine"==o)$(".hovercard").html('<div class="hover_title">'+Y("Machinery")+'<span class="level">'+ya.upgrade_machinery+"</span></div><p>Increases the speed that your workers make ice cream. Currently it takes them "+(5-.25*ya.upgrade_machinery)+" seconds, level up to decrease it by .25s</p>");else if("research"==o)$(".hovercard").html('<div class="hover_title">'+Y("Flavor research")+'<span class="level">'+ya.upgrade_flavor+"</span></div><p>Each level unlocks 3 new flavors of ice cream</p>");else if("research_addon"==o)$(".hovercard").html('<div class="hover_title">'+Y("Add-on research")+'<span class="level">'+ya.upgrade_addon+"</span></div><p>Each level unlocks 3 new add-ons for your ice cream</p>");else if("trending"==o)$(".hovercard").html('<div class="hover_title">Trending</div>This flavour is in demand! Sell it quickly while it\'s hot. As it gets sold more it becomes less popular.<p class="flavor_text">Every 1,000 sales reduces the bonus by $0.05. After 75,000 sales the trend cycles out.</p>');else if("adopt_cow"==o)$(".hovercard").html('<div class="hover_title">'+Y("Adopt a Cow")+'</div>Adopt a helper to increase your Ice Cream sales. Cows can equip items, and have ability scores (Strength, Constitution, Intelligence).<p class="flavor_text">Cows persist through prestige. Adoption has a $100 fee.</p>');else if("friend"==o)$(".hovercard").html('<div class="hover_title">'+Y("Friend")+"</div><p>Make the Ice Cream Stand more exciting and play with friends. Every day your friends get a bonus .01% of any money you earn. This doesn't take away from what you earn. It's a fascimile of social interaction that gives you some of the benefits.</p>");else if("skin"==o)$(".hovercard").html('<div class="hover_title">'+$(this).attr("x-name")+"</div><p>This is a skin for your cow.</p>"),$(".hovercard").css("z-index",12);else if("item"==o){var l=0,c=0,d=0,p="",u=$(this).attr("x-name"),v=u.split("/"),_=v[0].replace(/_/g,": ");v[1]&&!isNaN(v[1])&&(l=v[1]),v[2]&&!isNaN(v[2])&&(c=v[2]),v[3]&&!isNaN(v[3])&&(d=v[3]);var m=v[4]?'<p class="rarity" x-rarity="'+v[4]+'">This item is '+v[4]+"</p>":"";("hat: jester"==_||"accessory: marotte"==_)&&(p='<p class="flavor_text">Improves your chances of finding rare items by 5%</p>'),"hat: birthday"==_&&(p='<p class="flavor_text">Only available on birthdays. Allows the wearer to /party.</p>'),v[5]&&(p='<p class="flavor_text">Created by '+v[5]+"</p>");var f="<p><b>Strength</b>: "+c+"<br><b>Constitution</b>: "+d+"<br><b>Intelligence</b>: "+l+"</p>";"hay"==u&&(f="This item <b>increases Happiness</b> by 10. Drag this onto your cow."),"rock"==u&&(f="This item <b>decreases Happiness</b> by 40. Drag this onto your cow."),$(".hovercard").html('<div class="hover_title" style="padding-left: 40px;">'+_+'</div><img src="'+ht+"/items/"+v[0].replace(/ /g,"")+'.png" class="tooltip_item" />'+f+m+p),$(".hovercard").css("z-index",12)}else if("gamble"==o)$(".hovercard").html('<div class="hover_title">'+Y("Mystery Item")+"</div><p>This will give you a mystery item, including items not normally available.</p>"),$(".hovercard").css("z-index",12);else if("strength"==o)$(".hovercard").html('<div class="hover_title">Strength</div><p>Strength increases the % bonus increase of your cow. Every 1 point of strength gives an additional 1% bonus to income.</p>'),$(".hovercard").css("z-index",12);else if("constitution"==o)$(".hovercard").html('<div class="hover_title">Constitution</div><p>Constitution decreases the rate at which your happiness declines. Each point in constitution decreases the decline rate by 5%.</p>'),$(".hovercard").css("z-index",12);else if("intelligence"==o)$(".hovercard").html('<div class="hover_title">Intelligence</div><p>Intelligence increases the total amount of happiness your cow can have. Every 2 points of intelligence increase your total happiness by 1.</p>'),$(".hovercard").css("z-index",12);else if("autopilot"==o)$(".hovercard").html('<div class="hover_title">'+Y("Autopilot")+'<span class="level">'+ya.upgrade_autopilot+"</span></div><p>automatically sells your active flavor for you. Selling once every 10 seconds per level of autopilot.</p><p>It can be leveled up to 250.</p>");else if("coldhands"===o)$(".hovercard").html('<div class="hover_title">'+Y("Cold Hands")+'<span class="level">'+ya.upgrade_coldhands+"</span></div><p>Clicking an Ice Cube sells an additional 0.25 Ice cream.</p><p>It can be leveled up to 100.</p>");else if("shop"===o)$(".hovercard").html('<div class="hover_title">'+Y("The Bovine Boutique")+"</div><p>Buy powerful items for your cow.</p>");else if("cone"===o)r||(r=$(this).find(".option").attr("x-id")),$(".hovercard").html("sugarcone"===r?'<div class="hover_title">Sugar Cone <span class="level flavor_current money_icon is_white">0.50</span></div><p>This cone gives a bonus with every sale.</p><p class="flavor_text">Cones only affect your sales and your autopilot sales. Cones persist through prestige and are affected by prestige and expertise.</p>':"babycone"===r?'<div class="hover_title">Baby Cone <span class="level flavor_current money_icon is_white">0.10</span></div><p>This cone gives a bonus with every sale.</p><p class="flavor_text">Cones only affect your sales and your autopilot sales. Cones persist through prestige and are affected by prestige and expertise.</p>':"chocolate"===r?'<div class="hover_title">Chocolate Dipped Cone <span class="level flavor_current money_icon is_white">0.25</span></div><p>This cone gives a bonus with every sale.</p><p class="flavor_text">Cones only affect your sales and your autopilot sales. Cones persist through prestige and are affected by prestige and expertise.</p>':"sprinkle"==r?'<div class="hover_title">Sprinkle Cone <span class="level flavor_current money_icon is_white">0.35</span></div><p>This cone gives a bonus with every sale.</p><p class="flavor_text">Cones only affect your sales and your autopilot sales. Cones persist through prestige and are affected by prestige and expertise.</p>':"waffle"==r?'<div class="hover_title">Waffle Cone <span class="level flavor_current money_icon is_white">0.75</span></div><p>This cone gives a bonus with every sale.</p><p class="flavor_text">Cones only affect your sales and your autopilot sales. Cones persist through prestige and are affected by prestige and expertise.</p>':"whitechocolate"==r?'<div class="hover_title">White Chocolate Cone <span class="level flavor_current money_icon is_white">1.00</span></div><p>This cone gives a bonus with every sale.</p><p class="flavor_text">Cones only affect your sales and your autopilot sales. Cones persist through prestige and are affected by prestige and expertise.</p>':'<div class="hover_title">Starter Cone <span class="level flavor_current money_icon is_white">0.00</span></div><p>This cone does not give a bonus when sold.</p><p class="flavor_text">Cones only affect your sales and your autopilot sales. Cones persist through prestige and are affected by prestige and expertise.</p>');else if("highscore"===o)r=$(this).attr("id"),$(".hovercard").html("this_day"===r?'<div class="hover_title">Daily Highscores</div><p>These are the totals for money earned today. This list resets at 12PM EST.</p>':"this_week"===r?'<div class="hover_title">Weekly Highscores</div><p>These are the totals for money earned this week. This list resets weekly.</p>':"all_time"===r?'<div class="hover_title">All Time Highscores</div><p>This is a leaderboard for total money earned. This list does not reset.</p>':"up_and_coming"===r?'<div class="hover_title">Up and Coming Highscores</div><p>This is a leaderboard for total money earned for accounts newer than 30 days.</p>':"prestige"===r?'<div class="hover_title">Prestige Highscores</div><p>This is a leaderboard for the total prestige amount.</p>':"cowlv"===r?'<div class="hover_title">Cow Highscores</div><p>This is a leaderboard for the cow levels of active cows.</p>':"accumulation_time"===r?'<div class="hover_title">Ice Cube Time Highscores</div><p>This is a leaderboard for the highest time accumulating ice cubes.</p>':'<div class="hover_title">Ice Cube Highscores</div><p>This is a leaderboard for the amount of money earned in one consecutive batch.</p>'),$(".hovercard").css("height",80);else if("inventory"===o){var _=$(this).attr("x-name");$(".hovercard").html('<div class="hover_title">'+_+'</div><img src="'+ht+"/items/"+_.replace(/\s+/g,"")+'.png" class="inventory_hover_img" /><p>This is an item in your inventory.</p>')}else if("ipm"===o){var h=5-.25*ya.upgrade_machinery,g=Ha/h*60,b=g*Fa,y=g*Sa,x=6*ya.upgrade_autopilot*Ma;$(".hovercard").html('<div class="hover_title">Income Breakdown</div><table class="ipm_breakdown"><tr><td>Average worker value</td><td>$'+Fa.toFixed(2)+"</td></tr><tr><td>Number of Sales</td><td>$"+Ha+"<br><tr><td>Income from workers</td><td>$"+a(b.toFixed(2))+"</td></tr><tr><td>Income from autopilot</td><td>$"+a(x.toFixed(2))+'</td></tr><tr style="display:none;"><td><b>Total before bonuses</b></td><td>$'+a((x+b).toFixed(2))+"</td></tr><tr><td>Income Bonus - Cow</td><td>$"+a(y.toFixed(2))+"</td></tr></table>")}else if("vote"===o){var w=$(this).attr("x-name"),k=w?"Vote for "+w:"Voting";$(".hovercard").html('<div class="hover_title">'+k+"</div><p>The ice cream conglomerates will influence perception and make the public want a flavour of ice cream enough to pay a premium.The flavour with the most votes will be the next to trend. The trending bonus goes up by $.05 for each vote. You can vote once every 10 minutes.</p>")}else if("expertise"==o)$(".hovercard").css("left","23%"),$(".hovercard").html('<div class="hover_title">Expertise level</div><p>Sell this flavor to raise your expertise level. Higher value flavors are more difficult to master. Each level gives a bonus +10% to the flavor\'s value for you and your workers. The maximum expertise level is 15.</p>');else if("frankenflavour"==o)$(".hovercard").html('<div class="hover_title">Frankenflavour</div><p>Combine two flavours into one stronger flavour. Frankenflavour transformations last 20 minutes.</p><p class="flavor_text">To unlock each of the additional tiers requires the item "lab parts". Frankenflavours do not last through prestige. </p>');else if("prestige"==o){$(".hovercard").css("height",180).css("font-size","12px");var C=T(ya);if(ya.prestige_level<8)$(".hovercard").html('<div class="hover_title">Prestige<span class="level">'+ya.prestige_bonus+"%</span></div><p><b>Restart the game with a bonus</b> based on cash balance, flavors unlocked, and add-ons unlocked</p><p>This restarts the game and increases sales values by "+parseFloat(parseFloat(ya.prestige_bonus)+parseFloat(C)).toFixed(5)+"%.You can upgrade Prestige up to 8 times, after that the lowest prestige bonus can be redone. Each time you upgrade you will get a bonus from 1-50% based on your progress. <b>This bonus adds with your past prestige bonuses.</b></p>");else{for(var I=ya.prestige_array[0],q=1;q<ya.prestige_array.length;q++)ya.prestige_array[q]<I&&(I=ya.prestige_array[q]);var M=parseFloat(parseFloat(ya.prestige_bonus)-parseFloat(I)+parseFloat(C)).toFixed(5);$(".hovercard").html('<div class="hover_title">Prestige<span class="level">'+ya.prestige_bonus+"%</span></div><p><b>Restart the game with a bonus</b>, overwriting your current lowest prestige score ("+parseFloat(I).toFixed(5)+"%)</p><p>New Prestige Bonus: "+M+"%</p>")}ya.last_prestige_at&&$(".hovercard").append('<div class="last_prestige">Last prestiged: '+ya.last_prestige_at.substring(0,10)+"</div>")}else if("heroic"==o)$(".hovercard").html('<div class="hover_title">Heroic Tier<span class="level">'+ya.upgrade_heroic+"</span></div><p>Unlock 3 high level flavors and add-ons. This can be upgraded 3 times.</p>");else if("legendary"==o)$(".hovercard").html('<div class="hover_title">Legendary Tier<span class="level">'+ya.upgrade_legendary+"</span></div><p>Unlock 3 high level flavors and add-ons. This can be upgraded 2 times. You must have 1 level of Prestige to unlock this.</p>");else if("combo"==o){for(var S=parseFloat($(i).attr("x-value")),F=0,E=0,O=xa.length,j=wa.length,q=0;O>q;q++)if(xa[q]._id==$(i).attr("x-flavor")){F=xa[q].value;break}for(var q=0;j>q;q++)if(wa[q]._id==$(i).attr("x-addon")){E=wa[q].value;break}$(".hovercard").html('<div class="hover_title">'+$(i).attr("x-name")+'<span class="level flavor_current">'+(S+F+E).toFixed(2)+"</span></div><p>Click this ice cream to switch to it for a bonus <b>$"+parseFloat($(this).attr("x-value")).toFixed(2)+'</b></p><p class="flavor_text">Combos are made by matching a certain base and addon into an even better flavor. Increases the value of the flavor.</p>')}else if("value"==o){var n=parseInt($(i).offset().top)-40;$(".hovercard").css("top",n-$(window).scrollTop()).css("margin-left",(Va/4-300)/2+"px");var D,N=Icecream.get_flavor(ya.last_flavor),A=Icecream.get_addon(ya.last_addon),P="Flavour",z="";if(ya.last_frankenflavour){P="Frankenflavour";var R=Icecream.get_flavor(ya.last_frankenflavour);D=.75*(N.value+R.value);var H=new Date-new Date(ya.last_frankenflavour_at);z='<span class="time_left">'+(20-H/1e3/60).toFixed(1)+" Mins</span>"}else D=N.value;var L=0;$(".hovercard").html('<div class="hover_title">'+$(".current_flavor").text()+"</div>"+z+'<p style="text-align: right;">'+P+" value: $"+parseFloat(D).toFixed(2)+"<br />Add-on value: $"+parseFloat(A.value).toFixed(2)+"<br /></p>"),Pa>0&&($(".hovercard p").append("Cone bonus: $"+parseFloat(Pa).toFixed(2)+"<br />"),L+=parseFloat(Pa));for(var q=0;q<qa.length;q++){var U=qa[q];U.flavor_id===ya.last_flavor&&U.topping_id===ya.last_addon&&($(".hovercard p").append("Combo bonus: $"+U.value.toFixed(2)+"<br />"),L+=U.value)}ya.last_flavor==X&&""!=X&&($(".hovercard p").append("Trending bonus: $"+parseFloat(Ia).toFixed(2)+"<br />"),L+=parseFloat(Ia)),ya.last_addon==K&&""!=K&&($(".hovercard p").append("Event bonus: $"+ya.trend_bonus+"<br />"),L+=ya.trend_bonus);var J=0;if(Qa>0&&(J=.1*(D+L)*Qa,$(".hovercard p").append(Qa+"0% (x $"+(D+L).toFixed(2)+") Expertise: $"+parseFloat(J).toFixed(2)+"<br />")),ya.prestige_bonus>0){var B=(D+L)*(ya.prestige_bonus/100);$(".hovercard p").append(ya.prestige_bonus+"% (x $"+(D+L).toFixed(2)+") Prestige: $"+parseFloat(B).toFixed(2)+"<br />")}$(".hovercard").css("left",$(i).offset().left-25+"px")}else if("base"==o){var W=Icecream.get_flavor($(i).attr("x-id"));if("mystery"!=W.name){var G=W.name.replace(/\s+/g,""),Q=!0,V=parseInt($(i).parent().find(".expertise_level").text());isNaN(V)&&(V=0);var Z=.1*W.value*V,ea=W.value*(ya.prestige_bonus/100),aa=W.value+Z+ea,sa=ya.flavors.indexOf(W._id),na=parseInt(ya.flavors_sold[sa])>0?ya.flavors_sold[sa]:"0";$(".hovercard").html('<div class="hover_title">'+Y(W.name)+'<span class="level flavor_current money_icon is_white">'+parseFloat(aa).toFixed(2)+"</span></div><p>"+W.description+'</p><p>Value <span class="money_icon">'+parseFloat(W.value).toFixed(2)+'</span> (Max <span class="money_icon">'+parseFloat(W.base_value).toFixed(2)+"</span>). "+Y("sold")+": "+a(na)+'</p><p class="flavor_text">'+Y("Flavour value fluctuates over time based on supply.")+"</p>"),$(".hovercard").attr("x-new-art",!0),$(".hovercard").append('<div class="icecream_hovercard_art" style="background-image: url('+ht+"/flavours/thumb/"+G+".png.gz), url(http://static.icecreamstand.ca/cones/thumb/"+(ta?ta:"default")+'.png.gz);"></div>')}else $(".hovercard").html('<div class="hover_title">'+Y($(i).attr("id"))+'<span class="level flavor_current">?</span></div><p>This flavour has not yet been unlocked</p><p>Maximum base value ? You\'ve sold: 0</p><p class="flavor_text">Flavour value fluctuates over time based on supply.</p>'),$(".hovercard").attr("x-new-art",!0),$(".hovercard").append('<div class="icecream_hovercard_art" style="background-image: url('+ht+"/flavours/thumb/"+$(i).attr("id")+".png.gz), url(http://static.icecreamstand.ca/cones/thumb/"+(ta?ta:"default")+'.png.gz);"></div>')}else if("addon"==o){var oa=Icecream.get_addon($(i).attr("x-id")),Q=zt.indexOf(oa.name)>-1;if($(".hovercard").html('<div class="hover_title">'+Y(oa.name)+'<span class="level flavor_current money_icon is_white">'+(oa.value?oa.value.toFixed(2):"?")+"</span></div><p>"+Y("Add-ons can be used with a flavour to increase the value of ice cream.")+'</p><p class="flavor_text">'+Y("Add-ons increase the value of every ice cream you or your workers sell and do not decrease in value over time.")+"</p>"),Q){var W=Icecream.get_flavor(ya.last_flavor);$(".hovercard").attr("x-new-art",!0),$(".hovercard").append('<div class="icecream_hovercard_art" style="background-image: url('+ht+"/flavours/thumb/"+W.name.replace(/\s+/g,"")+".png.gz), url(http://static.icecreamstand.ca/cones/thumb/"+(ta?ta:"default")+'.png.gz);"><img src="'+ht+"/addons/thumb/"+oa.name.replace(/\s+/g,"")+'.png.gz" class="hovercard_addon" /></div>')}}$(".hovercard").append(e?'<div class="triangle-up"></div>':'<div class="triangle-down"></div>')}}),$("body").on("click",".prestige_cancel",function(){$(this).parent().find(".button").show(),$(this).parent().find("button").remove(),$(this).parent().find(".prestige_cancel").remove()}),$("body").on("click",".button_quest",function(){$(".message_close:last").click()}),$("body").on("click",".prestige_button",function(){$(this).after('<button>Confirm</button><div class="button prestige_cancel">Cancel</div>'),$(this).hide()}),$("body").on("click",".currently_trending",function(){$("#main_base .option#"+$(this).attr("id")).click()}),$("body").on("click",".flavor .combo_option",function(){$('#main_base .option[x-id="'+$(this).attr("x-flavor")+'"]').click(),$('#main_addon .option[x-id="'+$(this).attr("x-addon")+'"]').click();var e=$(this).attr("x-franken");e&&$.ajax({url:"/last/franken",data:{one:$(this).attr("x-flavor"),two:e},dataType:"json",type:"POST",success:function(){I("flavour")}})}),$("body").on("click","#main_cone .option_wrapper",function(){ta&&b("main cone"),ta=$(this).find(".option").attr("id");var e={"default":0,babycone:.1,chocolate:.25,sprinkle:.35,sugarcone:.5,waffle:.75,whitechocolate:1};Pa=e[ta],$(".flavor #main_cone .selected").removeClass("selected"),$(this).addClass("selected"),$(".icecream").css("background-image",'url("'+ht+"/cones/"+ta+'.png.gz")')}),$("body").on("click","#main_addon .option_wrapper",function(){$("#main_addon .option_wrapper").removeClass("selected"),$(this).addClass("selected");var e=$(this).find(".option").attr("id"),a=zt.indexOf(e)>-1,t=a?ht+"/addons/"+e.replace(/\W/g,"")+".png.gz":ht+"/toppings/"+e.replace(/\W/g,"")+".png";$(".icecream #topping").attr("style","background-image: url("+t+");"),$(".icecream #topping").attr("x-addon",e).attr("x-new-art",a),(0===qa.length||ya.last_addon!=$(this).find(".option").attr("x-id"))&&(ya.last_addon=$(this).find(".option").attr("x-id"),$.ajax({url:"last_flavor",data:"f="+ya.last_flavor+"&a="+ya.last_addon,dataType:"JSON",type:"POST",success:function(e){qa=e,b("main addon"),Icecream.update_worker_fx("addon click")}}));parseFloat($("#main_base .option_wrapper.selected").attr("x-value"))+parseFloat($("#main_addon .option_wrapper.selected").attr("x-value"))}),$("body").on("click","#main_base .option_wrapper",function(){$(".flavor #main_base .option_wrapper").removeClass("selected"),$(this).addClass("selected");var e=$(this).find(".option").attr("x-id"),a=Icecream.get_flavor(e);$(".icecream, .sell_value").css("display","block");var t=a.name.replace(/\s+/g,""),s=!0;if(Nt&&u(),ya.last_flavor===e){if($(".icecream_franken, .icecream_flavour").remove(),$(".icecream").css('url("'+ht+"/cones/"+(ta?ta:"default")+'.png.gz")'),$(".icecream").prepend('<div class="icecream_flavour" x-name="'+t+'" x-new="'+s+'" style="background-image: url(https://s3.amazonaws.com/icecreamstand.com/'+(s?"flavours/":"")+t+".png"+(s?".gz":"")+');"></div>'),ya.last_frankenflavour){var n=Icecream.get_flavor(ya.last_frankenflavour),o=n.name.replace(/\s+/g,""),r=!0;$(".icecream").prepend('<div class="icecream_franken" x-name="'+o+'" x-new="'+r+'" style="background-image: url(https://s3.amazonaws.com/icecreamstand.com/'+(r?"flavours/":"")+o+".png"+(r?".gz":"")+');"></div>'),$(".icecream_flavour").attr("x-franken-half",!0)}b("main base"),z()}else ya.last_flavor=e,ya.last_frankenflavour=null,$.ajax({url:"last_flavor",data:"f="+ya.last_flavor+"&a="+ya.last_addon,dataType:"JSON",type:"POST",success:function(e){qa=e,N(),b("main base"),z()}}),$(".icecream").stop().animate({left:"-100%"},500,function(){$(".icecream_franken, .icecream_flavour").remove(),$(".icecream").prepend('<div class="icecream_flavour" x-name="'+t+'" x-new="'+s+'" style="background-image: url(https://s3.amazonaws.com/icecreamstand.com/flavours/'+t+'.png.gz);"></div>'),$(".icecream").animate({left:"0"},1e3)});ut=ya.flavors.indexOf(ya.last_flavor),N()}),$("body").on("mouseleave","#upgrades .unlockable button",function(){$(".unlock_update").remove()}),$("body").on("click","#upgrades .unlockable button",function(){var e=$(this).closest(".unlockable").attr("x-type"),t=this;return"prestige"==e&&(ft=!1),"legendary"==e&&0===ya.prestige_level?($(this).append('<div class="unlock_update">Requires 1 level of Prestige.</div>'),void setTimeout(function(){$(".unlock_update").remove(),$(".upgrade_error").removeClass("upgrade_error")},3e3)):($(this).hasClass("sell")&&$(this).addClass("upgrade_sell"),$(".unlock_update").remove(),$(".upgrade_error").removeClass("upgrade_error"),$(".upgrade_success").removeClass("upgrade_success"),void $.ajax({url:"/unlock",data:{id:$(this).closest(".unlockable").attr("x-id"),type:e,sell:$(this).hasClass("sell"),amount:$(this).attr("x-amount")},dataType:"JSON",type:"POST",success:function(e){if(e.message)return M(e.message,"Result");if(e.err&&M(e.err),e.error)ya.is_tooltip&&(isNaN(e.error)||(e.error=e.error>1e9?"Need $"+(e.error/1e9).toFixed(0)+"B":e.error>1e6?"Need $"+(e.error/1e6).toFixed(0)+"M":"Need $"+a(e.error)),$(t).addClass("upgrade_error").append('<div class="unlock_update">'+e.error+"</div>"),setTimeout(function(){$(".unlock_update").remove(),$(".upgrade_error").removeClass("upgrade_error")},1500));else{if(e.reload)return location.reload(!0);e.msg&&ya.is_tooltip&&($(t).addClass("upgrade_success").append('<div class="unlock_update">'+e.msg+"</div>"),setTimeout(function(){$(".unlock_update").remove(),$(".upgrade_success").removeClass("upgrade_success")},1500)),"base"==$(".upgrade_success").closest(".unlockable").attr("x-type")&&$("#main_base .option_wrapper").remove()}e.user&&(ya=e.user),e.success&&($(".hovercard").remove(),I(e.success,function(){$(".flavor.main_container .expand").hasClass("active")&&Icecream.paginate(tt),Icecream.update_quest_bar()})),e.cow&&(V=e.cow,Icecream.sync_cow(),M("<p>You have adopted a new cow. Cows need to be fed hay to be happy, but a happy cow is a happy life and will help make your ice cream better. Drag hay to your cow to make it happy. Click your cow to see stats.</p>","You have adopted "+V.name))},error:function(){$(t).addClass("upgrade_error").append('<div class="unlock_update">Error</div>'),setTimeout(function(){$(".unlock_update").remove(),$(".upgrade_error").removeClass("upgrade_error")},1500)}}))}),window.onblur=function(){Wa=!1,Nt&&u()
},window.onresize=function(){z()},window.onfocus=function(){Wa=!0,rt=!0,_t>0&&($("title").text("Ice Cream Stand"),_t=0)},$("body").on("click",".message_close, .darkness",function(){if(!$(this).hasClass("update")){var e=document.body.scrollTop;window.location.hash=" ",document.body.scrollTop=e,$(".message, .darkness, .alert_shadow:last").remove(),$(".alert_shadow").each(function(){var e=$(this).offset().top-window.scrollY,a=parseInt($(this).css("margin-left")),t=$(this).css("opacity");$(this).css("top",e+20).css("margin-left",a+20+"px").css("opacity",t+.2)}),St=!1,Mt.length>0&&(M(Mt[0].msg,Mt[0].title),Mt.shift())}}),$("body").on("click",".settings_tab",function(){var e=$(this).attr("x-area");"true"!==$(this).attr("x-active")&&($('.settings_tab[x-active="true"], .settings_area[x-active="true"]').attr("x-active","false"),$(this).attr("x-active","true"),$('.settings_area[x-area="'+e+'"]').attr("x-active","true")),"shop"==$(this).attr("x-type")&&Icecream.shop_paginate(0)}),$("body").on("click",".view_settings",function(){var e="(optional)</span>",a=Icecream.get_flavor(ya.flavors[Math.floor(Math.random()*ya.flavors.length)]);return ya.email_verified?e="verified!":ya.email&&(e='<a href="verify/resend">resend verification</a>'),M('<form action="user_update" method="POST" class="alert-form"><div class="button_container" x-for="settings"><a href="http://en.gravatar.com/" target="_blank" title="Set your avatar through Gravatar" class="settings_avatar" style="background-image: url('+ht+"/flavours/thumb/"+a.name+'.png.gz)"></a><div class="settings_tab" x-area="1" x-active="true">Basic</div><div class="settings_tab" x-area="2" x-active="false">Advanced</div><div class="settings_tab" x-area="3" x-active="false">Animations</div><div class="settings_tab" x-area="4" x-active="false">Emails</div></div><div class="settings_area" x-area="1" x-active="true"><div class="squish">Player Name<input type="text" placeholder="USERNAME" name="username" value="'+ya.name+'"></div><div class="squish">Password <span class="setting_hint">(optional)</span><input type="password" placeholder="Password (optional)" name="password"></div><div class="squish">Email <span class="setting_hint">'+e+'</span><input type="text" placeholder="Email (optional)" name="email" value='+(ya.email?ya.email:"")+'></div></div><div class="settings_area" x-area="2" x-active="false"><div class="squish">Ignore List (comma seperated)<input type="text" placeholder="ignore list" name="ignore" value="'+(ya.ignore?ya.ignore:"")+'"></div><div class="squish">Release channel <input type="radio" name="release_channel" value="0" />Main <input type="radio" name="release_channel" value="1" />Beta '+(-1===ya.badges.indexOf(1)?" &nbsp; <small>You must be a donor to access Alpha</small>":'<input type="radio" name="release_channel" value="2" />Alpha')+'</span></div><div class="squish">Language: <a href="/lang/en">English</a> <a href="/lang/jp">Japanese</a> <a href="/lang/ru">Russian</a></div><div class="squish"><div class="toggle_outer"><div class="toggle_container" x-key="chat_off">Do not Disturb</div><div class="toggle_container" x-key="is_night">Night Mode</div><div class="toggle_container" x-key="is_tooltip">Tooltips</div><div class="toggle_container" x-key="is_friend_notify">Notify when friends come online</div><div class="toggle_container" x-key="badge_off">Hide Badge</div><div class="toggle_container" x-key="is_second_row">New below top row</div></div><div class="display_settings"></div></div></div><div class="settings_area" x-area="3" x-active="false"><div class="squish"><div class="toggle_container" x-key="is_animation_clouds">Clouds</div></div><div class="squish"><div class="toggle_container" x-key="is_animation_cones">Falling Cones</div></div><div class="squish"><div class="toggle_container" x-key="is_animation_workers">Worker Sales</div></div><div class="squish"><div class="toggle_container" x-key="is_animation_money">Money Updates</div></div><br></div><div class="settings_area" x-area="4" x-active="false"><div class="squish"><div class="toggle_container" x-key="is_email_holiday">Email me with Holiday Events</div></div><div class="squish"><div class="toggle_container" x-key="is_email_holiday">Email me when my password changes</div></div><br><br></div><input type="submit" value="Update" class="button update" id="settings_update"></form>',Y("Update Your Settings"),Y("Cancel")),$(".display_settings").html('<div class="toggle_display toggle_container" x-id="flavor">Ice Cream</div><div class="toggle_display toggle_container" x-id="quests">Quests</div><br /><div class="toggle_display toggle_container" x-id="achievements">Trending and Event</div><div class="toggle_display toggle_container" x-id="chat">Chat</div></div>'),$('.alert-form input[type="radio"][value="'+ya.release_channel+'"]').attr("checked",!0),ya.display_settings&&0==ya.display_settings[0]||$('.toggle_display[x-id="flavor"]').addClass("checked"),ya.display_settings&&0==ya.display_settings[1]||$('.toggle_display[x-id="quests"]').addClass("checked"),ya.display_settings&&0==ya.display_settings[2]||$('.toggle_display[x-id="achievements"]').addClass("checked"),ya.display_settings&&0==ya.display_settings[3]||$('.toggle_display[x-id="chat"]').addClass("checked"),$(".toggle_container[x-key]").each(function(){var e=$(this).attr("x-key");ya[e]&&$(this).addClass("checked")}),!1}),$("body").on("click",".easter",function(){var e=$(this).attr("x-num");$(this).remove(),$.ajax({url:"easter/"+e+"/"+btoa("e at ics"+e+"pleasedontcheat"+ya.name),type:"GET",dataType:"text",success:function(e){M(e,"Easter!"),I()}})}),$("body").on("click",".view_stats",function(){return I("stats",function(){$(".message > #description").html(l())}),M(l(),"Stats"),!1}),$("body").on("click","#cow_teach",function(){var e=$("#cow_memory").val();V.memories.push(e),$.ajax({url:"cow/update",data:{memory:e},type:"post",dataType:"json"}),$(".message_close:last").click()}),$("body").on("click",".vote_box",function(){$(this).css("bottom",-25);var e=$(this).attr("x-name");$.ajax({url:"vote/"+$(this).attr("x-id"),dataType:"json",type:"post",success:function(a){a.success?(Icecream.update_flavors(),_gaq.push(["_trackEvent","Flavour","Voted for a flavour",e])):a.error&&M(a.error)}})}),$("body").on("click",".nav_triangle",function(){$(".main_nav").is(":visible")?($(".main_nav").slideUp(500),$(this).addClass("inactive")):($(".main_nav").slideDown(500),$(this).removeClass("inactive"))}),$("body").on("click","#message_read",function(){c($(this).closest(".new_message").attr("x-id"))}),$("body").on("click","#message_mark_read",function(){c($(this).closest(".message_options").attr("x-id"))}),$("body").on("click","#message_remove",function(){var e=$(this).parent();$.ajax({url:"message/remove/"+$(e).attr("x-id"),dataType:"json",type:"post",success:function(){e.hasClass("new_message")&&$(e).hide(),$(".message").length>0&&$(".friends_button_container").click()}})}),$("body").on("click","#friend_message_button",function(){$.ajax({url:"/message/"+$(this).attr("x-user"),data:{message:$("#friend_message_textarea").val()},dataType:"json",type:"post",success:function(e){return e.error?M(e.error):void $(".message_close:last").click()}})}),$("body").on("click",".toggle_container",function(){$(this).toggleClass("checked");var e=$(this).attr("x-key");e&&$.ajax({url:"toggle",data:{toggle:$(this).attr("x-key")},type:"POST",dataType:"json",success:function(a){return a.err?M(a.err):(ya[e]=!ya[e],void("chat_off"==e?($("#chat_window").text(""),pt="",Icecream.sync_chat()):"is_night"==e&&(ya[e]?$("body").addClass("night"):$("body").removeClass("night"))))}});$(this).hasClass("checked");$(this).hasClass("toggle_display")&&$.ajax({url:"toggle_display",data:{type:$(this).attr("x-id")},type:"POST",success:function(){I("repaint",function(){z()})}})}),$("body").on("dragstart",".flavor.main_container .option",function(e){$(this).addClass("drag"),La=this,e.originalEvent.dataTransfer.effectAllowed="move",e.originalEvent.dataTransfer.setData("text/html",this.outerHTML),$(".hovercard").remove()}),$("body").on("dragend",".flavor.main_container .option",function(){$(this).removeClass("drag"),$(".option.over").removeClass("over")}),$("body").on("dragenter",".flavor.main_container .option",function(){$(this).addClass("over")}),$("body").on("dragleave",".flavor.main_container .option",function(){$(this).removeClass("over")}),$("body").on("dragover",".flavor.main_container .option",function(e){return e.preventDefault&&e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="move",!1}),$("body").on("drop",".flavor.main_container .option",function(e){var a=e.originalEvent.dataTransfer.getData("text/html");if("hay"==a||"rock"==a)return!1;if(La!=this){La.outerHTML=this.outerHTML,this.outerHTML=a;var t=$(".option.over").attr("x-id"),s=$(".option.drag").attr("x-id"),n=$(this).attr("x-type");if(n||(n=$(this).parent().attr("x-type")),"addon"===n){var o=ya.toppings.indexOf(t),r=ya.toppings.indexOf(s);ya.toppings[o]=s,ya.toppings[r]=t,$.ajax({url:"/switch/addon",data:"1="+t+"&2="+s,dataType:"JSON",type:"POST"})}else if("combo"===n){var o=ya.combos.indexOf(t),r=ya.combos.indexOf(s);ya.combos[o]=s,ya.combos[r]=t,$.ajax({url:"/switch/combo",data:"1="+t+"&2="+s,dataType:"JSON",type:"POST"})}else if("cone"===n){var o=ya.cones.indexOf(t),r=ya.cones.indexOf(s);ya.cones[o]=s,ya.cones[r]=t,$.ajax({url:"/switch/cone",data:"1="+t+"&2="+s,dataType:"JSON",type:"POST"})}else{var o=ya.flavors.indexOf(t),r=ya.flavors.indexOf(s);ya.flavors[o]=s,ya.flavors[r]=t;var i=ya.flavors_sold[o];ya.flavors_sold[o]=ya.flavors_sold[r],ya.flavors_sold[r]=i,$.ajax({url:"/switch",data:"1="+t+"&2="+s,dataType:"JSON",type:"POST"})}$(".option.over").parent().hasClass("outofstock")?($(".option.over").parent().removeClass("outofstock"),$(".option.drag").parent().addClass("outofstock")):$(".option.drag").parent().hasClass("outofstock")&&($(".option.drag").parent().removeClass("outofstock"),$(".option.over").parent().addClass("outofstock")),$(".option.over").removeClass("over"),$(".option.drag").removeClass("drag"),A(),b("main base drop"),Icecream.update_worker_fx("flavour drop")}return!1}),$("body").on("keydown","#new_message input",function(){ma.emit("typing")}),$("body").on("submit","#new_message",function(){if(0===ya.prestige_level&&!ya.quests)return M("<p>Please play the game a bit more before chatting.</p><p>Sorry for any inconvience, this is to stop others from abusing chat.</p>","Not Yet"),!1;var e=$("#new_message").find('input[type="text"]').val();if("/pm"==e.substring(0,3)){e=e.substring(4);var a=e.substr(0,e.indexOf(" ")+1).trim(),t=e.substr(e.indexOf(" ")+1).trim();return f(a,"",t),!1}var s=ya.badge_off?"":$(this).attr("x-badge"),n={badge:s,text:e};return ma.emit("chat message",n),$('#new_message input[type="text"]').val("").focus(),!1}),$("body").on("click",".individual_badge",function(){var e=$(this).attr("x-badge");$(".badge_selector").css("background-image",'url("'+ht+"/badges/"+e+'.png")'),$("form#new_message").attr("x-badge",e),$.ajax({url:"badge/update/"+e,type:"post",dataType:"json",success:function(e){ya.badges=e.badges,$(".individual_badge").remove();for(var a=0;a<ya.badges.length;a++){var t=ya.badges[a];$(".badge_inner").append('<img src="'+ht+"/badges/"+t+'.png" class="individual_badge" x-badge="'+t+'" />')}z()}})}),$("body").on("click",".next_tutorial",function(){ya.tutorial++,Icecream.get_tutorial(),$.ajax({url:"tutorial",data:"tutorial="+ya.tutorial,dataType:"JSON",type:"POST",success:function(){}})}),$("body").on("click",".img_inline",function(){var e=$(this).text();"view"==e?($(this)[0].textContent="hide",$(this).after('<img class="img_inline_after" src="'+$(this).attr("x-href")+'" />')):($(this)[0].textContent="view",$(this).next(".img_inline_after").remove()),z()}),$("body").on("click",".friend_gold",function(){$(this).fadeOut(1e3,function(){$(this).remove()}),$.ajax({url:"redeem_friend",dataType:"JSON",success:function(e){return e.err?M(e.err):void I("friend gold",function(){ka=ya.gold})}})}),$("body").on("click",".complete_quest",function(){var e=this;$.ajax({url:"complete_quest",data:"id="+$(this).closest(".quest").attr("x-id"),dataType:"JSON",type:"POST",success:function(a){if(a.error)return $(e).addClass("upgrade_error").append('<div class="unlock_update">'+a.error+"</div>"),setTimeout(function(){$(".unlock_update").remove(),$(".upgrade_error").removeClass("upgrade_error")},2500),!1;Icecream.cloud(2*Math.random()),_gaq.push(["_trackEvent","Quest","Completed Quest",ya.quests.length]),1==ya.quests.length&&$(".chat.main_container").show(),2==ya.quests.length&&($(".quests").addClass(".half_size"),bt=!0,Icecream.update_flavors(),Icecream.update_trending());var t=$(e).closest(".quest").attr("x-id");"526745240fc3180000000002"==t?M('<img class="quest_princess" src="'+ht+'/princess_quest.png">Congratulations! Successfully completed the final quest of the main storyline, earning + $1.00 when a flavor trends or there is an add-on event.<br /><br /><b>Now onward to dynamic quests!</b>',"Quest Complete"):"52577a6288983d0000000001"==t?M('<div class="quest_image_container" x-type="icecream"><img class="quest_princess" src="'+ht+'/flavours/strawberry.png.gz"></div>Congratulations! Successfully completed the quest, in return Joy grants you a workers permit. Bring on the minimum wage!<br /><br /><b>Unlocked Workers</b>',"Quest Complete"):"52672bedde0b830000000001"==t?(M('<img class="quest_princess" src="'+ht+'/princess_quest.png">Zing! Successfully completed the quest, in return Joy teaches you trends and events. So much to learn!<br /><br /><b>Unlocked trends and add-on events</b>',"Quest Complete"),Icecream.update_trending(),Icecream.update_event()):"dynamic quest"==a.name?M('<img class="quest_princess" src="'+ht+'/princess_quest.png">Boo-Yah! Successfully completed the quest, earning + $0.25 when there is an add-on event.<br /><br /><b>The next quest will unlock soon.</b>',"Quest Complete"):M('<img class="quest_princess" src="'+ht+'/princess_quest.png">Huzzah! Successfully completed the quest, earning + $1.00 when there is an add-on event.<br /><br /><b>The next quest will unlock in a couple minutes.</b>',"Quest Complete"),I("quest"),$(e).addClass("upgrade_success"),$(".upgrade_success").append('<div class="unlock_update">QUEST COMPLETE</div>'),setTimeout(function(){$(".unlock_update").remove(),$(".upgrade_success").removeClass("upgrade_success")},2500)},error:function(){$(e).addClass("upgrade_error"),$(e).append('<div class="unlock_update">Error</div>'),setTimeout(function(){$(".unlock_update").remove(),$(".upgrade_error").removeClass("upgrade_error")},2500)}})}),$("body").on("click",".donate_once",function(){$(".donate_anchor").show(),$(this).hide()}),$("body").on("click",'.link_underline[x-link="winter"]',function(){document.location.hash="#!event/winter",y()}),$("body").on("click",'#donate, .link_underline[x-link="donate"], .next_tutorial[x-link="donate"]',function(){document.location.hash="#!donate",M('<p><b>100% of the donations go to making the game better!</b> Leave a note with your player name to earn a donation badge, access to alpha, and exclusive donor items. Alpha channel lets you see changes as they are being made and added to the game, before anyone else. </p> <a href="http://www.patreon.com/icecream" target="_blank" class="button donate_button">Support Ice Cream Stand</a> <small class="donate_once" x-section="1">Click here to make a one-time donation</small><div class="donate_anchor" x-anchor="1" style="display: none;"><p>Donor Rewards for one-time donations are the same as ongoing donations viewable here: <a href="http://www.patreon.com/icecream" target="_blank">http://www.patreon.com/icecream</a></p><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top"><input type="hidden" name="cmd" value="_donations"><input type="hidden" name="business" value="48U9KJ3T3UWK2"><input type="hidden" name="lc" value="CA"><input type="hidden" name="item_name" value="Ice Cream Stand"><input type="hidden" name="currency_code" value="USD"><input type="hidden" name="bn" value="PP-DonationsBF:btn_donateCC_LG.gif:NonHosted"><input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!"><img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1"></form></div>',"Donate")}),$("body").on("click",'#invite, .link_underline[x-link="invite"], .next_tutorial[x-link="invite"]',function(){document.location.hash="#!invite";var e="http://icecreamstand.ca/sign_up?refer="+btoa(ya.name);return M('<p><b>Give your friend this URL</b> to sign up with and get 25% of their money for that day whenever they complete a quest!</p><center><input type"text" id="refer_url" value="'+e+'"></center>',"Refer a friend"),$("#refer_url").select().focus(),!1}),$("body").on("click","user, .user_info_tab",function(){$(".user_info_tab_active").removeClass("user_info_tab_active"),$(this).addClass("user_info_tab_active"),$(".playercard_anchor").hide(),$('.playercard_anchor[x-anchor="'+$(this).attr("x-section")+'"]').fadeIn(250)}),$("body").on("click","user, .user_card",function(){return $(this).attr("x-cow")?void $.ajax({url:"/cow/"+$(this).attr("x-cow"),dataType:"json",success:function(e){o(e.cow,e.user)}}):void d($(this).attr("x-user"))}),$("body").on("click",".icecream",function(){if(Nt||$(".cube_infobar").length>0)return!1;_gaq.push(["_trackEvent","Ice Cube","Start"]),Nt=!0,fa=new Date,ha=0,xt=!1,yt=0,At=1,$(".cube_infobar").remove(),$("#canvas_sales").show().before('<div class="cube_infobar"><span class="infocube_time">00:00</span> <span class="money_icon infocube_money">0</span> <span class="infocube_multiplier"></span></div>'),$(".infocube_multiplier")[0].textContent=At+"x"+(Pt?" +2x":""),ga=setInterval(function(){p()},100);100*Math.random();ot=[],_(),0===ya.tutorial&&(ya.tutorial++,Icecream.get_tutorial(),$.ajax({url:"tutorial",data:"tutorial="+ya.tutorial,dataType:"JSON",type:"POST"}))}),$("body").on("mousemove","#canvas_sales",function(e){if(!Nt)return!1;var a=(new Date).getTime();if(va+100>a)return!1;va=a;for(var t=e.pageX-$("#canvas_sales").offset().left,s=e.pageY-$("#canvas_sales").offset().top,n=document.documentElement,o=((window.pageYOffset||n.scrollTop)-(n.clientTop||0),0);o<ot.length;o++){var r=ot[o],i=r[1],l=r[2];if(m(t,i,s,l,r[3]))return vt||($("#canvas_sales").css("cursor","pointer"),vt=!0),!1}vt&&($("#canvas_sales").css("cursor","default"),vt=!1)}),$("body").on("mousedown touchend","#canvas_sales",function(e){if(!Nt)return!1;e.preventDefault(),e.stopPropagation();for(var a=e.pageX-$("#canvas_sales").offset().left,t=e.pageY-$("#canvas_sales").offset().top,s=ot.length,o=0;s>o;o++){var r=ot[o],i=r[1],l=r[2];if(m(a,i,t,l,18)){wt=0,0===r[4]?(ot=[],oa.clearRect(0,0,300,300),_()):8===r[4]?(r[0]=200,u()):9===r[4]?(r[4]=1,n(!0)):(r[4]--,r[3]&&r[3]>10&&(r[3]-=4));var c=1+ya.upgrade_coldhands/4;return Icecream.canvas_icecream_sales(),G(c),P(c),!1}}return wt++,wt>10&&(ot=[],oa.clearRect(0,0,300,300),setTimeout(function(){oa.clearRect(0,0,300,300),ot=[];for(var e=0;2>e;e++){var a=25+160*Math.random(),t=25+125*Math.random();ot.push([0,a,t,0,Math.floor(4*Math.random())])}wt=5},5e3),wt=-1e3),!1}),$("body").on("click",".new_message_respond",function(){var e=$(this).parent().find(".user_card").attr("x-user");return c($(this).parent().attr("x-id")),f(e),!1}),$("body").on("click",".friend_reply",function(){var e=$(this).attr("x-user"),a=$(this).closest("tr").find(".message_body").text();f(e,a)}),$("body").on("click","#compose_send",function(){var e=$("#compose_to").val();e&&f(e)}),$("body").on("click",".view_achievements",function(){return j(),!1}),$("body").on("click",".view_credits",function(){return $.ajax({url:"https://s3.amazonaws.com/icecreamstand.com/credits.json.gz",data:{cache:Math.random()},dataType:"json",success:function(e){var a="";for(var t in e)a=a+'<div class="credits_entry"><b>'+t+"</b> "+e[t]+"</div>";M("Special thanks to:<br>"+a,"Credits")}}),!1}),$("body").on("click",".friends_button_container",function(){M("...","Private Messages"),$.ajax({url:"messages",dataType:"JSON",type:"GET",success:function(e){qt=e,h(0)}})}),$("body").on("click","message-next",function(){var e=parseInt($("message-controls").attr("x-start")),a=parseInt($("message-controls").attr("x-len"));h(e+a,a)}),$("body").on("click","message-prev",function(){var e=parseInt($("message-controls").attr("x-start")),a=parseInt($("message-controls").attr("x-len"));h(e-a,a)}),$("body").on("click",".send_message",function(){var e=$(this).attr("x-user");return e||(e=$(this).closest("user").attr("x-user")),e?f(e):M("Could not find player","Error"),!1}),$("body").on("click","#feedback",function(){return f("sam"),!1}),$("body").on("click",".friend_delete",function(){var e=$(this).closest("user").attr("x-user");$.ajax({url:"delete/"+e,success:function(){$(".friends_counter user").remove(),Icecream.sync_friends()}})}),$("body").on("click",".decline_friendship",function(){$(".message_close").click()}),$("body").on("click",".accept_friendship",function(){g($(this).attr("x-add"))}),$("body").on("click",".friends_add",function(){$(this).text()===Y("Add")?(""!==$(".friends_add_text").val()&&g($(".friends_add_text").val()),$(this).text(Y("Add friend")),$(".friends_add_text").hide()):($(".friends_add_text").val("").show().focus(),$(this).text(Y("Add")))}),$("body").on("click",".add_friend",function(){return g($(this).attr("x-user")),!1}),$("#canvas_main").click(function(e){var a=e.pageX,t=(e.pageY,document.documentElement),s=(window.pageYOffset||t.scrollTop)-(t.clientTop||0);x(a,e.pageY-s+50)}),$("body").on("click",".filter_flavour_options span",function(e){$.ajax({url:"/sort_flavour/"+$(this).attr("id"),success:function(){I("sort_flavour",function(){Icecream.paginate(tt)})}}),e.stopPropagation()}),$("body").on("click",".filter_addon_options span",function(e){$.ajax({url:"/sort_addon/"+$(this).attr("id"),success:function(){I("sort_addon",function(){Icecream.paginate(tt)})}}),e.stopPropagation()}),$("body").on("submit",".ajaxify",function(){var e=$(this).attr("x-update"),a=$(this).serialize();return $.ajax({url:$(this).attr("action"),data:a,type:$(this).attr("method"),success:function(a){return a.err?M(a.err):($(".darkness").click(),void("refresh"===e&&location.reload()))},error:function(e){console.log(e)}}),!1}),$("body").on("click","#filter_flavour",function(){if(0===$("#filter_flavour > div").length){var e="main_base"==$(".flavor.main_container .flavor_tab.active").attr("x-id")?"filter_flavour_options":"filter_addon_options";$(this).append('<div class="'+e+'"><span id="base_value">Max Value (ASC)</span><span id="-base_value">Max Value (DESC)</span><span id="name">Name (ASC)</span><span id="-name">Name (DESC)</span></div>'),$("#filter_flavour > div").slideDown(250)}else $("#filter_flavour > div").slideUp(250,function(){$(this).remove()})}),$("body").on("click",".inventory_clear",function(){var e=$(this).attr("x-num");$(this).parent(".inventory_slot").remove(),V.items.splice(e,1),Icecream.sync_cow(function(){J()},!0)}),$("body").on("click",".user_cow_title",function(){$.ajax({url:"cow/"+$(this).attr("x-id"),dataType:"json",type:"get",success:function(e){o(e.cow,e.user)}})}),$("body").on("click",".cow_skin",function(){$(".cow_skin.selected").removeClass("selected"),$(this).addClass("selected");var e=parseInt($(this).attr("x-num"));V.skin=isNaN(e)?"default":V.skins_unlocked[e],Icecream.sync_cow(function(){J()},!0)}),$("body").on("click",".button_cow",function(){var e=$(this).attr("x-action");if("rename"==e)M('<form class="ajaxify" x-update="refresh" action="cow/update" method="post"><p class="p_adopt">Renaming your cow can have severe consequences on its identity and sense of self.</p><input name="name" value="'+V.name+'" maxlength="20"><input type="submit" value="Rename"></form>',"Rename "+V.name);else if("skin"==e){var a='<div class="cow_skin" x-id="default"></div>';if(V.skins_unlocked)for(var t=0;t<V.skins_unlocked.length;t++)V.skins_unlocked[t]&&(a=a+'<div class="cow_skin" x-num="'+t+'" x-id="'+V.skins_unlocked[t].toLowerCase().replace(/\s/g,"")+'"></div>');M(a,"Cow Skins"),V.skin||(V.skin="default"),$('.cow_skin[x-id="'+V.skin+'"]').addClass("selected")}else{var s=(new Date-new Date(V.created_at))/864e5;if(20>s)return M("Your cow is too young, it must be at least 20 days old.","I'm afraid I can't let you do that");if(V.level<30)return M("Your cow is too weak, it must be much stronger first! At least level 30.","I'm afraid I can't let you do that");M('<img src="'+ht+'/icon_breed.png" /><form class="ajaxify" x-update="refresh" action="cow/new" method="post"><p class="p_adopt">What would you like your new cow named?</p><input name="name" value="'+V.name+'"><input type="submit" value="Adopt" class="button_adopt"></form>',"Adopting a new Cow")}}),$("body").on("click",".cow",function(){return V&&V.name?void o(V):!1}),$("body").on("click",'.type_item[x-variance="2"][x-type="rock"]',function(){return S(this,"Coooooooo"),!1}),$("body").on("click",'.login a[href="logout"]',function(){return M(Y("Are you really sure you want to log out?")+' <a href="/logout" class="button" id="settings_update" style="margin-bottom:10px;">'+Y("Log Out")+"</a>",Y("Log Out"),Y("Cancel")),!1}),$("body").on("click",".view_highscores, .refresh_highscores",function(){$(".highscores").show();var t="all";return $("#this_week").hasClass("active")&&(t="week"),$("#this_day").hasClass("active")&&(t="today"),$("#up_and_coming").hasClass("active")&&(t="upandcoming"),$("#prestige").hasClass("active")&&(t="prestige"),$("#accumulation").hasClass("active")&&(t="accumulation"),$("#accumulation_time").hasClass("active")&&(t="accumulation_time"),$("#cowlv").hasClass("active")&&(t="cow"),$.ajax({url:"/highscores",type:"GET",data:{type:t,limit:$(".active#top_100").length>0?100:10,show:$(".active#show_friends").length>0?"friends":""},dataType:"JSON",success:function(t){$(".highscores ol").html("");var s=new Date,n=new Date(s.getTime()-18e5),o=10;$(".active#top_100").length>0&&(o=100);for(var r=t.length,i=0;r>i&&!(i>=o);i++){var l=t[i],c=new Date(l.updated_at).getTime()>n?"online":"offline",d=0;if(l.total_gold&&(d=l.total_gold),l.today_gold&&(d=l.today_gold),l.week_gold&&(d=l.week_gold),l.highest_accumulation)$(".highscores ol").append('<li class="'+c+'"><user x-user="'+l.name+'" class="highscore_user">'+l.name+"</user>  &nbsp; "+a(l.highest_accumulation.toFixed(2))+"</span></li>");else if(l.accumulation_time){var p=Math.floor(l.accumulation_time/60),u=(l.accumulation_time%60).toFixed(2);$(".highscores ol").append('<li class="'+c+'"><user x-user="'+l.name+'" class="highscore_user">'+l.name+"</user>  &nbsp; "+p+":"+(10>u?"0"+u:u)+"</span></li>")}else $(".highscores ol").append(l.level?'<li><user x-cow="'+l._id+'" class="highscore_user">'+l.name+"</user>  &nbsp; "+l.level.toFixed(2)+"</span></li>":l.prestige_bonus?'<li class="'+c+'" ><user x-user="'+l.name+'" class="highscore_user">'+l.name+"</user>  &nbsp; "+l.prestige_bonus.toFixed(5)+"</span></li>":'<li class="'+c+'"><user x-user="'+l.name+'" class="highscore_user">'+l.name+'</user>  &nbsp; <span class="flavor_current">'+a(e(d,0))+"</span></li>")}z()},error:function(){$(".highscores ol").html("<div>Error loading highscores, please try again</div>")}}),!1})}),{paginate:function(e){var a=$(".inner_flavor_container:visible .option_wrapper").length;if(null===e||5>a)return $(".inner_flavor_container:visible .option_wrapper").hide(),$(".inner_flavor_container:visible .option_wrapper").slice(0,5).show(),$(".filter_box").remove(),!1;$(".inner_flavor_container:visible .option_wrapper").slice(0,5).show();var t=5,s=Math.ceil((a-t)/15)-1;if(e>s)return e=s,!1;if(0>e)return e=0,!1;if(tt===e)$(".page_wrap:visible").hide(),$('.page_wrap[x-page="'+e+'"]').css("left",0).show(),$('.page_wrap[x-page="'+e+'"] .option_wrapper').show();else{var n=tt>e;tt=e,$(".page_wrap:visible").animate({left:n?1e3:-1e3},500,function(){$(this).hide()}),console.log("loading page: "+e),$('.page_wrap[x-page="'+e+'"]').css("left",n?-1e3:1e3).show().animate({left:0},500),$('.page_wrap[x-page="'+e+'"] .option_wrapper').show()}if($(".inner_flavor_container:visible .option_wrapper:visible img[x-src]").each(function(){Q(this)}),$(".filter_box").remove(),20>a)return!1;$(".inner_flavor_container:visible").after('<div class="filter_box"><div id="filter_flavour"></div><div class="filter_prev button" onclick="Icecream.paginate('+(e-1)+')"><img style="height: 20px;" src="'+ht+'/arrow.svg"></div><div class="filter_next button" onclick="Icecream.paginate('+(e+1)+')"><img style="height: 20px;" src="'+ht+'/arrow_right.svg"></div></div>'),0==e&&$(".filter_prev").css("opacity","0.5"),e==s&&$(".filter_next").css("opacity","0.5");for(var o=e-2;e+3>o;o++)$(".filter_box").append(o>=0&&s>=o?'<span class="filter_page '+(o==e?"active":"")+'" onclick="Icecream.paginate('+o+')">'+(o+1)+"</span>":'<span class="filter_page" onclick="Icecream.paginate(0)" style="opacity: 0">0</span>')},shop_paginate:function(e){var a=parseInt($(".shop_table:visible").attr("x-index")),t=parseInt($(".shop_table:visible").attr("x-page"))||5,s=a+e;0>s&&(s=0);var n=(s+1)*t;return s>0&&0==$(".shop_table:visible tr:gt("+(n-t-1)+")").length?!1:($(".shop_table:visible").attr("x-index",s),$(".shop_table:visible tr").show(),$(".shop_table:visible tr:gt("+(n-1)+")").hide(),void $(".shop_table:visible tr:lt("+(n-t)+")").hide())},employees_working:function(){Ha>0&&ft&&q(Ha,!0)},update_quest_bar:function(){if(!ya.quests||0===ya.quests.length)return!1;var e,a=ya.quests[ya.quests.length-1],t=a.split("&");if("!"===a.substring(0,1)){var s=parseInt(t[2]),n=t[0].split(","),o=parseInt(n[5]),r=n[4],i=ya.flavors.indexOf(r),l=i>-1?ya.flavors_sold[i]:0;e=100*((l-s)/o)}else{var c=parseInt(t[2]);if("52577a6288983d0000000001"===t[0]){var d=ya.flavors.indexOf("5238d9d376c2d60000000002");if(d>-1){var p=ya.flavors_sold[d];e=100*(p/Ga[c-1])}}else if("52672bedde0b830000000001"===t[0])e=100*(ya.carts/c);else if("52672dea3a8c980000000001"===t[0])e=100*(ya.combos.length/c);else if("526744f40fc3180000000001"===t[0])e=100*(ya.trucks/c);else if("526745240fc3180000000002"===t[0]){for(var u=0,v=ya.flavors_sold.length,_=0;v>_;_++)ya.flavors_sold[_]>99&&u++;e=100*(u/c)}}e>100&&(e=100),ea&&(ea!=e?$("#complete_quest_progress").addClass("active"):$("#complete_quest_progress").removeClass("active")),ea=e,$("#complete_quest_progress").css("width",e+"%")},cloud:function(e){if(!Ot&&ya.is_animation_clouds&&Wa&&!(at>10-e)){for(var a=0;e>a;a++){var t=Math.floor(4*Math.random())-2;0===t&&(t=1);var s=200+175*Math.random(),n=t>0?0-s:Va;et.push({x:n,y:Math.floor(Math.random()*(Xa-300)),width:s,height:.75*s,speed:t,variation:Math.floor(4*Math.random())})}at=et.length}},canvas_icecream_sales:function(){var e=ot.length;if(0!=e){for(var a=0;e>a;a++){var t=ot[a];oa.clearRect(t[1]-26-2,t[2]-26-2,54,54)}for(var a=0;e>a;a++){var t=ot[a];oa.beginPath(),oa.globalAlpha=t[0]<=150?.75:1,oa.arc(t[1],t[2],t[3]+8,0,2*Math.PI,!1),oa.fillStyle="white",oa.fill(),oa.beginPath(),t[0]>0&&oa.arc(t[1],t[2],t[3]/2+8,-.5*Math.PI,(t[0]/50-.5)*Math.PI),oa.lineWidth=t[3],oa.strokeStyle=t[0]<=100?"#7F7DC7":"#BC0000",oa.stroke(),oa.globalAlpha=1,ia.complete&&oa.drawImage(ia,32*t[4],0,32,32,t[1]-t[3],t[2]-t[3],2*t[3],2*t[3]),t[3]<16&&(t[3]+=2)}}},canvas_icecream_drop:function(){if(!Wa||!ya.is_animation_clouds&&!ya.is_animation_cones)return!1;if(ya.is_animation_clouds)for(var e=0;at>e;e++){var a=et[e];na.clearRect(a.x,a.y,a.width,a.height)}if(ya.is_animation_cones)for(var e=0;Za>e;e++){var a=Ka[e];a[2]>-80&&(na.clearRect(a[1],a[2]-Et-8,55*a[3],40*a[3]),ra&&ra.complete&&na.drawImage(ra,a[1]+5*a[3],a[2]+35,40*a[3],50*a[3]),it[a[0]].complete&&"undefined"!=typeof it[a[0]].naturalWidth&&na.drawImage(it[a[0]],a[1],a[2],50*a[3],40*a[3]),lt[a[0]].complete&&"undefined"!=typeof lt[a[0]].naturalWidth&&na.drawImage(lt[a[0]],a[1],a[2]-15,50*a[3],40*a[3])),a[2]+=Et,a[2]>=Xa&&(na.clearRect(a[1],a[2]-Et-8,50*a[3],90*a[3]),Ka.splice(e,1),e--,Za--)
}if(ya.is_animation_clouds)for(var e=0;at>e;e++){var a=et[e];a.x+=a.speed,na.globalAlpha=.75,na.drawImage(nt[a.variation],a.x,a.y,a.width,a.height),na.globalAlpha=1,(a.x>Va&&a.speed>0||a.x<0-a.width&&a.speed<0)&&(na.clearRect(a.x,a.y,a.width,a.height),et.splice(e,1),e--,at--)}},update_gold:function(){!ya.is_animation_money||0===Ha||ka>=ya.gold?ka=ya.gold:ka+=aa/(50-3*ya.upgrade_machinery)+(ya.gold-ka)/10;var e=a(ka.toFixed(2));$(".gold")[0].textContent=e,0===_t&&(kt?$("title")[0].textContent="Unread Message Ice Cream Stand":ka!=ya.gold&&($("title")[0].textContent="$"+e+" Ice Cream Stand"))},process_clicks:function(){return mt>=10?(ft&&ya.upgrade_autopilot>0&&(P(ya.upgrade_autopilot),G(ya.upgrade_autopilot)),mt=0):mt+=2,0==za?void(Wa?Ra=0:Ra>10?Ot||Icecream.deep_sleep():Ra++):(ya.icecream_sold+=za,q(za,!1),ya.icecream_sold>=2e6&&O("5280ef1cb61b420000000009"),ya.icecream_sold>=1e6?O("5280ef12b61b420000000008"):ya.icecream_sold>=5e5?O("5280ef02b61b420000000006"):ya.icecream_sold>=1e5?O("5280eee1b61b420000000004"):ya.icecream_sold>=1e4?O("5280eeeab61b420000000005"):ya.icecream_sold>=1e3?O("5280ee78b61b420000000003"):ya.icecream_sold>=100&&O("5280ee5fb61b420000000001"),za=0,void(Wa&&(Ra=0,Ot&&Icecream.deep_sleep())))},update_event:function(){bt&&$.ajax({url:"/event",data:"cache="+Math.random(),dataType:"JSON",type:"GET",success:function(e){var a=(new Date).getSeconds(),t=ya.trend_bonus.toFixed(2);if(e._id){console.log("event: "+e.event),K=e._id;var s=e.event?e.event:e.name+" is HOT!";0==$('.event_title[x-id="'+K+'"]').length&&($(".event #event_name").text(Y(s)),$(".event #trend_time").html('<span id="trend_bonus" class="money_icon">'+t+'</span><div class="clock"><img src="'+ht+'/clock_hand.svg" class="clock_hand" /></div><span class="event_time">'+a+"</span>").show());for(var n=60-a+60*parseInt(e.mins),o=n;o>=0;o--)setTimeout("Icecream.update_clock('.event_time', "+o+");",1e3*(n-o));clearInterval(pa),pa=setInterval(function(){Icecream.update_event()},n&&n>2?1e3*n:6e4)}else{console.log("no event: "+e),$(".event #event_name").html('<span id="noevent">There is currently no add-on event</span>'),$(".event #trend_time").text(""),K="";for(var o=60;o>=0;o--)setTimeout("Icecream.update_clock('.event_time', "+o+");",1e3*(n-o))}b("update event")}})},update_flavors:function(){return bt?void $.ajax({url:"/flavors",data:{sort:"-votes last_trend_at",limit:5,show_mine:!0},type:"GET",dataType:"JSON",success:function(e){for(var a=e.length,t=0;a>t;t++){var s=e[t];5>t&&(s.votes||(s.votes=0),$('.vote_box[x-id="'+s._id+'"][x-num="'+t+'"]').length>0?$('.vote_box[x-id="'+s._id+'"][x-num="'+t+'"] b')[0].textContent=s.votes:($('.vote_box[x-num="'+t+'"]').remove(),$(".vote_container").append('<div class="vote_box tooltip" x-id="'+s._id+'" x-num="'+t+'" x-name="'+s.name+'"><img src="'+ht+"/flavours/thumb/"+s.name.replace(/\s+/g,"")+'.png.gz" title="'+s.name+'" /><b>'+s.votes+"</b></div>"))),.1==s.value?$('#main_base .option[x-id="'+s._id+'"]').parent(".option_wrapper:not(.outofstock)").addClass("outofstock"):$('#main_base .option[x-id="'+s._id+'"]').parent(".option_wrapper.outofstock").removeClass("outofstock")}}}):!1},first_time_dunce:function(){if($(".dunce").remove(),console.log("dunce: "+ya.dunce_until+" - "+new Date),$('#new_message input[type="text"]').attr("placeholder","What would you like to say"),new Date(ya.dunce_until)>new Date){var e=(new Date(ya.dunce_until)-new Date)/1e3/60;$(".footer").prepend('<div class="dunce">'+ya.dunce_message+"<br>Time left: "+e.toFixed(1)+" minutes.</div>"),$('#new_message input[type="text"]').attr("placeholder","Think before you type"),setTimeout(function(){Icecream.first_time_dunce()},6e3)}},first_time_party:function(){if($(".dunce").remove(),console.log("dunce: "+ya.party_until+" - "+new Date),$('#new_message input[type="text"]').attr("placeholder","What would you like to say"),ya.party_until&&new Date(ya.party_until)>new Date){var e=(new Date(ya.party_until)-new Date)/1e3/60;$(".footer").prepend('<div class="dunce" x-type="party">While you are partying you can invite others to party. Invite people to party by typing /party player_name.<br>Time left: '+e.toFixed(1)+" minutes.</div>"),$('#new_message input[type="text"]').attr("placeholder","Party Party Party"),setTimeout(function(){Icecream.first_time_party()},6e3)}},sync_cow:function(e,a){if(ft)if(V&&V.name){var t={h:V.happiness,experience:V.experience};if(a){t.skin=V.skin,t.items=V.items;for(var s=!0,n=0;n<V.items.length;n++){{V.items[n]}if(3>n){var o=V.items[n].split("/")[4];if(!o||"rare"!=o){s=!1;break}}}t.items_check=btoa(JSON.stringify(t.items)),s&&O("545dad806c43abdf66d01473")}$.ajax({url:"/cow/update",data:t,dataType:"json",type:"post",success:function(t){return t.err?(t.resync&&(V=null,Icecream.sync_cow()),t.experience&&(V.experience=t.experience),2===ya.release_channel&&M(t.err,"Cow Sync Error"),!1):void(t&&t.name&&(V.level<5&&t.level>5&&(M('<center><b>Your cow is growing up!</b><br><br><img src="'+ht+'/skins/default.png" class="cow_evolve" /></center>',V.name+" is evolving!"),V=null,$(".cow")[0].textContent="",Icecream.sync_cow()),V.level=t.level,V.experience=t.experience,V.happiness=t.happiness,a&&U(),e&&"function"==typeof e&&e()))}})}else $.ajax({url:"/me/cows",dataType:"json",type:"get",success:function(e){for(var a=0;a<e.length;a++){var t=e[a];if(t.is_active)V=t,U(),J(),("Moose"==V.skin||"Polar Bear"==V.skin)&&$("body:not(.winter)").addClass("winter");else{var s="";if($(".cow").show(),t.level<5)t.skin="baby";else for(var n=0;n<t.items.length;n++){var o=t.items[n];if(s=s+'<div x-type="'+o.split("/")[0]+'" class="cow_attachment type_item"></div>',2===n)break}var r=$("<div />",{"class":"cow_background","x-id":t._id,title:t.name,"x-num":a,html:'<div x-skin="'+t.skin+'" class="cow_body"></div>'+s});$(r).appendTo(".background_hill"),t.memories.length>0&&Math.random()<.25&&S(r,t.memories[Math.floor(Math.random()*t.memories.length)])}}V&&V._id||($(".cow").prepend('<div class="cow_body adopt_cow tooltip" x-skin="baby" x-type="adopt_cow"></div>'),$(".adopt_cow").click(function(){return V&&V.name?!1:($.ajax({url:"/unlock",data:{type:"adopt_cow"},dataType:"json",type:"POST",success:function(e){return e.error?M(e.error,"Error"):(V=null,$(".cow")[0].textContent="",Icecream.sync_cow(),void M("<p><b>You have adopted a cow!</b> Feed cows hay to improve their happiness.</p><p>A happy cow will give you a bonus to ice cream production. Your cow will become an adult once it hits level 1, allowing you to equip items.</p>","Adopted!"))}}),!1)}))}})},sync_chat:function(){if($(".chat.main_container").is(":visible")&&ft){if(ya.chat_off)return $("#chat_window").html('<div class="chat_disclaimer"><br><p>'+Y("Do Not Disturb is <b>On</b>.")+"<br><br></p><p>"+Y("If you like the Ice Cream Stand")+', <span id="invite">'+Y("invite your friends")+'</span></p><span class="button">'+Y("I Understand")+"</span></div>"),void $(".chat_disclaimer .button").click(function(){$(".chat_disclaimer").remove(),$.ajax({url:"toggle_chat",type:"POST"}),ya.chat_off=!1,Icecream.sync_chat(),pt=""});var e=$(".chat.main_container .expand").hasClass("active")?75:10;$.ajax({url:"chat",data:{expanded:e,cache:Math.random()},dataType:"JSON",type:"GET",success:function(e){for(var a=e.length-1,t=a;t>=0;t--)B(e[t]);z()}})}},reconnect:function(e){return console.log("reconnect attempt "+e),e>0?void $(".inline-message#updated").html("Connectivity issue<br /><small>Trying again in "+e+" seconds</small>"):($(".inline-message#updated").html("Connectivity issue<br /><small>Reconnecting...</small>"),ft=!0,void I("reconnect",function(){$(".inline-message").remove()}))},deep_sleep:function(){Ot&&(Icecream.update_flavors(),Icecream.update_trending(),Icecream.update_event()),Ot=!Ot,ma.emit("sleep",{sleep:Ot});var e=5e3-250*ya.upgrade_machinery,a=Ot?30:1;clearInterval(la),la=setInterval(function(){Icecream.employees_working()},e*a)},sync_messages:function(e){return $("#message_list").length>0?!1:(e||(e=0),void $.ajax({url:"messages",data:{skip:e},success:function(e){if($(".new_message").remove(),e&&e.length>0){kt=!1;for(var a=0;a<e.length;a++){var t=e[a];if(!t.is_read){kt=!0;var s=$("<div />",{"class":"new_message",text:t.text,"x-id":t._id});$(s).append("Added you as a friend!"==t.text?'<div class="new_message_respond" x-user="'+t.from+'">Say Hello!</div>':'<div class="new_message_respond" x-user="'+t.from+'">Reply</div>'),$(s).prepend('<div class="message_title">New Message!<span id="message_read">x</span></div><b class="user_card" x-user="'+t.from+'">'+t.from+"</b> "),$(s).append('<span class="triangle-down"></span>'),$(".floating_footer").append(s);break}}}}}))},sync_friends:function(){$.ajax({url:"online",data:"cache="+Math.random(),success:function(e){Ct=e.friends;for(var a=new Date,t=new Date(a.getTime()-18e5),s=0,n=Ct.length,o=0;n>o;o++){var r=Ct[o],i=new Date(r.updated_at).getTime()>t;i&&s++,W(r.name,i,r.is_away)}$(".friends_counter span#count").attr("x-length",n),$(".friends_counter span#count").text(s+"/"+n)}})},sync_online:function(){$.ajax({url:"online/all",success:function(e){ct!==e.c&&(ct=e.c,e.c>dt&&(dt=e.c),$("#online_count").text(e.c+" "+Y("Playing")).attr("x-peak",dt))}})},get_quest:function(e){e&&console.log("get_quest, -> "+e),$.ajax({url:"new_quest",dataType:"JSON",success:function(e){if(e.error)return void M(e.error,"error");if(e.time){ya.next_quest_at=e.time,Icecream.quests_timer();var a=new Date(e.time)-new Date;return setTimeout(function(){Icecream.get_quest("get_quest")},a+200),void console.log("rechecking new quests in "+(a+200))}if(e&&e.name&&$(".quests.main_container:visible").length>0){ya.next_quest_at=null,$(".quests.main_container h4 > .lang")[0].textContent="Quests";var t="Extra $1 add-on event bonus";"Bargaining Time"==e.name&&(t="Unlock Workers"),"Delusions of Grandeur"==e.name&&(t="Unlock Trends and Events"),e.dynamic_quest&&(t='Extra <span class="money_icon">0.25</span> add-on event bonus',e.description=E(e.dynamic_quest)),M('<img class="quest_princess" src="'+ht+'/princess_quest.png">'+e.description.replace(/\n/g,"<br>")+"<br /><br /><b>"+Y("Reward")+"</b> "+t+'<div class="button button_quest button_green">Start Quest</div>',Y("New Quest")+": "+e.name),I("quest")}}})},quests_timer:function(){if(ya.next_quest_at){var e=new Date(ya.next_quest_at)-new Date,a=Math.floor(e/6e4);$(".quests.main_container h4 > .lang")[0].textContent="Quests - Next quest unlocks in "+a+" "+(1==a?"minute":"minutes")}},get_quests:function(){if(console.log("getting quests"),0==ya.quests.length)return $(".quest_default").remove(),$(".quest_list").append('<p class="quest_default">You aren\'t currently on any quests...</p>'),void(ya.gold>10&&Icecream.get_quest());if(ya.next_quest_at&&new Date(ya.next_quest_at)>new Date){var e=new Date(ya.next_quest_at)-new Date;Icecream.quests_timer(),setTimeout(function(){Icecream.get_quest()},e+200),console.log("rechecking new quests in "+(e+200))}else Icecream.get_quest();$.ajax({url:"quests",dataType:"JSON",success:function(e){if(!e)return!1;Ja=e;var a=ya.quests.length-1,t=ya.quests[a].split("&");$(".quest_default").remove();for(var s=0;a>=s;s++){var n=ya.quests[s];if("!d"==n.substring(0,2)){var o=n.split("&"),r="0"==o[1]?'<center><img src="'+ht+'/star.png" class="quest_star" /><b>'+Y("Completed")+"</b></center>":'<div class="button complete_quest"><div id="complete_quest_progress"></div><b>'+Y("Complete Quest")+"</b></div>";$('.quest[x-dynamic="'+n+'"]').remove(),$(".quest_list").prepend('<div class="quest" x-dynamic="'+n+'" x-num="'+s+'"><div class="quest_body">'+E(n)+'<div class="quest_goal"><b>'+Y("Reward")+'</b> <span class="money_icon">0.25</span> Event Bonus</div></div>'+r+"</div>")}else{var i=e[s];if("undefined"==typeof i)break;$('.quest[x-id="'+i._id+'"]').remove();var o=ya.quests[s].split("&");if(o[2]){var l=o[2];i.description=i.description.replace("[cost]",l)}$(".quest_list").prepend('<div class="quest" x-num="'+s+'" x-id="'+i._id+'"><div class="quest_body">'+i.description+"</div></div>"),"0"!=o[1]?(0==i.level&&$(".quest:first .quest_body").append('<div class="quest_goal"><b>Goal</b>: Become an expert '+(l?l:5)+" with her favourite flavor<br /><b>Reward</b> Unlock Workers</div>"),1==i.level&&$(".quest:first .quest_body").append('<div class="quest_goal"><b>Goal</b>: Buy '+l+" carts<br /><b>Reward</b> Unlock Trends</div>"),2==i.level&&$(".quest:first .quest_body").append('<div class="quest_goal"><b>Goal</b>: Discover '+l+' combos<br /><b>Reward</b> + <span class="money_icon">1.00</span> event bonus</div>'),3==i.level&&$(".quest:first .quest_body").append('<div class="quest_goal"><b>Goal</b>: Buy '+(l?l:2)+" trucks<br /><b>Reward</b> Unlock Frankenflavours</div>"),4==i.level&&$(".quest:first .quest_body").append('<div class="quest_goal"><b>Goal</b>: Sell 100 of '+(l?l:5)+" flavors<br /><b>Reward</b>: Unlocks prestige, + $1 event bonus</div>"),$('.quest[x-id="'+i._id+'"]').append('<div class="button complete_quest"><div id="complete_quest_progress"></div><b>'+Y("Complete")+" "+i.name+"</b></div>")):$('.quest[x-id="'+i._id+'"]').append('<center><img src="'+ht+'/star.png" class="quest_star" /><b>'+Y("Completed")+" "+i.name+"</b></center>")}}20==ya.quests.length&&"0"==t[1]&&$(".quest_list").prepend('<div class="quest"><div class="quest_title">'+Y("Prestige")+'</div><p>When you are ready, go to upgrades and unlock Prestige. You will get a bonus based on cash balance, and the number of flavours and add-ons unlocked. This restarts the game with a percentage bonus on all income.</p><img src="'+ht+'/prestige_thumb.png" id="quest_prestige"></div>'),$(".quest").hide(),$(".quest:first").show(),Icecream.update_quest_bar()}})},update_trending:function(){return bt?void $.ajax({url:"/trending",data:"cache="+Math.random(),dataType:"JSON",type:"GET",success:function(e){X=e.flavour_id;for(var t,s=0;s<xa.length;s++)if(xa[s]._id===X){t=xa[s];break}Ia=e.bonus.toFixed(2),$(".trending #trend_bonus").text(Ia),$(".trend_title").text(Y(e.flavour_name)),t?(b("update trending"),0==$('.currently_trending[x-id="'+X+'"]').length?$(".trending .currently_trending_container").html('<span class="currently_trending tooltip" x-type="base" x-id="'+X+'" id="'+e.flavour_name.replace(/\s+/g,"")+'"><img src="'+ht+"/flavours/thumb/"+e.flavour_name.replace(/\s+/g,"")+'.png.gz" class="trending_img active" /></span></span>'):$(".trending #trend_bonus").text(Ia).show()):$(".trending .currently_trending_container").html('<span class="currently_trending tooltip" x-type="base" x-id="'+X+'" id="'+e.flavour_name.replace(/\s+/g,"")+'"><img src="'+ht+"/flavours/thumb/"+e.flavour_name.replace(/\s+/g,"")+'.png.gz" class="trending_img active trending_locked" /></span></span>'),$("#trend_left").html(a(75e3-e.total_sold)+" left"),$("#trend_sold_inner").css("width",e.total_sold/75e3*100+"%")}}):void console.log("cache event trend enable is OFF")},update_clock:function(e,a){var t=Math.floor(a/60),s=a%60;a>0&&($(e)[0].textContent=t+":"+(10>s?"0"+s:s))},update_worker_fx:function(a){a&&console.log("update_worker_fx <- "+a),$(".wrapper_addon_thumb").remove();for(var t=0;5>t;t++){var s=ya.toppings[t];if(s){for(var n=wa.length,o=0;n>o;o++)if(wa[o]._id===s){s=wa[o].name;break}var r=zt.indexOf(s)>-1,i=r?ht+"/addons/thumb/"+s.replace(/\s+/g,"")+".png.gz":ht+"/toppings/"+s.replace(/\s+/g,"")+"_thumb.png";$("#main_base .option_wrapper").eq(t).append('<img src="'+i+'" x-is-new="'+r+'" class="wrapper_addon_thumb" />')}}$("#main_base .option_wrapper .icecream_float").remove();for(var l=0;5>l;l++){if(l>=ya.carts)return;{$("#main_base .option").eq(l),$("#main_addon .option").eq(l)}if(ya.flavors.length>l){var c=Icecream.get_flavor(ya.flavors[l]);ya.is_animation_workers&&$('#main_base .option[x-id="'+c._id+'"]').parent().prepend('<div class="icecream_float">'+e(Da[l],2).toFixed(2)+"</div>"),it[l]=new Image,it[l].src=ht+"/flavours/thumb/"+c.name.replace(/\s+/g,"")+".png.gz"}if(ya.toppings.length>l){var d=Icecream.get_addon(ya.toppings[l]);lt[l]=new Image,lt[l].src=ht+"/toppings/"+d.name.replace(/\s+/g,"")+"_thumb.png"}}},get_tutorial:function(){return $(".tutorial").remove(),Nt?(setTimeout(function(){Icecream.get_tutorial()},2e3),!1):(0==ya.tutorial&&$("body").append('<div class="tutorial tutorial_0"><h2>'+Y("Click Ice Cream for money")+'</h2><p class="tutorial_text">'+Y("Quickly Click ice cubes as they appear")+"<br><b>"+Y("Try it out now!")+'</b></p><div class="tut_ice_cube"></div><div class="triangle-left"></div></div>'),1==ya.tutorial&&$("body").append('<div class="tutorial tutorial_2"><h2>'+Y("Buy All The Things")+"</h2><b>"+Y("When you are ready")+"</b> "+Y("research new flavours, add-ons, and adopt your first cow under Upgrade")+'<div class="button next_tutorial">'+Y("Let's Start")+'</div><div class="triangle-right"></div></div>'),void(ya.total_gold>500&&2==ya.tutorial&&$("body").append('<div class="tutorial tutorial_3" style="top: '+window.innerHeight/2+'px;"><h2>'+Y("Sharing is caring")+"</h2>"+Y("If you enjoy Ice Cream Stand <b>please tell your friends</b>. Any time someone you invite completes a quest, you earn money!")+'<div class="clearfix"></div><div class="button next_tutorial">'+Y("No thanks :*(")+'</div><div id="invite" x-link="invite" class="button next_tutorial">'+Y("Sure")+"</div></div>")))},get_flavor:function(e){for(var a=xa.length,t=0;a>t;t++)if(xa[t]._id===e)return xa[t];return{name:"mystery",value:"?",total_value:"?"}},get_friend:function(e){for(var a=Ct.length,t=0;a>t;t++)if(Ct[t]._id===e)return Ct[t]},get_combo:function(e){console.log("getting combo with id "+e);for(var a=qa.length,t=0;a>t;t++)if(qa[t]._id===e)return qa[t];return{name:"mystery"}},get_addon:function(e){for(var a=wa.length,t=0;a>t;t++)if(wa[t]._id===e)return wa[t];return{name:"mystery"}}}}();